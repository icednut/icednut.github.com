{"data":{"site":{"siteMetadata":{"title":"Icednut's Notes","author":"Will Lee","siteUrl":"https://icednut.github.io"}},"markdownRemark":{"id":"2a4576b0-aac3-5320-975f-157446cfdfaf","excerpt":"요구사항 추가지난번 포스트(/2019/09/01/20190901-mediator-pattern)에서 Undo, Redo 기능을 적용해야 된다고 하자. 어떻게 구현하면 될까?위 문제를 해결하려면 Undo, Redo…","html":"<h2>요구사항 추가</h2>\n<p>지난번 포스트(/2019/09/01/20190901-mediator-pattern)에서 Undo, Redo 기능을 적용해야 된다고 하자. 어떻게 구현하면 될까?</p>\n<p>위 문제를 해결하려면 Undo, Redo 할 행위(추가, 삭제)를 캡슐화하여 객체 형태로 만들어서 행위 객체들을 스택에 담아놓고 Undo, Redo에 따라 push, pop을 컨트롤 하면 될거 같다는 생각이 든다.\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bf71a8289ef4c9b1ef83484e6e13752c/04655/command-pattern-preview.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 431px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 95.35962877030163%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsSAAALEgHS3X78AAABuElEQVQ4y5WU567CMAyFef8XA4kfbMoeopRR9p711WfJEXALlEhuU8c5Ocd2moqiSGww/2avsTa3keJxv9+fnJ8GccS/I6GAx+NR7XK5yPV61Q3Y7XbTb3uzfjgc5Hw+u/frcIDr9Vqm06k0m03J5XJSLpel0WhIu92WWq0m3W5XwjCUzWajYKvVSiaTifqw2WymJBzgbrdTYyEIAhmNRi6QgxaLhYs5nU4KCAlYsh/fk+T9fq+nswEGGD4z/NvtVueAWFo+SoZNvV6XbDYr+XxepZKCSqUi/X5fWRIHm69FMSawMDkwNoOhxRjg27axHAIEi0dbLpduziGWw1egWMlsbrVaUigUpFgsapX59jxPqwwobBMBWiEIxkg8b6sg9hjzFZDcwYCWGQwGatY+w+FQxuOxKiAuESBSkE01q9WqVrjT6Uiv11PZHECOf5JsPfZ41fhmDgjriSXDbj6fa/LpRQoCQxjD0Pf9f334EdBuAvcTmQCRQ8spTc96orYhgNzY1UIqsvEzx+xA4uwv8xaQBWsVrFQqSSaT0cKk02ntSUCtfeJuiAOMc8ICibAir7RL3I82bvwBrx6+TwtCixgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"command pattern preview\"\n        title=\"\"\n        src=\"/static/bf71a8289ef4c9b1ef83484e6e13752c/04655/command-pattern-preview.png\"\n        srcset=\"/static/bf71a8289ef4c9b1ef83484e6e13752c/cf440/command-pattern-preview.png 148w,\n/static/bf71a8289ef4c9b1ef83484e6e13752c/d2d38/command-pattern-preview.png 295w,\n/static/bf71a8289ef4c9b1ef83484e6e13752c/04655/command-pattern-preview.png 431w\"\n        sizes=\"(max-width: 431px) 100vw, 431px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>여기서 필요한 패턴이 Command Pattern이다. 왜냐면 행위를 캡슐화하여 실행을 할 수 있어야 하기 떄문이다. 그럼 Command Pattern에 집중하기 위해 이전 포스트에서 다뤘던 Plain Todo App에 Command Pattern을 적용하도록 하겠다.\n<br/>\n<br/></p>\n<h2>Todo App with Command Pattern</h2>\n<p>커맨드 패턴을 적용하기 위해 행위를 TodoAction 이라고 추상화 한 뒤 Todo 추가, Todo 삭제 행위를 TodoInsertAction, TodoDeleteAction 이런 식으로 구현하였다. Command Pattern의 장점은 행위 뿐만 아니라 그 행위와 관련된 상태도 캡슐화 할 수 있다.</p>\n<h5>Command Pattern 적용 전</h5>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Route</span>\n<span class=\"token annotation punctuation\">@PWA</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"Plain Todo App\"</span><span class=\"token punctuation\">,</span> shortName <span class=\"token operator\">=</span> <span class=\"token string\">\"PTA\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MainView</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">VerticalLayout</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">final</span> <span class=\"token class-name\">VerticalLayout</span> todosList <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">VerticalLayout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">final</span> <span class=\"token class-name\">TextField</span> todoField <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TextField</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">final</span> <span class=\"token class-name\">Button</span> addButton <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Button</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Add\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">MainView</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        addButton<span class=\"token punctuation\">.</span><span class=\"token function\">addClickListener</span><span class=\"token punctuation\">(</span>event <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> todoMessage <span class=\"token operator\">=</span> todoField<span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">StringUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">hasText</span><span class=\"token punctuation\">(</span>todoMessage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">final</span> <span class=\"token class-name\">TodoListElement</span> todoListElement <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TodoListElement</span><span class=\"token punctuation\">(</span>todoMessage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                todoListElement<span class=\"token punctuation\">.</span><span class=\"token function\">addDeleteClickListener</span><span class=\"token punctuation\">(</span>deleteClickEvent <span class=\"token operator\">-></span> todosList<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span>todoListElement<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                todosList<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>todoListElement<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                todoField<span class=\"token punctuation\">.</span><span class=\"token function\">setValue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">HorizontalLayout</span><span class=\"token punctuation\">(</span>todoField<span class=\"token punctuation\">,</span> addButton<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> todosList<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h5>Command Pattern 적용 후</h5>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Route</span>\n<span class=\"token annotation punctuation\">@PWA</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"Design Pattern Exercise Command Pattern\"</span><span class=\"token punctuation\">,</span> shortName <span class=\"token operator\">=</span> <span class=\"token string\">\"Command Pattern Exercise\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MainView</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">VerticalLayout</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">AtomicLong</span> todoIdGenerator <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AtomicLong</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">VerticalLayout</span> todosList <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">VerticalLayout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">TodoInput</span> todoInput <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TodoInput</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">MainView</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        todoInput<span class=\"token punctuation\">.</span><span class=\"token function\">addAddClickListener</span><span class=\"token punctuation\">(</span>event <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">final</span> <span class=\"token keyword\">long</span> todoId <span class=\"token operator\">=</span> todoIdGenerator<span class=\"token punctuation\">.</span><span class=\"token function\">incrementAndGet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> todoMessageBody <span class=\"token operator\">=</span> todoInput<span class=\"token punctuation\">.</span><span class=\"token function\">getTodoMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">final</span> <span class=\"token class-name\">TodoMessage</span> todoMessage <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TodoMessage</span><span class=\"token punctuation\">(</span>todoId<span class=\"token punctuation\">,</span> todoMessageBody<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">final</span> <span class=\"token class-name\">TodoAction</span> todoInsertAction <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TodoAction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n                \n<span class=\"gatsby-highlight-code-line\">                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">StringUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">hasText</span><span class=\"token punctuation\">(</span>todoMessageBody<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">                    <span class=\"token keyword\">final</span> <span class=\"token class-name\">TodoListElement</span> todoListElement <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TodoListElement</span><span class=\"token punctuation\">(</span>todoMessage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>// &lt;1></span></span><span class=\"gatsby-highlight-code-line\">                    todoListElement<span class=\"token punctuation\">.</span><span class=\"token function\">addDeleteClickListener</span><span class=\"token punctuation\">(</span>// &lt;1></span></span><span class=\"gatsby-highlight-code-line\">                        <span class=\"token function\">getDeleteClickListener</span><span class=\"token punctuation\">(</span>todoMessage<span class=\"token punctuation\">,</span> todoListElement<span class=\"token punctuation\">)</span>// &lt;1></span></span><span class=\"gatsby-highlight-code-line\">                    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>// &lt;1></span></span><span class=\"gatsby-highlight-code-line\">                    todosList<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>todoListElement<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>// &lt;3></span></span><span class=\"gatsby-highlight-code-line\">                <span class=\"token punctuation\">}</span></span>            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"gatsby-highlight-code-line\">            todoInsertAction<span class=\"token punctuation\">.</span><span class=\"token function\">doIt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>// &lt;2></span></span>        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">HorizontalLayout</span><span class=\"token punctuation\">(</span>undoButton<span class=\"token punctuation\">,</span> redoButton<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> todoInput<span class=\"token punctuation\">,</span> todosList<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">ComponentEventListener</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ClickEvent</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Icon</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getDeleteClickListener</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">TodoMessage</span> todoMessage<span class=\"token punctuation\">,</span> <span class=\"token class-name\">TodoListElement</span> todoListElement<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> deleteClick <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">final</span> <span class=\"token class-name\">TodoAction</span> todoDeleteAction <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TodoAction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n                <span class=\"token function\">deleteByTodoId</span><span class=\"token punctuation\">(</span>todoListElement<span class=\"token punctuation\">.</span><span class=\"token function\">getTodoId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"gatsby-highlight-code-line\">            todoDeleteAction<span class=\"token punctuation\">.</span><span class=\"token function\">doIt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>// &lt;4></span></span>        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">TodoAction</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Runnable</span> actionBody<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">TodoAction</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Runnable</span> actionBody<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>actionBody <span class=\"token operator\">=</span> actionBody<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">doIt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        actionBody<span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<ul>\n<li>&#x3C;1> : Todo 항목 추가 이벤트 발생 시 Todo 추가 진행 행위 함수를 TodoInsertAction 인스턴스에 넣어서 해당 커맨드 인스턴스를 실행하고 있다.</li>\n<li>&#x3C;2> : 실제로 커맨트 인스턴스는 여기에서 실행된다.</li>\n<li>&#x3C;3> : TodoInsertAction이 수행할 Todo 추가 액션을 살펴보면 Todo 항목 컴포넌트 생성 후 TodoList 컴포넌트에 추가하고 있다. (Todo 추가 행위)</li>\n<li>&#x3C;4> : 마찬가지로 Todo 항목 삭제도 TodoDeleteAction이라는 커맨드 인스턴스를 만든 뒤 doIt 메소드를 통해 삭제 행위를 실행하고 있다.</li>\n</ul>\n<p>todoInsertAction, todoDeleteAction의 body 함수 부분이 클로저가 되어 변수 참조가 어지럽게 되었다. 앞의 포스팅인 Mediator Pattern 코드와 합치면 좀 더 테스트가 수월한 코드로 만들 수 있을 것 같지만 일단 Command Pattern에 집중하기로 하자.</p>\n<h5>Undo, Redo 기능 추가</h5>\n<p>이어서 위에 Command Pattern을 적용한 코드를 기반으로 Undo, Redo 기능을 추가하도록 하자. Undo, Redo에서 쓸 커맨드 인스턴스를 담아 둘 스택이 필요하다. 이 스택은 LinkedList를 사용한다.</p>\n<p>그런데 Undo, Redo 기능을 구현하려면 커맨드 객체를 다시 Undo 했을 때 Undo 행위에 대한 action body가 현재는 없다. 그렇기 때문에 Todo 추가 후 undo를 했을 때(undo 스택에서 pop 했을 때) undo 커맨드의 행위(추가한 Todo 삭제)를 수행할 수가 없다.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/aa064e9aa1f8c5c1a6aeef2a90c08ffb/e7069/command-pattern-preview_2-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 54.72703062583222%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAAA7UlEQVQoz5VT2QqEMBDz//9QRLzvB+8TdZYMTLFdF7qFODjWNMmoc983mZBl9p7Pfi3nui46jkN7oaoqmudZ9fZ9tyc8z5O2bVMN3Hddpx2yruuX4l9wcOn7nqIoojAMKcsyVliWJaVpylUIbRZbHoaBVQEgN7EsC2/GXjiQagJ9pRBqkiShoihYFZDnOasVQmQZxzF5nscVgCNUOETuihBEQgDUdc2kTdNoGY7jSK7rMkkQBOT7Ph+AvpbhkxBkb4RWGb5ZBhmIZUBi2WrKCHKaJvaPisG0bcuHSO9p2UqhTAihy+cDu/Lsnz/lA0NbVxMzivR6AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"command pattern preview 2 1\"\n        title=\"\"\n        src=\"/static/aa064e9aa1f8c5c1a6aeef2a90c08ffb/b9e4f/command-pattern-preview_2-1.png\"\n        srcset=\"/static/aa064e9aa1f8c5c1a6aeef2a90c08ffb/cf440/command-pattern-preview_2-1.png 148w,\n/static/aa064e9aa1f8c5c1a6aeef2a90c08ffb/d2d38/command-pattern-preview_2-1.png 295w,\n/static/aa064e9aa1f8c5c1a6aeef2a90c08ffb/b9e4f/command-pattern-preview_2-1.png 590w,\n/static/aa064e9aa1f8c5c1a6aeef2a90c08ffb/e7069/command-pattern-preview_2-1.png 751w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>이 문제를 해결하기 위해 추가,삭제 커맨드 클래스에 undo 시 진행되어야할 행위도 같이 받도록 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Route</span>\n<span class=\"token annotation punctuation\">@PWA</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"Design Pattern Exercise Command Pattern\"</span><span class=\"token punctuation\">,</span> shortName <span class=\"token operator\">=</span> <span class=\"token string\">\"Command Pattern Exercise\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MainView</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">VerticalLayout</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">LinkedList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">TodoAction</span><span class=\"token punctuation\">></span></span> undoStack <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">LinkedList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">LinkedList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">TodoAction</span><span class=\"token punctuation\">></span></span> redoStack <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">LinkedList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">AtomicLong</span> todoIdGenerator <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AtomicLong</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">VerticalLayout</span> todosList <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">VerticalLayout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">TodoInput</span> todoInput <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TodoInput</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Button</span> undoButton <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Button</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Undo\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Button</span> redoButton <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Button</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Redo\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">MainView</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        todoInput<span class=\"token punctuation\">.</span><span class=\"token function\">addAddClickListener</span><span class=\"token punctuation\">(</span>event <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">final</span> <span class=\"token keyword\">long</span> todoId <span class=\"token operator\">=</span> todoIdGenerator<span class=\"token punctuation\">.</span><span class=\"token function\">incrementAndGet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> todoMessageBody <span class=\"token operator\">=</span> todoInput<span class=\"token punctuation\">.</span><span class=\"token function\">getTodoMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">final</span> <span class=\"token class-name\">TodoMessage</span> todoMessage <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TodoMessage</span><span class=\"token punctuation\">(</span>todoId<span class=\"token punctuation\">,</span> todoMessageBody<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">final</span> <span class=\"token class-name\">TodoAction</span> todoInsertAction <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TodoInsertAction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">StringUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">hasText</span><span class=\"token punctuation\">(</span>todoMessageBody<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token keyword\">final</span> <span class=\"token class-name\">TodoListElement</span> todoListElement <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TodoListElement</span><span class=\"token punctuation\">(</span>todoMessage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token keyword\">final</span> <span class=\"token class-name\">ComponentEventListener</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ClickEvent</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Icon</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> deleteListener <span class=\"token operator\">=</span> <span class=\"token function\">getDeleteClickListener</span><span class=\"token punctuation\">(</span>todoMessage<span class=\"token punctuation\">,</span> todoListElement<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                    todoListElement<span class=\"token punctuation\">.</span><span class=\"token function\">addDeleteClickListener</span><span class=\"token punctuation\">(</span>deleteListener<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    todosList<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>todoListElement<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">                    <span class=\"token keyword\">return</span> <span class=\"token class-name\">Optional</span><span class=\"token punctuation\">.</span><span class=\"token function\">ofNullable</span><span class=\"token punctuation\">(</span>todoMessage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>// &lt;2></span></span>                <span class=\"token punctuation\">}</span>\n<span class=\"gatsby-highlight-code-line\">                <span class=\"token keyword\">return</span> <span class=\"token class-name\">Optional</span><span class=\"token punctuation\">.</span><span class=\"token function\">empty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>// &lt;2></span></span>            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> undoTodoElement <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">                undoTodoElement<span class=\"token punctuation\">.</span><span class=\"token function\">ifPresent</span><span class=\"token punctuation\">(</span>actualUndoTodoElement <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>// &lt;1></span></span><span class=\"gatsby-highlight-code-line\">                    <span class=\"token function\">deleteByTodoId</span><span class=\"token punctuation\">(</span>actualUndoTodoElement<span class=\"token punctuation\">.</span><span class=\"token function\">getTodoId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>// &lt;1></span></span><span class=\"gatsby-highlight-code-line\">                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>// &lt;1></span></span>            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            todoInsertAction<span class=\"token punctuation\">.</span><span class=\"token function\">doIt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            undoStack<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>todoInsertAction<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        undoButton<span class=\"token punctuation\">.</span><span class=\"token function\">addClickListener</span><span class=\"token punctuation\">(</span>event <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        redoButton<span class=\"token punctuation\">.</span><span class=\"token function\">addClickListener</span><span class=\"token punctuation\">(</span>event <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">HorizontalLayout</span><span class=\"token punctuation\">(</span>undoButton<span class=\"token punctuation\">,</span> redoButton<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> todoInput<span class=\"token punctuation\">,</span> todosList<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">deleteByTodoId</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> targetTodoId<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        todosList<span class=\"token punctuation\">.</span><span class=\"token function\">getChildren</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>component <span class=\"token operator\">-></span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">TodoListElement</span><span class=\"token punctuation\">)</span> component<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>todoListElement <span class=\"token operator\">-></span> todoListElement<span class=\"token punctuation\">.</span><span class=\"token function\">getTodoId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>targetTodoId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">findFirst</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">ifPresent</span><span class=\"token punctuation\">(</span>todoListElement <span class=\"token operator\">-></span> todosList<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span>todoListElement<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">ComponentEventListener</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ClickEvent</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Icon</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getDeleteClickListener</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">TodoMessage</span> todoMessage<span class=\"token punctuation\">,</span> <span class=\"token class-name\">TodoListElement</span> todoListElement<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> deleteClick <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">final</span> <span class=\"token class-name\">TodoAction</span> todoDeleteAction <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TodoDeleteAction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n                <span class=\"token function\">deleteByTodoId</span><span class=\"token punctuation\">(</span>todoListElement<span class=\"token punctuation\">.</span><span class=\"token function\">getTodoId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">                <span class=\"token keyword\">return</span> todoMessage<span class=\"token punctuation\">;</span>// &lt;4></span></span>            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> undoTodoMessageBody <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">                <span class=\"token keyword\">final</span> <span class=\"token class-name\">TodoListElement</span> undoTodoListElement <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TodoListElement</span><span class=\"token punctuation\">(</span>todoMessage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>// &lt;3></span></span><span class=\"gatsby-highlight-code-line\">                <span class=\"token class-name\">ComponentEventListener</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ClickEvent</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Icon</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> deleteListener <span class=\"token operator\">=</span> <span class=\"token function\">getDeleteClickListener</span><span class=\"token punctuation\">(</span>undoTodoMessageBody<span class=\"token punctuation\">,</span> undoTodoListElement<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>// &lt;3></span></span>\n<span class=\"gatsby-highlight-code-line\">                undoTodoListElement<span class=\"token punctuation\">.</span><span class=\"token function\">addDeleteClickListener</span><span class=\"token punctuation\">(</span>deleteListener<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>// &lt;3></span></span><span class=\"gatsby-highlight-code-line\">                todosList<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>undoTodoListElement<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>// &lt;3></span></span>            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            todoDeleteAction<span class=\"token punctuation\">.</span><span class=\"token function\">doIt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            undoStack<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>todoDeleteAction<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>앞에 Command Pattern만 덩그러니 적용했던 코드에서 Undo, Redo를 위한 액션 클래스의 두번째 생성자 파라미터로 Undo 행위 요청 시 수행할 행위 함수를 받게 되었다.</p>\n<ul>\n<li>&#x3C;1> : Todo 추가 커맨드의 Undo 행위 요청 시 수행할 Todo 추가 Undo 행위 함수이다.</li>\n<li>&#x3C;2> : Todo 추가 시 이제는 추가한 todoMessage를 반환하고 있다. 이 TodoMessage는 TodoInsertAction 커맨드 객체에 상태로 관리된다. Command Pattern의 장점은 이렇게 행위와 상태를 한꺼번에 캡슐화 할 수 있다는 장점이 있다.</li>\n<li>&#x3C;3> : 역시 마찬가지로 Todo 삭제 커맨드의 Undo 행위 함수이다. (Todo 삭제의 undo는 Todo 추가)</li>\n<li>&#x3C;4> : Todo 삭제 커맨드도 마찬가지로 삭제한 TodoMessage를 액션의 상태로 관리하여 Undo에서 사용하게 된다.\n<br/>\n<br/></li>\n</ul>\n<p>그럼 이제 Undo, Redo 버튼을 클릭 시 스택에서 커맨드를 꺼내와 수행하는 코드를 작성해보자. Undo 과정은 다음과 같다.</p>\n<ol>\n<li>Undo 버튼 클릭 시 Undo 스택에 쌓인 커맨드를 하나 pop 한다.</li>\n<li>pop된 커맨드에서 undoIt() 메소드를 호출하여 Undo 행위를 수행한다.</li>\n<li>undo가 끝난 커맨드는 redo 스택에 push 한다. (redo에서 또 사용해야 하기 때문)\n<br/>\n<br/></li>\n</ol>\n<p>Redo 과정은 undo 과정에서 스택만 서로 바꾸면 된다. undo, redo 행위를 코드로 작성하면 다음과 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\">undoButton<span class=\"token punctuation\">.</span><span class=\"token function\">addClickListener</span><span class=\"token punctuation\">(</span>event <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>undoStack<span class=\"token punctuation\">.</span><span class=\"token function\">isEmpty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">final</span> <span class=\"token class-name\">TodoAction</span> todoAction <span class=\"token operator\">=</span> undoStack<span class=\"token punctuation\">.</span><span class=\"token function\">removeLast</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    todoAction<span class=\"token punctuation\">.</span><span class=\"token function\">undoIt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    redoStack<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>todoAction<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nredoButton<span class=\"token punctuation\">.</span><span class=\"token function\">addClickListener</span><span class=\"token punctuation\">(</span>event <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>redoStack<span class=\"token punctuation\">.</span><span class=\"token function\">isEmpty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">final</span> <span class=\"token class-name\">TodoAction</span> todoAction <span class=\"token operator\">=</span> redoStack<span class=\"token punctuation\">.</span><span class=\"token function\">removeLast</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    todoAction<span class=\"token punctuation\">.</span><span class=\"token function\">doIt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    undoStack<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>todoAction<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>이렇게 하면 Undo, Redo 기능을 수행할 수 있게 된다. 결과 화면은 다음과 같다.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3bdef0b4d3a7e3c7f177a3349e41408a/079dc/command-pattern-result.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 63.56026785714285%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAABF0lEQVQ4y2OQlpG3VVHTmK1naDxZSU1ziqS03BQRMUmisai41BQJabnJQH2zxCWlqxgmTZlWumvf4f/bd+39v3vvvv9bt+/4v3XbdqLwFiDetn3n/1179v8/cuzE/+UrVz5mePT4Se5/CPgBxL+A+DcZ+CfUjEsM16/fyPv1+8//t+/e//n0+cu/P3/+/P9NAoaq/wMy7dOnT1cZbt26lQfi/Pz5688/IACxoRTRAKgebODXr18RBgIB2ECYYaQYitdAqrvwPxmAbgb+/kc+ABv45cuXqwx37tyBGwjEf0EWkoHBBn7//v0Kw+XLlwvAqfrHj/+/fv0iC4P0gsDbt29vMLS2tqpMnjw5BogjgDiSTBwBNcMdAPrGhY3v1vwUAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"command pattern result\"\n        title=\"\"\n        src=\"/static/3bdef0b4d3a7e3c7f177a3349e41408a/b9e4f/command-pattern-result.png\"\n        srcset=\"/static/3bdef0b4d3a7e3c7f177a3349e41408a/cf440/command-pattern-result.png 148w,\n/static/3bdef0b4d3a7e3c7f177a3349e41408a/d2d38/command-pattern-result.png 295w,\n/static/3bdef0b4d3a7e3c7f177a3349e41408a/b9e4f/command-pattern-result.png 590w,\n/static/3bdef0b4d3a7e3c7f177a3349e41408a/f9b6a/command-pattern-result.png 885w,\n/static/3bdef0b4d3a7e3c7f177a3349e41408a/2d849/command-pattern-result.png 1180w,\n/static/3bdef0b4d3a7e3c7f177a3349e41408a/bbefa/command-pattern-result.png 1770w,\n/static/3bdef0b4d3a7e3c7f177a3349e41408a/079dc/command-pattern-result.png 3584w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h4>Command Pattern을 적용한 Todo App 전체 코드</h4>\n<ul>\n<li><a href=\"https://github.com/icednut/vaadin-todo-app/tree/step-3-command-pattern-without-mediator\">https://github.com/icednut/vaadin-todo-app/tree/step-3-command-pattern-without-mediator</a></li>\n<li>공부를 위해 일부러 Mediator Pattern을 제외하고 Command Pattern만 적용하였다. 추후 Mediator + Command Pattern 코드도 작성해보자.\n<br/>\n<br/>\n<br/></li>\n</ul>\n<hr>\n<h2>Command Pattern 정리</h2>\n<h3>특징</h3>\n<ul>\n<li>요청 혹은 작업의 단위를 객체로 캡슐화한다.〔001013001는 객체가 상태 정보를 저장할 수 있고，큐잉되거나 로 깅될 수 있다는 면에서 0 언어의 함수 포인터보다 막강한 기능을 제공한다</li>\n</ul>\n<h3>어떤 문제를 해결하는가?</h3>\n<ul>\n<li>트랜잭션 처리 구현 시 트랜잭션 단위를 커맨드 클래스로 정의</li>\n<li>Undo 기능 구현</li>\n<li>멀티 스레드에서 콜백을 감싸는 Thread가 대표적인 커맨트 패턴 사용 예</li>\n</ul>\n<h3>구조</h3>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ddffbfc24b7d4d837e3e02a4b0034bb5/93430/command-pattern-diagram.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 92.85714285714286%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAABYlAAAWJQFJUiTwAAAC4UlEQVQ4yz2U3UuyQRDFn///PoICuwhSRDOLsqwktNS0TFMrK838KNMsM+1DiPPym5f1YtnH3dmZc86c0avX67q6utLNzY2ur691e3urh4cH3d3d2W/OiWHd39/bOd/c8f34+KhGo2Fv2D0+Tk9PdXZ2pmq1qp2dHS0uLmpzc1OXl5e6uLiwO+KOj4+VSCRsUSiTyWh3d1fNZlO9Xs+W1263lUwmFQqFtLGxofX1da2trSkWi+ng4EDn5+c6OTlRq9USsbBJp9MqlUpWIBgMKp/PW8Gnpyd5ZM9ms5ZkdXVVKysrCofDFry1taWXlxejNRqN9PPzo9/fX43HY7uDBRJBHzleX1/ldbtd5XI5LSwsGDqqHx0dqVAoGHICqd7pdAwJNIvFolEmGUlms5kGg8H/hPAul8umHdQ4HA6Hhoy93+/bvWsKeu7t7VlSkLPQmZ14j8roEQgETFwe84gzvkFCUeh+fX3p/f3dvt/e3uwcZHQbANx5ZIYSFAn8+PgwjSaTiQU8Pz8bSveYc/RkR09QkXw6ndru0T0WVT4/P+2QRTIScAcLOsxvEkAf7ZGHYgAACPeGkOBarWawCXKJCQQNSRxi4g4PD+X3+7W9vW1exS5zhFTH0HgulUpZF9GNQOyAHGgLku/vb9M2Ho+boYnHl4BCX2sKGjEpXOLHaDSqSCRi9sHUoKCrNIiHOAF0FCSBk4yEFDUf4i83JQTzCHRoUqlUjLprAOfcwwrESOJcMKcMDZ/Pp+XlZS0tLVly0OE7Bh4W6IeBeURiTE0Mi/cknU8KdKDK+DH4jB3iU5UHmJ4YipOcIsQxerBys86dR4cIxocITGU3lyBBK77pItag26DhT4FGMrYUR19c4rn/M6wDAvev4saKMzTESiRz07K/v2/2ocjf358VtUnBFs7p7qF7zBnCk4SdhY48hBHMQEv8fPRwPbSgSwfZWZy5fxQWk4QUbsEKBngUVlgGif4BE4VFO3twrkIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"command pattern diagram\"\n        title=\"\"\n        src=\"/static/ddffbfc24b7d4d837e3e02a4b0034bb5/b9e4f/command-pattern-diagram.png\"\n        srcset=\"/static/ddffbfc24b7d4d837e3e02a4b0034bb5/cf440/command-pattern-diagram.png 148w,\n/static/ddffbfc24b7d4d837e3e02a4b0034bb5/d2d38/command-pattern-diagram.png 295w,\n/static/ddffbfc24b7d4d837e3e02a4b0034bb5/b9e4f/command-pattern-diagram.png 590w,\n/static/ddffbfc24b7d4d837e3e02a4b0034bb5/93430/command-pattern-diagram.png 784w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h3>참여자</h3>\n<ul>\n<li>Command</li>\n<li>Concrete Command</li>\n<li>Invoker</li>\n<li>Receiver</li>\n</ul>","frontmatter":{"title":"Todo 앱을 통한 Command Pattern의 이해 (with Java, Vaadin)","date":"2019-09-02 12:05:58","tags":["java","vaadin","design pattern","command pattern"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2019/09/02/20190902-command-pattern/","previous":{"fields":{"slug":"/2019/09/01/20190901-mediator-pattern/"},"frontmatter":{"title":"Todo 앱을 통한 Mediator Pattern의 이해 (with Java, Vaadin)"}},"next":{"fields":{"slug":"/2019/09/03/20190903-memento-pattern/"},"frontmatter":{"title":"Todo 앱을 통한 Memento Pattern의 이해 (with Java, Vaadin)"}}}}