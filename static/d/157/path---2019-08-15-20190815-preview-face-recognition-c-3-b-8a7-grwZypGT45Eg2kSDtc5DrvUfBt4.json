{"data":{"site":{"siteMetadata":{"title":"Icednut's Notes","author":"Will Lee","siteUrl":"https://icednut.github.io"}},"markdownRemark":{"id":"f00acd5c-463a-59e2-9132-1f8cf4286bea","excerpt":"아래 내용은 PyCon 2019 파이썬으로 얼굴 인식 알고리즘 구현하기 튜토리얼(https://www.pycon.kr/program/tutorial-detail?id=16…","html":"<p>아래 내용은 PyCon 2019 파이썬으로 얼굴 인식 알고리즘 구현하기 튜토리얼(<a href=\"https://www.pycon.kr/program/tutorial-detail?id=161\">https://www.pycon.kr/program/tutorial-detail?id=161</a>)을 듣고 정리한 자료 입니다.\n<br/>\n<br/>\n<br/></p>\n<h3>컴퓨터 머신의 얼굴 인식 과정</h3>\n<p>일반적으로 머신에서의 얼굴 인식 과정은 다음과 같다고 한다.</p>\n<ol>\n<li>Face Detection</li>\n<li>Processing</li>\n<li>Feature Extraction</li>\n<li>Face Matching</li>\n</ol>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/07deb2548fa697e482a9790e44222158/64ca1/03.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 85.64049586776858%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAARABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIBBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHp1eJqytCwf//EABkQAAMBAQEAAAAAAAAAAAAAAAECEgAxIf/aAAgBAQABBQKn1OSpbe29ShMnrYc//8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPwEf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwEf/8QAGxAAAQQDAAAAAAAAAAAAAAAAAAEgISIxYXH/2gAIAQEABj8CWvBKwYNEEs//xAAbEAADAAMBAQAAAAAAAAAAAAAAAREhMUEQYf/aAAgBAQABPyFze6mIOqWSLMZNwf6bzYwjVJ+XBoP/2gAMAwEAAgADAAAAEI/AAP/EABcRAAMBAAAAAAAAAAAAAAAAAAABEDH/2gAIAQMBAT8QZt//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/EB//xAAdEAEAAgICAwAAAAAAAAAAAAABABEhMUFhUaHB/9oACAEBAAE/ECPoBbF5SXNVVvD4iXrIAziFbsq6vUJt6B8RsQ4L133Ns1j0Cf/Z'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"03\"\n        title=\"\"\n        src=\"/static/07deb2548fa697e482a9790e44222158/c739e/03.jpg\"\n        srcset=\"/static/07deb2548fa697e482a9790e44222158/8ee9c/03.jpg 148w,\n/static/07deb2548fa697e482a9790e44222158/ebbe7/03.jpg 295w,\n/static/07deb2548fa697e482a9790e44222158/c739e/03.jpg 590w,\n/static/07deb2548fa697e482a9790e44222158/5413e/03.jpg 885w,\n/static/07deb2548fa697e482a9790e44222158/4efde/03.jpg 1180w,\n/static/07deb2548fa697e482a9790e44222158/abfc3/03.jpg 1770w,\n/static/07deb2548fa697e482a9790e44222158/64ca1/03.jpg 1936w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>얼굴 인식 과정을 코드를 보면서 진행해보자.</p>\n<h4>1. Face Detection</h4>\n<p>Face Detection이란 이미지에서 얼굴을 찾아내는 과정을 말하는데 Face Detection 알고리즘으로는 MTCNN이 성능이 좋다고 한다. MTCNN 외 Detection 알고리즘은 다음과 같다.</p>\n<p>Detection Only</p>\n<ul>\n<li>Open-CV (dnn, haar)</li>\n<li>dlib (hog, cnn)</li>\n<li>face_recognition</li>\n</ul>\n<p>Detection + Alignment</p>\n<ul>\n<li>MTCNN</li>\n</ul>\n<p>Face Detection을 코드로 구현하기 위해 Google Drive에 적당한 위치에 <code class=\"language-text\">face_detection.ipynb</code> 파일을 생성한 뒤 아래 코드들을 추가한다. ipynb 파일은 colab 앱과 연동해야 한다. google drive에 colab 연동이 완료되면 아래와 같이 주피터처럼 코딩할 수 있게 된다.\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8b102cacd2c324a27a47503b46fc2d7e/13ead/06-1.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 28.51190476190476%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAGABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAIF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB26AD/8QAFRABAQAAAAAAAAAAAAAAAAAAARD/2gAIAQEAAQUCG//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAABD/2gAIAQEABj8Cf//EABYQAQEBAAAAAAAAAAAAAAAAAAABEf/aAAgBAQABPyHVqx//2gAMAwEAAgADAAAAEPgP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFREBAQAAAAAAAAAAAAAAAAAAEBH/2gAIAQIBAT8Qh//EABkQAQADAQEAAAAAAAAAAAAAAAEAESExYf/aAAgBAQABPxAghdncIe2aT//Z'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"06 1\"\n        title=\"\"\n        src=\"/static/8b102cacd2c324a27a47503b46fc2d7e/c739e/06-1.jpg\"\n        srcset=\"/static/8b102cacd2c324a27a47503b46fc2d7e/8ee9c/06-1.jpg 148w,\n/static/8b102cacd2c324a27a47503b46fc2d7e/ebbe7/06-1.jpg 295w,\n/static/8b102cacd2c324a27a47503b46fc2d7e/c739e/06-1.jpg 590w,\n/static/8b102cacd2c324a27a47503b46fc2d7e/5413e/06-1.jpg 885w,\n/static/8b102cacd2c324a27a47503b46fc2d7e/4efde/06-1.jpg 1180w,\n/static/8b102cacd2c324a27a47503b46fc2d7e/abfc3/06-1.jpg 1770w,\n/static/8b102cacd2c324a27a47503b46fc2d7e/13ead/06-1.jpg 3360w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h5>구글 드라이브와 colab 연동</h5>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">from</span> google<span class=\"token punctuation\">.</span>colab <span class=\"token keyword\">import</span> drive\ndrive<span class=\"token punctuation\">.</span>mount<span class=\"token punctuation\">(</span><span class=\"token string\">'/colab'</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<h5>Face Detection을 위해 mtcnn과 face_recognition 설치</h5>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">!pip install mtcnn\n!pip install face_recognition</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<h5>face_recognition을 이용하여 얼굴 인식하기</h5>\n<p>먼저 얼굴 인식 진행을 하기 전에 Google Drive의 홈 디렉토리 밑에 COLAB/face<em>tutorial 폴더를 생성한다. 그런 뒤 face</em>tutorial 디렉토리 밑에 bts 폴더를 생성한 뒤 bts 멤버들의 사진을 위치시킨다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">COLAB\n  ㄴ face_tutorial\n      ㄴ bts\n          ㄴ 1.jpg\n          ㄴ 2.jpg\n          ㄴ 3.jpg\n          ㄴ 4.jpg</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\">IDOL_LIST <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"title\"</span><span class=\"token punctuation\">:</span><span class=\"token string\">\"BTS\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"members\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"뷔\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"슈가\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"진\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"정국\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"RM\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"지민\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"제이홉\"</span><span class=\"token punctuation\">]</span>\n\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span>\nDRIVE_BASE_PATH <span class=\"token operator\">=</span> <span class=\"token string\">\"/colab/My Drive/COLAB/face_tutorial\"</span>\n\n<span class=\"token keyword\">import</span> os\n<span class=\"token keyword\">from</span> IPython<span class=\"token punctuation\">.</span>display <span class=\"token keyword\">import</span> Image<span class=\"token punctuation\">,</span> display\n<span class=\"token keyword\">import</span> cv2\n<span class=\"token keyword\">import</span> face_recognition\n\npath<span class=\"token punctuation\">,</span> dirs<span class=\"token punctuation\">,</span> files <span class=\"token operator\">=</span> <span class=\"token builtin\">next</span><span class=\"token punctuation\">(</span>os<span class=\"token punctuation\">.</span>walk<span class=\"token punctuation\">(</span>DRIVE_BASE_PATH<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\nimage_path <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>DRIVE_BASE_PATH<span class=\"token punctuation\">,</span> <span class=\"token string\">\"bts\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"1.jpg\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># 이렇게 하면 미리 준비한 bts 이미지 경로를 인식할 수 있게 된다.</span>\n\nimage <span class=\"token operator\">=</span> face_recognition<span class=\"token punctuation\">.</span>load_image_file<span class=\"token punctuation\">(</span>image_path<span class=\"token punctuation\">)</span>\n\n<span class=\"gatsby-highlight-code-line\">face_locations <span class=\"token operator\">=</span> face_recognition<span class=\"token punctuation\">.</span>face_locations<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">)</span></span>\n<span class=\"token comment\"># 이미지의 얼굴 영역에 녹색 사각형을 표시하기 위한 코드</span>\nrgb <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>cvtColor<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> cv2<span class=\"token punctuation\">.</span>COLOR_BGR2RGB<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>top<span class=\"token punctuation\">,</span> right<span class=\"token punctuation\">,</span> bottom<span class=\"token punctuation\">,</span> left<span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span> face_locations<span class=\"token punctuation\">:</span>\n    cv2<span class=\"token punctuation\">.</span>rectangle<span class=\"token punctuation\">(</span>rgb<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>left<span class=\"token punctuation\">,</span> top<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>right<span class=\"token punctuation\">,</span> bottom<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n\nsave_path <span class=\"token operator\">=</span> <span class=\"token string\">\"000001_face1.jpg\"</span>\ncv2<span class=\"token punctuation\">.</span>imwrite<span class=\"token punctuation\">(</span>save_path<span class=\"token punctuation\">,</span> rgb<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 얼굴이 인식된 이미지를 화면에 출력한다.</span>\ndisplay<span class=\"token punctuation\">(</span>Image<span class=\"token punctuation\">(</span>filename<span class=\"token operator\">=</span>save_path<span class=\"token punctuation\">,</span> width<span class=\"token operator\">=</span><span class=\"token number\">800</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bae2039ff9f5a8c11b34412010d37c99/9eb7e/05.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 88.34586466165413%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAASABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAQDAv/EABYBAQEBAAAAAAAAAAAAAAAAAAABAv/aAAwDAQACEAMQAAABsn7y1mhINtQ7Ev8A/8QAHRAAAgEEAwAAAAAAAAAAAAAAAQIAAxESIhMxMv/aAAgBAQABBQKZFTcwbFw3JukYDCh3X9//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AR//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAcEAABBAMBAAAAAAAAAAAAAAARAAECIRASMXH/2gAIAQEABj8Cq3XO9bDsQpa2QgHUVLzH/8QAHRAAAgMAAgMAAAAAAAAAAAAAAREAIUExUXGRsf/aAAgBAQABPyEk2oBjiUKCxIeoDYPcXJrIqVA4I+o1kZh+JxIXzKKwp8Z//9oADAMBAAIAAwAAABDz6H7/xAAXEQEAAwAAAAAAAAAAAAAAAAAAEBFB/9oACAEDAQE/EFNj/8QAFxEBAAMAAAAAAAAAAAAAAAAAAAEQQf/aAAgBAgEBPxCsQ//EAB4QAAICAgMBAQAAAAAAAAAAAAERACExQVFxwWGB/9oACAEBAAE/ECkIF0LuM6jUEHgeiDBDKyiFoQCH9uE/DLIlkb9hbFwA8Eb5auENEgoYYX4oxXZFmtwUqAALViYuvs//2Q=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"05\"\n        title=\"\"\n        src=\"/static/bae2039ff9f5a8c11b34412010d37c99/c739e/05.jpg\"\n        srcset=\"/static/bae2039ff9f5a8c11b34412010d37c99/8ee9c/05.jpg 148w,\n/static/bae2039ff9f5a8c11b34412010d37c99/ebbe7/05.jpg 295w,\n/static/bae2039ff9f5a8c11b34412010d37c99/c739e/05.jpg 590w,\n/static/bae2039ff9f5a8c11b34412010d37c99/5413e/05.jpg 885w,\n/static/bae2039ff9f5a8c11b34412010d37c99/4efde/05.jpg 1180w,\n/static/bae2039ff9f5a8c11b34412010d37c99/9eb7e/05.jpg 1596w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h5>CNN을 이용한 얼굴 인식 방식</h5>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\">image <span class=\"token operator\">=</span> face_recognition<span class=\"token punctuation\">.</span>load_image_file<span class=\"token punctuation\">(</span>image_path<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 앞의 코드와 비슷한데 model 파라미터 부분에 cnn 이라고 명시했다.</span>\n<span class=\"gatsby-highlight-code-line\">face_locations <span class=\"token operator\">=</span> face_recognition<span class=\"token punctuation\">.</span>face_locations<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> model<span class=\"token operator\">=</span><span class=\"token string\">\"cnn\"</span><span class=\"token punctuation\">)</span></span>\nrgb <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>cvtColor<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> cv2<span class=\"token punctuation\">.</span>COLOR_BGR2RGB<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>top<span class=\"token punctuation\">,</span> right<span class=\"token punctuation\">,</span> bottom<span class=\"token punctuation\">,</span> left<span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span> face_locations<span class=\"token punctuation\">:</span>\n    cv2<span class=\"token punctuation\">.</span>rectangle<span class=\"token punctuation\">(</span>rgb<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>left<span class=\"token punctuation\">,</span> top<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>right<span class=\"token punctuation\">,</span> bottom<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n\nsave_path <span class=\"token operator\">=</span> <span class=\"token string\">\"000001_face2.jpg\"</span>\ncv2<span class=\"token punctuation\">.</span>imwrite<span class=\"token punctuation\">(</span>save_path<span class=\"token punctuation\">,</span> rgb<span class=\"token punctuation\">)</span>\n\ndisplay<span class=\"token punctuation\">(</span>Image<span class=\"token punctuation\">(</span>filename<span class=\"token operator\">=</span>save_path<span class=\"token punctuation\">,</span> width<span class=\"token operator\">=</span><span class=\"token number\">800</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bae2039ff9f5a8c11b34412010d37c99/9eb7e/05.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 88.34586466165413%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAASABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAQDAv/EABYBAQEBAAAAAAAAAAAAAAAAAAABAv/aAAwDAQACEAMQAAABsn7y1mhINtQ7Ev8A/8QAHRAAAgEEAwAAAAAAAAAAAAAAAQIAAxESIhMxMv/aAAgBAQABBQKZFTcwbFw3JukYDCh3X9//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AR//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAcEAABBAMBAAAAAAAAAAAAAAARAAECIRASMXH/2gAIAQEABj8Cq3XO9bDsQpa2QgHUVLzH/8QAHRAAAgMAAgMAAAAAAAAAAAAAAREAIUExUXGRsf/aAAgBAQABPyEk2oBjiUKCxIeoDYPcXJrIqVA4I+o1kZh+JxIXzKKwp8Z//9oADAMBAAIAAwAAABDz6H7/xAAXEQEAAwAAAAAAAAAAAAAAAAAAEBFB/9oACAEDAQE/EFNj/8QAFxEBAAMAAAAAAAAAAAAAAAAAAAEQQf/aAAgBAgEBPxCsQ//EAB4QAAICAgMBAQAAAAAAAAAAAAERACExQVFxwWGB/9oACAEBAAE/ECkIF0LuM6jUEHgeiDBDKyiFoQCH9uE/DLIlkb9hbFwA8Eb5auENEgoYYX4oxXZFmtwUqAALViYuvs//2Q=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"05\"\n        title=\"\"\n        src=\"/static/bae2039ff9f5a8c11b34412010d37c99/c739e/05.jpg\"\n        srcset=\"/static/bae2039ff9f5a8c11b34412010d37c99/8ee9c/05.jpg 148w,\n/static/bae2039ff9f5a8c11b34412010d37c99/ebbe7/05.jpg 295w,\n/static/bae2039ff9f5a8c11b34412010d37c99/c739e/05.jpg 590w,\n/static/bae2039ff9f5a8c11b34412010d37c99/5413e/05.jpg 885w,\n/static/bae2039ff9f5a8c11b34412010d37c99/4efde/05.jpg 1180w,\n/static/bae2039ff9f5a8c11b34412010d37c99/9eb7e/05.jpg 1596w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h5>MTCNN을 이용한 얼굴 인식 방식</h5>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">from</span> mtcnn<span class=\"token punctuation\">.</span>mtcnn <span class=\"token keyword\">import</span> MTCNN\n\ndetector <span class=\"token operator\">=</span> MTCNN<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\nimage <span class=\"token operator\">=</span> face_recognition<span class=\"token punctuation\">.</span>load_image_file<span class=\"token punctuation\">(</span>image_path<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># MTCNN 모델로 얼굴 인식을 수행했다.</span>\n<span class=\"gatsby-highlight-code-line\">results <span class=\"token operator\">=</span> detector<span class=\"token punctuation\">.</span>detect_faces<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">)</span></span>\n<span class=\"token keyword\">for</span> result <span class=\"token keyword\">in</span> results<span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span>\n\n    bounding_box <span class=\"token operator\">=</span> result<span class=\"token punctuation\">[</span><span class=\"token string\">'box'</span><span class=\"token punctuation\">]</span>\n    keypoints <span class=\"token operator\">=</span> result<span class=\"token punctuation\">[</span><span class=\"token string\">'keypoints'</span><span class=\"token punctuation\">]</span>\n    \n    <span class=\"token comment\"># 1. 얼굴 위치 표시</span>\n    cv2<span class=\"token punctuation\">.</span>rectangle<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span>\n                  <span class=\"token punctuation\">(</span>bounding_box<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> bounding_box<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                  <span class=\"token punctuation\">(</span>bounding_box<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token operator\">+</span>bounding_box<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> bounding_box<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span> bounding_box<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                  <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">155</span><span class=\"token punctuation\">,</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n    \n    <span class=\"token comment\"># 2. 주요 부분 landmark 표시</span>\n    cv2<span class=\"token punctuation\">.</span>circle<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span>keypoints<span class=\"token punctuation\">[</span><span class=\"token string\">'left_eye'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">155</span><span class=\"token punctuation\">,</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n    cv2<span class=\"token punctuation\">.</span>circle<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span>keypoints<span class=\"token punctuation\">[</span><span class=\"token string\">'right_eye'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">155</span><span class=\"token punctuation\">,</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n    cv2<span class=\"token punctuation\">.</span>circle<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span>keypoints<span class=\"token punctuation\">[</span><span class=\"token string\">'nose'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">155</span><span class=\"token punctuation\">,</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n    cv2<span class=\"token punctuation\">.</span>circle<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span>keypoints<span class=\"token punctuation\">[</span><span class=\"token string\">'mouth_left'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">155</span><span class=\"token punctuation\">,</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n    cv2<span class=\"token punctuation\">.</span>circle<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span>keypoints<span class=\"token punctuation\">[</span><span class=\"token string\">'mouth_right'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">155</span><span class=\"token punctuation\">,</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n    \nsave_path <span class=\"token operator\">=</span> <span class=\"token string\">\"000001_face3.jpg\"</span>\nimage <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>cvtColor<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> cv2<span class=\"token punctuation\">.</span>COLOR_BGR2RGB<span class=\"token punctuation\">)</span>\ncv2<span class=\"token punctuation\">.</span>imwrite<span class=\"token punctuation\">(</span>save_path<span class=\"token punctuation\">,</span> image<span class=\"token punctuation\">)</span>\n\ndisplay<span class=\"token punctuation\">(</span>Image<span class=\"token punctuation\">(</span>filename<span class=\"token operator\">=</span>save_path<span class=\"token punctuation\">,</span> width<span class=\"token operator\">=</span><span class=\"token number\">1024</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>MTCNN은 얼굴영역 인식 뿐만 아니라 눈코입의 위치도 파악할 수 있다.\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1da76e409672e4c9f1509b2363740664/2e036/04.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 79.29342492639844%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAQABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAABAAD/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAL/2gAMAwEAAhADEAAAAWG0yqURY//EABkQAAMBAQEAAAAAAAAAAAAAAAABAhEDI//aAAgBAQABBQI1zSbFlOpp36cz/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGxAAAwACAwAAAAAAAAAAAAAAAAERIUECEiL/2gAIAQEABj8C85Zq7Roabhy6ZsJKf//EABoQAQEBAAMBAAAAAAAAAAAAAAERACFBcTH/2gAIAQEAAT8hVaQHV04gVfLILimVOWzdRLl94yQpRfN//9oADAMBAAIAAwAAABBbL//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAEDAQE/EEf/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAdEAEAAgIDAQEAAAAAAAAAAAABESEAcTFBUYGx/9oACAEBAAE/ELVUCuG4xa57DF+G+kyXCDCQvCCfuOqsBZZ3vIo2gkECEXcXg6xCqHiPkZ//2Q=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"04\"\n        title=\"\"\n        src=\"/static/1da76e409672e4c9f1509b2363740664/c739e/04.jpg\"\n        srcset=\"/static/1da76e409672e4c9f1509b2363740664/8ee9c/04.jpg 148w,\n/static/1da76e409672e4c9f1509b2363740664/ebbe7/04.jpg 295w,\n/static/1da76e409672e4c9f1509b2363740664/c739e/04.jpg 590w,\n/static/1da76e409672e4c9f1509b2363740664/5413e/04.jpg 885w,\n/static/1da76e409672e4c9f1509b2363740664/4efde/04.jpg 1180w,\n/static/1da76e409672e4c9f1509b2363740664/abfc3/04.jpg 1770w,\n/static/1da76e409672e4c9f1509b2363740664/2e036/04.jpg 2038w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h4>3. Feature Extraction</h4>\n<p>얼굴 판별을 위해 얼굴 이미지에서 특징(Feature) 추출해야 한다. 이렇게 특정인에 대해 피처를 추출하여 벡터화 한 뒤 다른 사람과의 벡터와 거리 계산을 해보면 얼굴이 닮지 않을 수록 거리 값이 1에 가깝게 나온다. 이런 식으로 피처 추출 및 얼굴을 사람별로 분류하는 알고리즘으로는 대표적으로 FaceNet과 Arcface가 성능이 좋다고 알려져 있다.</p>\n<p>FaceNet의 특징</p>\n<ul>\n<li>Triplet Loss를 이용하여 이미지를 공간 벡터에 투영(Embadding)하여 학습</li>\n<li>128차원의 피처를 추출, 벡터에 임베딩하여 벡터의 거리를 Euclidean Distance를 이용하여 가장 가까운 거리의 데이터를 찾는 방식</li>\n<li>피처 벡터는 t-SNE 시각화 알고리즘을 통해 2차원 공간에 표시할 수 있음</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">import</span> pickle\n<span class=\"token keyword\">import</span> cv2\n<span class=\"token keyword\">import</span> shutil\n<span class=\"token keyword\">import</span> numpy <span class=\"token keyword\">as</span> np\n\n<span class=\"token comment\"># 임베딩값을 보고 중앙에 위치한 순서대로 리턴 (그 인물인 가능성이 높은 순서대로)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">get_sorted_embedding_list</span><span class=\"token punctuation\">(</span>face_dict<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n    <span class=\"token comment\"># 1. distance_sqrt 구하기        </span>\n    embedding_list <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">for</span> <span class=\"token builtin\">file</span><span class=\"token punctuation\">,</span> val <span class=\"token keyword\">in</span> face_dict<span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        embedding <span class=\"token operator\">=</span> val<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"embedding\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n        embedding_list<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n            <span class=\"token string\">\"file\"</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">file</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"embedding\"</span><span class=\"token punctuation\">:</span> embedding\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n\n    <span class=\"token keyword\">for</span> i<span class=\"token punctuation\">,</span> embedding_dict1 <span class=\"token keyword\">in</span> <span class=\"token builtin\">enumerate</span><span class=\"token punctuation\">(</span>embedding_list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        embedding1 <span class=\"token operator\">=</span> embedding_dict1<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"embedding\"</span><span class=\"token punctuation\">)</span>\n        distance_sum <span class=\"token operator\">=</span> <span class=\"token number\">0</span> \n        <span class=\"token keyword\">for</span> j<span class=\"token punctuation\">,</span> embedding_dict2 <span class=\"token keyword\">in</span> <span class=\"token builtin\">enumerate</span><span class=\"token punctuation\">(</span>embedding_list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            embedding2 <span class=\"token operator\">=</span> embedding_dict2<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"embedding\"</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">if</span> i <span class=\"token operator\">==</span> j<span class=\"token punctuation\">:</span>\n                <span class=\"token keyword\">continue</span>\n            distance <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>linalg<span class=\"token punctuation\">.</span>norm<span class=\"token punctuation\">(</span>embedding2 <span class=\"token operator\">-</span> embedding1<span class=\"token punctuation\">)</span>\n            distance_sum <span class=\"token operator\">+=</span> distance <span class=\"token operator\">*</span> distance\n        embedding_dict1<span class=\"token punctuation\">[</span><span class=\"token string\">\"distance_sqrt\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>sqrt<span class=\"token punctuation\">(</span>distance_sum<span class=\"token punctuation\">)</span>\n\n\n    <span class=\"token comment\"># 2. distance_sqrt 기준으로 역순 정렬 (최대값 구하기)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token builtin\">sorted</span><span class=\"token punctuation\">(</span>embedding_list<span class=\"token punctuation\">,</span> key<span class=\"token operator\">=</span><span class=\"token keyword\">lambda</span> x<span class=\"token punctuation\">:</span> x<span class=\"token punctuation\">[</span><span class=\"token string\">\"distance_sqrt\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> reverse<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span>\n\nBASE_PATH <span class=\"token operator\">=</span> <span class=\"token string\">\"data2\"</span>\n\nidol_list <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>listdir<span class=\"token punctuation\">(</span>BASE_PATH<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> idol <span class=\"token keyword\">in</span> idol_list<span class=\"token punctuation\">:</span>\n    idol_path <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>BASE_PATH<span class=\"token punctuation\">,</span> idol<span class=\"token punctuation\">)</span>\n    \n    <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>isdir<span class=\"token punctuation\">(</span>idol_path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">continue</span>\n\n    valid_embedding_dict <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    member_list <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>listdir<span class=\"token punctuation\">(</span>idol_path<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">for</span> member_file <span class=\"token keyword\">in</span> member_list<span class=\"token punctuation\">:</span>\n        member <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>splitext<span class=\"token punctuation\">(</span>member_file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n        pickle_path <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>idol_path<span class=\"token punctuation\">,</span> member_file<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>          \n          <span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span>pickle_path<span class=\"token punctuation\">,</span> <span class=\"token string\">'rb'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> f<span class=\"token punctuation\">:</span>\n              face_dict <span class=\"token operator\">=</span> pickle<span class=\"token punctuation\">.</span>load<span class=\"token punctuation\">(</span>f<span class=\"token punctuation\">)</span>\n\n          sorted_embedding_list <span class=\"token operator\">=</span> get_sorted_embedding_list<span class=\"token punctuation\">(</span>face_dict<span class=\"token punctuation\">)</span>\n\n          <span class=\"token comment\"># 1~50위까지의 파일만 유효하다고 보고 valid 폴더로 이동</span>\n\n          <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>sorted_embedding_list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n          <span class=\"token comment\"># 구글에서 검색 결과중 얼굴이 1개만 인식되는 데이터가 50개 이상은 되어야함</span>\n          <span class=\"token keyword\">assert</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>sorted_embedding_list<span class=\"token punctuation\">)</span> <span class=\"token operator\">>=</span> <span class=\"token number\">50</span>\n\n          valid_embedding_list <span class=\"token operator\">=</span> sorted_embedding_list<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token number\">50</span><span class=\"token punctuation\">]</span>\n          valid_embedding_dict<span class=\"token punctuation\">[</span>member<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> valid_embedding_list\n        <span class=\"token keyword\">except</span> Exception <span class=\"token keyword\">as</span> ex<span class=\"token punctuation\">:</span>\n          <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>ex<span class=\"token punctuation\">)</span>\n          <span class=\"token keyword\">continue</span>\n\n    \n    <span class=\"token comment\"># valid 폴더로 이동한 파일 정보를 별도로 저장해둠</span>\n    save_path <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>BASE_PATH<span class=\"token punctuation\">,</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"valid_embedding_</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>idol<span class=\"token punctuation\">}</span></span><span class=\"token string\">.pkl\"</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span>save_path<span class=\"token punctuation\">,</span> <span class=\"token string\">'wb'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> f<span class=\"token punctuation\">:</span>            \n        pickle<span class=\"token punctuation\">.</span>dump<span class=\"token punctuation\">(</span>valid_embedding_dict<span class=\"token punctuation\">,</span> f<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ad2bb75a433378d3d4d2c59e32c57ccb/73fa1/02.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 60.969387755102034%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAMABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAIDAQX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHtLVShgf/EABkQAQADAQEAAAAAAAAAAAAAAAEAAiEQEf/aAAgBAQABBQJMqPGV08J//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGRAAAQUAAAAAAAAAAAAAAAAAAAERICKB/9oACAEBAAY/AlLNkf/EABsQAAICAwEAAAAAAAAAAAAAAAARATEhQWFx/9oACAEBAAE/IWoT1ZFdfoZSck2M4Qf/2gAMAwEAAgADAAAAED/P/8QAFhEBAQEAAAAAAAAAAAAAAAAAERAh/9oACAEDAQE/EEyf/8QAFhEAAwAAAAAAAAAAAAAAAAAAEBFB/9oACAECAQE/EIh//8QAHRABAAICAgMAAAAAAAAAAAAAAQARIUExUYGx8f/aAAgBAQABPxBigNtpQdNbiQTfQe4BLEZczMp4jY1L41PlT//Z'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"02\"\n        title=\"\"\n        src=\"/static/ad2bb75a433378d3d4d2c59e32c57ccb/c739e/02.jpg\"\n        srcset=\"/static/ad2bb75a433378d3d4d2c59e32c57ccb/8ee9c/02.jpg 148w,\n/static/ad2bb75a433378d3d4d2c59e32c57ccb/ebbe7/02.jpg 295w,\n/static/ad2bb75a433378d3d4d2c59e32c57ccb/c739e/02.jpg 590w,\n/static/ad2bb75a433378d3d4d2c59e32c57ccb/5413e/02.jpg 885w,\n/static/ad2bb75a433378d3d4d2c59e32c57ccb/4efde/02.jpg 1180w,\n/static/ad2bb75a433378d3d4d2c59e32c57ccb/abfc3/02.jpg 1770w,\n/static/ad2bb75a433378d3d4d2c59e32c57ccb/73fa1/02.jpg 2352w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h4>4. Face Matching</h4>\n<p>FaceNet을 통해 피처 벡터 추출 및 분류 학습을 시켜 모델을 준비하면 이제는 예측을 할 차례다. 여기서는 이런 작업을 Face Matching 이라고 부른다. FaceNet으로 추출한 Feature는 SVM으로 분류 학습을 진행한다.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4133d93f78d413ed170f094d39322175/80b4e/01.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 62.686567164179095%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAACSklEQVQ4y32Ty6vTQBTG+7+58D9w71JwIbh3J4Ig7gRFEBUUXHhdqChccKMoyIVKbe3tI32laZMmmUdeM0mTzzNpbx93cQcOmSQzv/nOOd80QKOqKhyONM3gOHNY1hD9fr+OyWSCfq+H4XAI3/ex31fhcHvjAqa1JlC6XbiGlBkEjxDHEc0lXNdFFJn3GFmmaD22sGMxO6AQHIyxel4UJYiDLN0vXLpLFGVez3OCcVZhvd5DL7h7hbmC7U4hFIPnixqW53tgwHzMvClCwcACOiwDAattRhvwJaCG7YyxtPs4n/Ywc2eQSUTKTW4luBTg8znV8y86Hb8GJPEh9BIwL3KIIIQKQ0glIDMGN3RJlY1UUx2pdok1RcJDLOUCqYqhdHkEM88dsKCC8NkcZcCRLF2snEn9vaQG6bUCN4ctPKzjBPxPGyIK4Sxtao46VliWm1O0Ugg5hxiMkTgemAyx4i5SKpZSmmrIIFcBWHeIjLq98j10z7sIwuBY4WHLFXkhERKSccQJKaHOp1RHTbGRm0MJQf9SyEgiSZPak8ZKO6Ax7WAwqM1rTOt63pGvzs7nePH5N96eNvHyyxk6kxWuGo1ms4lut4tWq4V2u43xaIQ4y9G3BUKp8fDNN9x88A63H5/gxr3XePrhJwKh0LNJvcoRUhONSuNhczkalmXV18qoNDEej5BkGqMF2STSuP/qFNfvPsetR+9x7c4zPDn5gSjNMZxzZLqogSsCBkGwARqYbdu7cBznKIV/owU+fm/h668OPtHTsq9O+T/3HNmIPWA4hgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"01\"\n        title=\"\"\n        src=\"/static/4133d93f78d413ed170f094d39322175/b9e4f/01.png\"\n        srcset=\"/static/4133d93f78d413ed170f094d39322175/cf440/01.png 148w,\n/static/4133d93f78d413ed170f094d39322175/d2d38/01.png 295w,\n/static/4133d93f78d413ed170f094d39322175/b9e4f/01.png 590w,\n/static/4133d93f78d413ed170f094d39322175/f9b6a/01.png 885w,\n/static/4133d93f78d413ed170f094d39322175/2d849/01.png 1180w,\n/static/4133d93f78d413ed170f094d39322175/bbefa/01.png 1770w,\n/static/4133d93f78d413ed170f094d39322175/80b4e/01.png 2144w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h5>학습을 위한 데이터 로드</h5>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">import</span> face_recognition\n<span class=\"token keyword\">import</span> matplotlib<span class=\"token punctuation\">.</span>pyplot <span class=\"token keyword\">as</span> plt\n<span class=\"token keyword\">import</span> matplotlib<span class=\"token punctuation\">.</span>image <span class=\"token keyword\">as</span> mpimg\n<span class=\"token keyword\">import</span> cv2\n<span class=\"token keyword\">import</span> numpy <span class=\"token keyword\">as</span> np\n<span class=\"token keyword\">from</span> sklearn<span class=\"token punctuation\">.</span>preprocessing <span class=\"token keyword\">import</span> LabelEncoder\n<span class=\"token keyword\">from</span> sklearn<span class=\"token punctuation\">.</span>neighbors <span class=\"token keyword\">import</span> KNeighborsClassifier\n<span class=\"token keyword\">from</span> sklearn<span class=\"token punctuation\">.</span>svm <span class=\"token keyword\">import</span> LinearSVC\n\n<span class=\"token keyword\">import</span> pickle\n\nBASE_PATH <span class=\"token operator\">=</span> <span class=\"token string\">\"data2\"</span>\nEMBEDDING_PATH <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>BASE_PATH<span class=\"token punctuation\">,</span> <span class=\"token string\">\"valid_embedding_BTS.pkl\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span>EMBEDDING_PATH<span class=\"token punctuation\">,</span> <span class=\"token string\">'rb'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> handle<span class=\"token punctuation\">:</span>\n    face_embedding <span class=\"token operator\">=</span> pickle<span class=\"token punctuation\">.</span>load<span class=\"token punctuation\">(</span>handle<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>face_embedding<span class=\"token punctuation\">.</span>keys<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h5>멤버 얼굴 판별을 위한 SVM 알고리즘으로 학습</h5>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\">embedded <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\nnames <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\ntest_names <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\ntest_embedded <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\ni <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n<span class=\"token keyword\">for</span> name<span class=\"token punctuation\">,</span> embeddings <span class=\"token keyword\">in</span> face_embedding<span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>embeddings<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">for</span> embedding <span class=\"token keyword\">in</span> embeddings<span class=\"token punctuation\">:</span>\n\t\t    <span class=\"token comment\"># 학습 데이터 10개중에 하나는 테스트 데이터로 이용 (학습 모델 성능 확인을 위해)</span>\n        <span class=\"token keyword\">if</span> i <span class=\"token operator\">%</span> <span class=\"token number\">10</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\n            test_names<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span>\n            test_embedded<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>embedding<span class=\"token punctuation\">[</span><span class=\"token string\">\"embedding\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n        names<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span>\n        embedded<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>embedding<span class=\"token punctuation\">[</span><span class=\"token string\">\"embedding\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n        i <span class=\"token operator\">+=</span> <span class=\"token number\">1</span>\n\nencoder <span class=\"token operator\">=</span> LabelEncoder<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nencoder<span class=\"token punctuation\">.</span>fit<span class=\"token punctuation\">(</span>names<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># text 데이터를 숫자 데이터로 변환 (학습 하기 위해서)</span>\ny <span class=\"token operator\">=</span> encoder<span class=\"token punctuation\">.</span>transform<span class=\"token punctuation\">(</span>names<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># y-name 매핑 딕셔너리</span>\nname_dict <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">for</span> i<span class=\"token punctuation\">,</span> name_index <span class=\"token keyword\">in</span> <span class=\"token builtin\">enumerate</span><span class=\"token punctuation\">(</span>y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\t  name_dict<span class=\"token punctuation\">[</span>name_index<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> names<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span>\n    \n\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>name_dict<span class=\"token punctuation\">)</span>\n\nx_train <span class=\"token operator\">=</span> embedded\ny_train <span class=\"token operator\">=</span> y\n\n<span class=\"token comment\"># SVC 학습</span>\nsvc <span class=\"token operator\">=</span> LinearSVC<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nsvc<span class=\"token punctuation\">.</span>fit<span class=\"token punctuation\">(</span>x_train<span class=\"token punctuation\">,</span> y_train<span class=\"token punctuation\">)</span>\n\n\n<span class=\"token comment\"># 학습 모델 저장</span>\nface_model <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n\t  <span class=\"token string\">\"name_dict\"</span><span class=\"token punctuation\">:</span> name_dict<span class=\"token punctuation\">,</span>\n\t  <span class=\"token string\">\"svc\"</span><span class=\"token punctuation\">:</span> svc\n<span class=\"token punctuation\">}</span>\n\nmodel_path <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>BASE_PATH<span class=\"token punctuation\">,</span> <span class=\"token string\">\"face_model_bts.pkl\"</span><span class=\"token punctuation\">)</span>\nf <span class=\"token operator\">=</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span>model_path<span class=\"token punctuation\">,</span> <span class=\"token string\">\"wb\"</span><span class=\"token punctuation\">)</span>\nf<span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">(</span>pickle<span class=\"token punctuation\">.</span>dumps<span class=\"token punctuation\">(</span>face_model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\nf<span class=\"token punctuation\">.</span>close<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h5>모델 테스트</h5>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\">true_count <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\ntotal_count <span class=\"token operator\">=</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>test_embedded<span class=\"token punctuation\">)</span>\nresult_list <span class=\"token operator\">=</span> svc<span class=\"token punctuation\">.</span>predict<span class=\"token punctuation\">(</span>test_embedded<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> i<span class=\"token punctuation\">,</span> result <span class=\"token keyword\">in</span> <span class=\"token builtin\">enumerate</span><span class=\"token punctuation\">(</span>result_list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    result_name <span class=\"token operator\">=</span> name_dict<span class=\"token punctuation\">[</span>result<span class=\"token punctuation\">]</span>\n    ground_truth <span class=\"token operator\">=</span> test_names<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span>\n    \n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>result_name<span class=\"token punctuation\">,</span> ground_truth<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> result_name <span class=\"token operator\">==</span> ground_truth<span class=\"token punctuation\">:</span>\n        true_count <span class=\"token operator\">+=</span> <span class=\"token number\">1</span>\n        \n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"모델 인식율:\"</span><span class=\"token punctuation\">,</span> true_count <span class=\"token operator\">/</span> total_count <span class=\"token operator\">*</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"%\"</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h5>모델 로딩</h5>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">import</span> pickle\n\nmodel_path <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>DRIVE_BASE_PATH<span class=\"token punctuation\">,</span> <span class=\"token string\">\"data4\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"face_model_bts.pkl\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span>model_path<span class=\"token punctuation\">,</span> <span class=\"token string\">'rb'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> handle<span class=\"token punctuation\">:</span>\n    face_model <span class=\"token operator\">=</span> pickle<span class=\"token punctuation\">.</span>load<span class=\"token punctuation\">(</span>handle<span class=\"token punctuation\">)</span>\n\nname_dict <span class=\"token operator\">=</span> face_model<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"name_dict\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>name_dict<span class=\"token punctuation\">)</span>\n\nsvc <span class=\"token operator\">=</span> face_model<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"svc\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>svc<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">import</span> pickle\n<span class=\"token keyword\">import</span> cv2\n<span class=\"token keyword\">import</span> shutil\n<span class=\"token keyword\">import</span> numpy <span class=\"token keyword\">as</span> np\n<span class=\"token keyword\">import</span> face_recognition\n\n<span class=\"token keyword\">from</span> PIL <span class=\"token keyword\">import</span> ImageFont<span class=\"token punctuation\">,</span> ImageDraw<span class=\"token punctuation\">,</span> Image\n\n\nfontpath <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>DRIVE_BASE_PATH<span class=\"token punctuation\">,</span> <span class=\"token string\">\"NanumSquareB.ttf\"</span><span class=\"token punctuation\">)</span>\nfont <span class=\"token operator\">=</span> ImageFont<span class=\"token punctuation\">.</span>truetype<span class=\"token punctuation\">(</span>fontpath<span class=\"token punctuation\">,</span> <span class=\"token number\">38</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token comment\"># 한글 경로가 포함된 경우에도 불러올 수 있음</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">get_opencv_image</span><span class=\"token punctuation\">(</span>image_path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\tstream <span class=\"token operator\">=</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span>image_path<span class=\"token punctuation\">,</span> <span class=\"token string\">\"rb\"</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token builtin\">bytes</span> <span class=\"token operator\">=</span> <span class=\"token builtin\">bytearray</span><span class=\"token punctuation\">(</span>stream<span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\tnumpyarray <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>asarray<span class=\"token punctuation\">(</span><span class=\"token builtin\">bytes</span><span class=\"token punctuation\">,</span> dtype<span class=\"token operator\">=</span>np<span class=\"token punctuation\">.</span>uint8<span class=\"token punctuation\">)</span>\n\tbgr_image <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>imdecode<span class=\"token punctuation\">(</span>numpyarray<span class=\"token punctuation\">,</span> cv2<span class=\"token punctuation\">.</span>IMREAD_UNCHANGED<span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\n\t\t<span class=\"token keyword\">return</span> resize<span class=\"token punctuation\">(</span>bgr_image<span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">except</span> Exception <span class=\"token keyword\">as</span> ex<span class=\"token punctuation\">:</span>\n\t\t<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>ex<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token comment\"># width, heigth 중 큰 값을 맞추어서 resize함</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">resize</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> max_size <span class=\"token operator\">=</span> <span class=\"token number\">1280</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\theight<span class=\"token punctuation\">,</span> width <span class=\"token operator\">=</span> image<span class=\"token punctuation\">.</span>shape<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span>\n\t<span class=\"token keyword\">if</span> width <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1920</span> <span class=\"token keyword\">and</span> height <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1920</span><span class=\"token punctuation\">:</span>\n\t\t<span class=\"token keyword\">return</span> image\n\t\n\t<span class=\"token keyword\">if</span> width <span class=\"token operator\">></span> height<span class=\"token punctuation\">:</span>\n\t\twidth2 <span class=\"token operator\">=</span> max_size\n\t\theight2 <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>height <span class=\"token operator\">*</span> max_size <span class=\"token operator\">/</span> width<span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n\t\theight2 <span class=\"token operator\">=</span> max_size\n\t\twidth2 <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>width <span class=\"token operator\">*</span> max_size <span class=\"token operator\">/</span> height<span class=\"token punctuation\">)</span>\n\n\t<span class=\"token keyword\">return</span> cv2<span class=\"token punctuation\">.</span>resize<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>width2<span class=\"token punctuation\">,</span> height2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> interpolation<span class=\"token operator\">=</span>cv2<span class=\"token punctuation\">.</span>INTER_CUBIC<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">calc_face_embedding</span><span class=\"token punctuation\">(</span>image_path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\timage <span class=\"token operator\">=</span> get_opencv_image<span class=\"token punctuation\">(</span>image_path<span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">return</span> calc_face_embedding_image<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">)</span>\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">calc_face_embedding_image</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\trgb <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>cvtColor<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> cv2<span class=\"token punctuation\">.</span>COLOR_BGR2RGB<span class=\"token punctuation\">)</span>\n\n\t<span class=\"token comment\"># 1. 불러들인 이미지에서 인식한 얼굴의 bounding box x,y 좌표를 검출</span>\n\tboxes <span class=\"token operator\">=</span> face_recognition<span class=\"token punctuation\">.</span>face_locations<span class=\"token punctuation\">(</span>rgb<span class=\"token punctuation\">,</span> model <span class=\"token operator\">=</span> <span class=\"token string\">\"cnn\"</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>boxes<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n\t<span class=\"token comment\"># 2. x1 값으로 오름차순 정렬</span>\n\tboxes<span class=\"token punctuation\">.</span>sort<span class=\"token punctuation\">(</span>key<span class=\"token operator\">=</span><span class=\"token keyword\">lambda</span> box<span class=\"token punctuation\">:</span> box<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n\t<span class=\"token comment\"># 3. 다차원 얼굴 벡터 계산</span>\n\tencodings <span class=\"token operator\">=</span> face_recognition<span class=\"token punctuation\">.</span>face_encodings<span class=\"token punctuation\">(</span>rgb<span class=\"token punctuation\">,</span> boxes<span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>boxes<span class=\"token punctuation\">,</span> encodings<span class=\"token punctuation\">,</span> rgb<span class=\"token punctuation\">)</span>\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">recognize_svm</span><span class=\"token punctuation\">(</span>image_path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\tboxes<span class=\"token punctuation\">,</span> encodings<span class=\"token punctuation\">,</span> rgb <span class=\"token operator\">=</span> calc_face_embedding<span class=\"token punctuation\">(</span>image_path<span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>boxes<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n\tnames <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\tresults <span class=\"token operator\">=</span> svc<span class=\"token punctuation\">.</span>predict<span class=\"token punctuation\">(</span>encodings<span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">for</span> result <span class=\"token keyword\">in</span> results<span class=\"token punctuation\">:</span>\n\t\tname <span class=\"token operator\">=</span> name_dict<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span>\n\t\tnames<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span>\n\n\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>boxes<span class=\"token punctuation\">,</span> results<span class=\"token punctuation\">,</span> names<span class=\"token punctuation\">,</span> rgb<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">recognize_distance</span><span class=\"token punctuation\">(</span>image_path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\tboxes<span class=\"token punctuation\">,</span> encodings<span class=\"token punctuation\">,</span> rgb <span class=\"token operator\">=</span> calc_face_embedding<span class=\"token punctuation\">(</span>image_path<span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>boxes<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n\tnames <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\tresults <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\t<span class=\"token keyword\">for</span> encoding <span class=\"token keyword\">in</span> encodings<span class=\"token punctuation\">:</span>\n\t\tname <span class=\"token operator\">=</span> lookup_face_distance<span class=\"token punctuation\">(</span>encoding<span class=\"token punctuation\">)</span>\n\t\tnames<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>boxes<span class=\"token punctuation\">,</span> results<span class=\"token punctuation\">,</span> names<span class=\"token punctuation\">,</span> rgb<span class=\"token punctuation\">)</span>\n\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">recognize_image</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\tboxes<span class=\"token punctuation\">,</span> encodings<span class=\"token punctuation\">,</span> rgb <span class=\"token operator\">=</span> calc_face_embedding_image<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>boxes<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n\tnames <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\tresults <span class=\"token operator\">=</span> svc<span class=\"token punctuation\">.</span>predict<span class=\"token punctuation\">(</span>encodings<span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">for</span> result <span class=\"token keyword\">in</span> results<span class=\"token punctuation\">:</span>\n\t\tname <span class=\"token operator\">=</span> name_dict<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span>\n\t\tnames<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>boxes<span class=\"token punctuation\">,</span> results<span class=\"token punctuation\">,</span> names<span class=\"token punctuation\">,</span> rgb<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 인식 결과를 이미지 파일로 저장 (method: svm/distance)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">recognize_save</span><span class=\"token punctuation\">(</span>image_path<span class=\"token punctuation\">,</span> save_file_path<span class=\"token punctuation\">,</span> method<span class=\"token operator\">=</span><span class=\"token string\">\"svm\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\t<span class=\"token keyword\">if</span> method <span class=\"token operator\">==</span> <span class=\"token string\">\"svm\"</span><span class=\"token punctuation\">:</span>\n\t\tboxes<span class=\"token punctuation\">,</span> results<span class=\"token punctuation\">,</span> names<span class=\"token punctuation\">,</span> rgb <span class=\"token operator\">=</span> recognize_svm<span class=\"token punctuation\">(</span>image_path<span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n\t\tboxes<span class=\"token punctuation\">,</span> results<span class=\"token punctuation\">,</span> names<span class=\"token punctuation\">,</span> rgb <span class=\"token operator\">=</span> recognize_distance<span class=\"token punctuation\">(</span>image_path<span class=\"token punctuation\">)</span>\n    \n\t<span class=\"token keyword\">if</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>boxes<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n  \n\t<span class=\"token keyword\">for</span> i<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>top<span class=\"token punctuation\">,</span> right<span class=\"token punctuation\">,</span> bottom<span class=\"token punctuation\">,</span> left<span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span> <span class=\"token builtin\">enumerate</span><span class=\"token punctuation\">(</span>boxes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\t\tname <span class=\"token operator\">=</span> names<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span>\n<span class=\"token comment\"># \t\tname = hangul_dict.get(name, name)</span>\n    \n\t\tcv2<span class=\"token punctuation\">.</span>rectangle<span class=\"token punctuation\">(</span>rgb<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>left<span class=\"token punctuation\">,</span> top<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>right<span class=\"token punctuation\">,</span> bottom<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n\n\t\timg_pil <span class=\"token operator\">=</span> Image<span class=\"token punctuation\">.</span>fromarray<span class=\"token punctuation\">(</span>rgb<span class=\"token punctuation\">)</span>\n\t\tdraw <span class=\"token operator\">=</span> ImageDraw<span class=\"token punctuation\">.</span>Draw<span class=\"token punctuation\">(</span>img_pil<span class=\"token punctuation\">)</span>\n\n\t\ty <span class=\"token operator\">=</span> bottom <span class=\"token operator\">+</span> <span class=\"token number\">1</span>\n\n\t\tdraw<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>left<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  name<span class=\"token punctuation\">,</span> font <span class=\"token operator\">=</span> font<span class=\"token punctuation\">,</span> fill <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\trgb <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>array<span class=\"token punctuation\">(</span>img_pil<span class=\"token punctuation\">)</span>\n\n\timage <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>cvtColor<span class=\"token punctuation\">(</span>rgb<span class=\"token punctuation\">,</span> cv2<span class=\"token punctuation\">.</span>COLOR_RGB2BGR<span class=\"token punctuation\">)</span>\n\tcv2<span class=\"token punctuation\">.</span>imwrite<span class=\"token punctuation\">(</span>save_file_path<span class=\"token punctuation\">,</span> image<span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>boxes<span class=\"token punctuation\">,</span> names<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h5>distance 거리 비교 방식과 SVM 모델의 예측 테스트 진행</h5>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">from</span> IPython <span class=\"token keyword\">import</span> display\n\nBASE_PATH <span class=\"token operator\">=</span> <span class=\"token string\">\"data2\"</span>\ntest_images <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"1.jpg\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"2.jpg\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"3.jpg\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"4.jpg\"</span><span class=\"token punctuation\">]</span>\nfolder_path <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>DRIVE_BASE_PATH<span class=\"token punctuation\">,</span> <span class=\"token string\">\"bts\"</span><span class=\"token punctuation\">)</span>\nsave_folder_path <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>BASE_PATH<span class=\"token punctuation\">,</span> <span class=\"token string\">\"bts\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"result\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>exists<span class=\"token punctuation\">(</span>save_folder_path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    os<span class=\"token punctuation\">.</span>makedirs<span class=\"token punctuation\">(</span>save_folder_path<span class=\"token punctuation\">)</span>\n\nsave_folder_path2 <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>BASE_PATH<span class=\"token punctuation\">,</span> <span class=\"token string\">\"bts\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"result2\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>exists<span class=\"token punctuation\">(</span>save_folder_path2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    os<span class=\"token punctuation\">.</span>makedirs<span class=\"token punctuation\">(</span>save_folder_path2<span class=\"token punctuation\">)</span>\n\n    \n    \n<span class=\"token keyword\">for</span> <span class=\"token builtin\">file</span> <span class=\"token keyword\">in</span> test_images<span class=\"token punctuation\">:</span>\n    image_path <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>folder_path<span class=\"token punctuation\">,</span> <span class=\"token builtin\">file</span><span class=\"token punctuation\">)</span>\n    \n    save_file_path <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>save_folder_path<span class=\"token punctuation\">,</span> <span class=\"token builtin\">file</span><span class=\"token punctuation\">)</span>\n    boxes<span class=\"token punctuation\">,</span> names <span class=\"token operator\">=</span> recognize_save<span class=\"token punctuation\">(</span>image_path<span class=\"token punctuation\">,</span> save_file_path<span class=\"token punctuation\">,</span> method<span class=\"token operator\">=</span><span class=\"token string\">\"distance\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"distance\"</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">file</span><span class=\"token punctuation\">,</span> names<span class=\"token punctuation\">)</span>\n    \n    <span class=\"token comment\"># 페이지에 결과 이미지 표시</span>\n    display<span class=\"token punctuation\">.</span>display<span class=\"token punctuation\">(</span>display<span class=\"token punctuation\">.</span>Image<span class=\"token punctuation\">(</span>filename<span class=\"token operator\">=</span>save_file_path<span class=\"token punctuation\">,</span> width<span class=\"token operator\">=</span><span class=\"token number\">640</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    \n    save_file_path2 <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>save_folder_path2<span class=\"token punctuation\">,</span> <span class=\"token builtin\">file</span><span class=\"token punctuation\">)</span>\n    boxes<span class=\"token punctuation\">,</span> names <span class=\"token operator\">=</span> recognize_save<span class=\"token punctuation\">(</span>image_path<span class=\"token punctuation\">,</span> save_file_path2<span class=\"token punctuation\">,</span> method<span class=\"token operator\">=</span><span class=\"token string\">\"svm\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"svm\"</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">file</span><span class=\"token punctuation\">,</span> names<span class=\"token punctuation\">)</span>\n    \n    <span class=\"token comment\"># 페이지에 결과 이미지 표시</span>\n    display<span class=\"token punctuation\">.</span>display<span class=\"token punctuation\">(</span>display<span class=\"token punctuation\">.</span>Image<span class=\"token punctuation\">(</span>filename<span class=\"token operator\">=</span>save_file_path2<span class=\"token punctuation\">,</span> width<span class=\"token operator\">=</span><span class=\"token number\">640</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1004148d9107dfc3606cc77d44043937/9f096/07.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 76.11710323574731%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAQCAwUG/8QAFQEBAQAAAAAAAAAAAAAAAAAAAQL/2gAMAwEAAhADEAAAAZq1LJ0Bmlx//8QAGxAAAgIDAQAAAAAAAAAAAAAAAAIBAwQRExL/2gAIAQEAAQUCdvEd4E2W39DYmQ0H/8QAFxEAAwEAAAAAAAAAAAAAAAAAABESIf/aAAgBAwEBPwFYiD//xAAXEQADAQAAAAAAAAAAAAAAAAAAERIh/9oACAECAQE/AXrLP//EABsQAQEAAgMBAAAAAAAAAAAAAAEAISIREjEz/9oACAEBAAY/At1sKTtzfONcz1D2/8QAGxABAQACAwEAAAAAAAAAAAAAAREAITFhcUH/2gAIAQEAAT8hImD3BKkBxciC9ubkyIH37cncAAHvvDoA1ve8/9oADAMBAAIAAwAAABDsP//EABcRAQEBAQAAAAAAAAAAAAAAAAEAITH/2gAIAQMBAT8QDDvt/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAERQf/aAAgBAgEBPxBijUf/xAAbEAEBAAMBAQEAAAAAAAAAAAABEQAhQTGRcf/aAAgBAQABPxBaJKG3rD5h7H5x8V9r3LpDrREhgIMIy+lFxfYGG7Fq/afM3KinYFz/2Q=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"07\"\n        title=\"\"\n        src=\"/static/1004148d9107dfc3606cc77d44043937/c739e/07.jpg\"\n        srcset=\"/static/1004148d9107dfc3606cc77d44043937/8ee9c/07.jpg 148w,\n/static/1004148d9107dfc3606cc77d44043937/ebbe7/07.jpg 295w,\n/static/1004148d9107dfc3606cc77d44043937/c739e/07.jpg 590w,\n/static/1004148d9107dfc3606cc77d44043937/5413e/07.jpg 885w,\n/static/1004148d9107dfc3606cc77d44043937/4efde/07.jpg 1180w,\n/static/1004148d9107dfc3606cc77d44043937/9f096/07.jpg 1298w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p style=\"text-align:center\">distance 방식에 진을 잘못 예측한 부분이 보인다.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/26f87ffce771ab9f8b63a3475263bf6a/8d067/08.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 76.19047619047619%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAQFAgP/xAAVAQEBAAAAAAAAAAAAAAAAAAABAv/aAAwDAQACEAMQAAAB2rzVS+TS4//EABoQAAIDAQEAAAAAAAAAAAAAAAACAQMRExL/2gAIAQEAAQUCdvEd4E0tu6GiXvB//8QAFxEAAwEAAAAAAAAAAAAAAAAAABETIf/aAAgBAwEBPwFYiZ//xAAXEQADAQAAAAAAAAAAAAAAAAAAERIh/9oACAECAQE/AXrLP//EABsQAQEAAgMBAAAAAAAAAAAAAAEAISIREjIz/9oACAEBAAY/At1sKXrm+ZGuZ6hf/8QAGhABAAMBAQEAAAAAAAAAAAAAAQARITFhcf/aAAgBAQABPyEyaH2C2kBy5SJfXbj2EnmPseoAAPvsxwFtvdn/2gAMAwEAAgADAAAAEP8A/wD/xAAXEQEBAQEAAAAAAAAAAAAAAAABABEx/9oACAEDAQE/EAw6e3//xAAXEQADAQAAAAAAAAAAAAAAAAAAARFB/9oACAECAQE/EGKNR//EABsQAQADAAMBAAAAAAAAAAAAAAEAESExUZFh/9oACAEBAAE/EGokoadc46hjG/jwqbbE2o4CRKIMsC3bqy5ZYmF3cXXp5Bso6mgXP//Z'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"08\"\n        title=\"\"\n        src=\"/static/26f87ffce771ab9f8b63a3475263bf6a/c739e/08.jpg\"\n        srcset=\"/static/26f87ffce771ab9f8b63a3475263bf6a/8ee9c/08.jpg 148w,\n/static/26f87ffce771ab9f8b63a3475263bf6a/ebbe7/08.jpg 295w,\n/static/26f87ffce771ab9f8b63a3475263bf6a/c739e/08.jpg 590w,\n/static/26f87ffce771ab9f8b63a3475263bf6a/5413e/08.jpg 885w,\n/static/26f87ffce771ab9f8b63a3475263bf6a/4efde/08.jpg 1180w,\n/static/26f87ffce771ab9f8b63a3475263bf6a/8d067/08.jpg 1302w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p style=\"text-align:center\">svm에서는 멤버 예측이 잘 맞았다.</p>\n<p>그런데 SVM이 예측을 잘한다라고 판단할 수 없는게 어떤 이미지에서는 distance 방식이 잘 맞을 때도 있다.</p>","frontmatter":{"title":"얼굴 인식 살짝 맛보기 (FaceNet, SVM, MTCNN)","date":"2019-08-15 22:26:58","tags":["python","Deep Learning","FaceNet","SVM","MTCNN","iCrawler"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2019/08/15/20190815-preview-face-recognition/","previous":{"fields":{"slug":"/2019/07/09/20190709-java-hbase-logback-slf4j/"},"frontmatter":{"title":"Java Hbase-client 디펜던시 추가 후 로그가 제대로 안나오는 이슈 (with Slf4j, Logback)"}},"next":{"fields":{"slug":"/2019/08/16/20190816-react-input-autocomplete-issue/"},"frontmatter":{"title":"React Input에서 자동완성(Auto Complete)가 활성화 안되는 이슈 해결하기"}}}}