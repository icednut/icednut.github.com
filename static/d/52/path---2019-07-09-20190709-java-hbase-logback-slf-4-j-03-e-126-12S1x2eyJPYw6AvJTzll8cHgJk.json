{"data":{"site":{"siteMetadata":{"title":"Icednut's Notes","author":"Will Lee","siteUrl":"https://icednut.github.io"}},"markdownRemark":{"id":"d39b067a-cc8e-5668-9eb9-922b68c7b143","excerpt":"이슈: hbase-client 디펜던시를 추가하면 로그가 안나옴최근 logback을 사용하고 있는 스칼라 Akka 프로젝트에서 hbase를 연동할 일이 있어서  디펜던시 추가 후 hbase…","html":"<h3>이슈: hbase-client 디펜던시를 추가하면 로그가 안나옴</h3>\n<p>최근 logback을 사용하고 있는 스칼라 Akka 프로젝트에서 hbase를 연동할 일이 있어서 <code class=\"language-text\">hbase-shaded-client</code> 디펜던시 추가 후 hbase 관련 데이터 조회 및 저장 작업을 진행하게 되었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"scala\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-scala line-numbers\"><code class=\"language-scala\"><span class=\"token comment\">// build.sbt</span>\nlibraryDependencies <span class=\"token operator\">++</span><span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"ch.qos.logback\"</span> <span class=\"token operator\">%</span> <span class=\"token string\">\"logback-classic\"</span> <span class=\"token operator\">%</span> <span class=\"token string\">\"1.1.7\"</span><span class=\"token punctuation\">,</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token string\">\"org.apache.hbase\"</span> <span class=\"token operator\">%</span> <span class=\"token string\">\"hbase-shaded-client\"</span> <span class=\"token operator\">%</span> hbaseClientVersion</span><span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>그런데 위 디펜던시를 추가한 순간 콘솔에 로그가 나오질 않았다. 정확하게는 logger로 출력한 내용은 나오질 않고 System.out.print로 출력한 코드만 나오고 있었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"plain\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-plain line-numbers\"><code class=\"language-plain\">// 서버 로그 \n\n/Library/Java/JavaVirtualMachines/jdk1.8.0_201.jdk/Contents/Home/bin/java ...\nConnected to the target VM, address: &#39;127.0.0.1:55918&#39;, transport: &#39;socket&#39;\nSLF4J: Class path contains multiple SLF4J bindings.\nSLF4J: Found binding in [jar:file:/Users/xxx/.ivy2/cache/org.slf4j/slf4j-log4j12/jars/slf4j-log4j12-1.7.5.jar!/org/slf4j/impl/StaticLoggerBinder.class] // highlight-line\nSLF4J: Found binding in [jar:file:/Users/xxx/.ivy2/cache/ch.qos.logback/logback-classic/jars/logback-classic-1.1.7.jar!/org/slf4j/impl/StaticLoggerBinder.class] // highlight-line\nSLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an explanation.\nSLF4J: Actual binding is of type [org.slf4j.impl.Log4jLoggerFactory]\nlog4j:WARN No appenders could be found for logger (com.kakao.radar.infrastructure.persistence.slick.DatabaseSupport$).\nlog4j:WARN Please initialize the log4j system properly.\nlog4j:WARN See http://logging.apache.org/log4j/1.2/faq.html#noconfig for more info.\nJava config name: ***\nLoaded from Java config\nJava config name: ***\nLoaded from Java config\n&gt;&gt;&gt; KdcAccessibility: reset\n&gt;&gt;&gt; KdcAccessibility: reset\n...</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>근데 또 어떨 때는 slf4j-log4j12/StaticLoggerBinder와 logback/StaticLoggerBinder의 로딩 순서가 서로 바뀌면서 로딩이 되면서 로그가 나오는 경우도 있었다. (허허…)</p>\n<div class=\"gatsby-highlight\" data-language=\"plain\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-plain line-numbers\"><code class=\"language-plain\">// 서버 로그\n\n/Library/Java/JavaVirtualMachines/jdk1.8.0_201.jdk/Contents/Home/bin/java ...\nConnected to the target VM, address: &#39;127.0.0.1:56170&#39;, transport: &#39;socket&#39;\nSLF4J: Class path contains multiple SLF4J bindings.\nSLF4J: Found binding in [jar:file:/Users/xxx/.ivy2/cache/ch.qos.logback/logback-classic/jars/logback-classic-1.1.7.jar!/org/slf4j/impl/StaticLoggerBinder.class] // highlight-line\nSLF4J: Found binding in [jar:file:/Users/xxx/.ivy2/cache/org.slf4j/slf4j-log4j12/jars/slf4j-log4j12-1.7.5.jar!/org/slf4j/impl/StaticLoggerBinder.class] // highlight-line\nSLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an explanation.\nSLF4J: Actual binding is of type [ch.qos.logback.classic.util.ContextSelectorStaticBinder]\n[xxx-macbook.local:2019-07-10 11:23:21] INFO [com.xxx.DatabaseSupport$:&lt;init&gt;:14] initializing database mysql\n[xxx-macbook.local:2019-07-10 11:23:21] WARN [slick.basic.DatabaseConfig:warn:25] Use `mysql.profile` instead of `mysql.driver`. The latter is deprecated since Slick 3.2 and will be removed.\n[xxx-macbook.local:2019-07-10 11:23:21] DEBUG [com.zaxxer.hikari.HikariConfig:logConfiguration:841] mysql.db - configuration:\n[xxx-macbook.local:2019-07-10 11:23:21] DEBUG [com.zaxxer.hikari.HikariConfig:logConfiguration:857] allowPoolSuspension.............false\n[xxx-macbook.local:2019-07-10 11:23:21] DEBUG [com.zaxxer.hikari.HikariConfig:logConfiguration:857] autoCommit......................true\n[xxx-macbook.local:2019-07-10 11:23:21] DEBUG [com.zaxxer.hikari.HikariConfig:logConfiguration:857] catalog.........................null\n[xxx-macbook.local:2019-07-10 11:23:21] DEBUG [com.zaxxer.hikari.HikariConfig:logConfiguration:857] connectionInitSql...............null\n[xxx-macbook.local:2019-07-10 11:23:21] DEBUG [com.zaxxer.hikari.HikariConfig:logConfiguration:857] connectionTestQuery.............null\n[xxx-macbook.local:2019-07-10 11:23:21] DEBUG [com.zaxxer.hikari.HikariConfig:logConfiguration:857] connectionTimeout...............1000\n[xxx-macbook.local:2019-07-10 11:23:21] DEBUG [com.zaxxer.hikari.HikariConfig:logConfiguration:857] dataSource......................null\n[xxx-macbook.local:2019-07-10 11:23:21] DEBUG [com.zaxxer.hikari.HikariConfig:logConfiguration:857] dataSourceClassName.............null\n[xxx-macbook.local:2019-07-10 11:23:21] DEBUG [com.zaxxer.hikari.HikariConfig:logConfiguration:857] dataSourceJNDI..................null\n...</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<br/>\n<br/>\n<h3>해결</h3>\n<p>구글에서 좀 찾아보니 hbase-client 추가 후 로그가 안나올 경우 slf4j, log4j 디펜던시를 exclude 해보라는 글이 보였다. (<a href=\"https://kimfish.co.kr/285\">https://kimfish.co.kr/285</a>) 그래서 아래와 같이 slf4j와 log4j 디펜던시를 제외한 후 어플리케이션을 재시작해보니 로그가 정상적으로 나왔다.</p>\n<div class=\"gatsby-highlight\" data-language=\"scala\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-scala line-numbers\"><code class=\"language-scala\"><span class=\"token comment\">// build.sbt</span>\nlibraryDependencies <span class=\"token operator\">++</span><span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"ch.qos.logback\"</span> <span class=\"token operator\">%</span> <span class=\"token string\">\"logback-classic\"</span> <span class=\"token operator\">%</span> <span class=\"token string\">\"1.1.7\"</span><span class=\"token punctuation\">,</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token string\">\"org.apache.hbase\"</span> <span class=\"token operator\">%</span> <span class=\"token string\">\"hbase-shaded-client\"</span> <span class=\"token operator\">%</span> hbaseClientVersion excludeAll<span class=\"token punctuation\">(</span></span><span class=\"gatsby-highlight-code-line\">    ExclusionRule<span class=\"token punctuation\">(</span>organization <span class=\"token operator\">=</span> <span class=\"token string\">\"org.slf4j\"</span><span class=\"token punctuation\">,</span> name <span class=\"token operator\">=</span> <span class=\"token string\">\"slf4j-log4j12\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">    ExclusionRule<span class=\"token punctuation\">(</span>organization <span class=\"token operator\">=</span> <span class=\"token string\">\"log4j\"</span><span class=\"token punctuation\">,</span> name <span class=\"token operator\">=</span> <span class=\"token string\">\"log4j\"</span><span class=\"token punctuation\">)</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">// 서버 로그\n\n/Library/Java/JavaVirtualMachines/jdk1.8.0_201.jdk/Contents/Home/bin/java ...\nConnected to the target VM, address: &#39;127.0.0.1:56047&#39;, transport: &#39;socket&#39;\n[xxx-macbook.local:2019-07-10 11:17:52] INFO [com.xxx.DatabaseSupport$:&lt;init&gt;:14] initializing database mysql\n[xxx-macbook.local:2019-07-10 11:17:52] WARN [slick.basic.DatabaseConfig:warn:25] Use `mysql.profile` instead of `mysql.driver`. The latter is deprecated since Slick 3.2 and will be removed.\n[xxx-macbook.local:2019-07-10 11:17:53] DEBUG [com.zaxxer.hikari.HikariConfig:logConfiguration:841] mysql.db - configuration:\n[xxx-macbook.local:2019-07-10 11:17:53] DEBUG [com.zaxxer.hikari.HikariConfig:logConfiguration:857] allowPoolSuspension.............false\n[xxx-macbook.local:2019-07-10 11:17:53] DEBUG [com.zaxxer.hikari.HikariConfig:logConfiguration:857] autoCommit......................true\n[xxx-macbook.local:2019-07-10 11:17:53] DEBUG [com.zaxxer.hikari.HikariConfig:logConfiguration:857] catalog.........................null\n[xxx-macbook.local:2019-07-10 11:17:53] DEBUG [com.zaxxer.hikari.HikariConfig:logConfiguration:857] connectionInitSql...............null\n[xxx-macbook.local:2019-07-10 11:17:53] DEBUG [com.zaxxer.hikari.HikariConfig:logConfiguration:857] connectionTestQuery.............null\n[xxx-macbook.local:2019-07-10 11:17:53] DEBUG [com.zaxxer.hikari.HikariConfig:logConfiguration:857] connectionTimeout...............1000\n[xxx-macbook.local:2019-07-10 11:17:53] DEBUG [com.zaxxer.hikari.HikariConfig:logConfiguration:857] dataSource......................null\n[xxx-macbook.local:2019-07-10 11:17:53] DEBUG [com.zaxxer.hikari.HikariConfig:logConfiguration:857] dataSourceClassName.............null\n[xxx-macbook.local:2019-07-10 11:17:53] DEBUG [com.zaxxer.hikari.HikariConfig:logConfiguration:857] dataSourceJNDI..................null\n...\nJava config name: ***\nLoaded from Java config\nJava config name: ***\nLoaded from Java config\n&gt;&gt;&gt; KdcAccessibility: reset\n&gt;&gt;&gt; KdcAccessibility: reset\n...</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<br/>\n<br/>\n<h3>왜 그런걸까?</h3>\n<p>전에도 비슷한 경험(<a href=\"https://icednut.github.io/2016/07/15/20160715-logback_and_slf4j/\">https://icednut.github.io/2016/07/15/20160715-logback<em>and</em>slf4j/</a>)이 있었는데 그 때 해결만 하고 왜 그런건지 명확하게 밝히지 않고 넘어간 것이 새삼 아쉬웠다.\nLogback을 사용하고 있던 상황에서 왜 slf4j-log4j12와 log4j 디펜던시를 제거하니깐 로그가 나온걸까? 좀 더 세밀하게 분석해보자.\n는 다음 시간에…</p>","frontmatter":{"title":"Java Hbase-client 디펜던시 추가 후 로그가 제대로 안나오는 이슈 (with Slf4j, Logback)","date":"2019-07-09 21:13:01","tags":["java","logging","SLF4J","Logback"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2019/07/09/20190709-java-hbase-logback-slf4j/","previous":{"fields":{"slug":"/2019/01/31/20190131-rxjava-infinite-iterable/"},"frontmatter":{"title":"RxJava를 이용하여 크기를 가늠할 수 없는 Iterable에서 데이터 읽고 처리하기"}},"next":null}}