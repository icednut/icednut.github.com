{"data":{"site":{"siteMetadata":{"title":"Icednut's Notes","author":"Will Lee","siteUrl":"https://icednut.github.io"}},"markdownRemark":{"id":"00e628b2-3510-5144-bbb5-2ce7fd3bdf3f","excerpt":"요구사항 추가현재 Todo List 상태를 저장한 뒤에 나중에 필요할 때 복원하고 싶다. 저장 및 복원은 어떻게 구현할까?이럴 때 필요한게 Memento 패턴이다.\n\nTodo App with Memento PatternMemento…","html":"<h2>요구사항 추가</h2>\n<p>현재 Todo List 상태를 저장한 뒤에 나중에 필요할 때 복원하고 싶다. 저장 및 복원은 어떻게 구현할까?</p>\n<p>이럴 때 필요한게 Memento 패턴이다.\n<br/>\n<br/></p>\n<h2>Todo App with Memento Pattern</h2>\n<p>Memento 패턴에 집중하기 위해 다른 패턴들은 잠시 다 걷어내고 이전 포스트에서 봤던 Plain Todo App에 Todo 목록 저장, 복원 기능을 Memento 패턴을 이용하여 구현해보도록 하자.\n<br/>\n<br/></p>\n<p>우선 Plain Todo App의 코드 부터 살펴보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Route</span>\n<span class=\"token annotation punctuation\">@PWA</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"Plain Todo App\"</span><span class=\"token punctuation\">,</span> shortName <span class=\"token operator\">=</span> <span class=\"token string\">\"PTA\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MainView</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">VerticalLayout</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">final</span> <span class=\"token class-name\">VerticalLayout</span> todosList <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">VerticalLayout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">final</span> <span class=\"token class-name\">TextField</span> todoField <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TextField</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">final</span> <span class=\"token class-name\">Button</span> addButton <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Button</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Add\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">MainView</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        addButton<span class=\"token punctuation\">.</span><span class=\"token function\">addClickListener</span><span class=\"token punctuation\">(</span>event <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> todoMessage <span class=\"token operator\">=</span> todoField<span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">StringUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">hasText</span><span class=\"token punctuation\">(</span>todoMessage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">final</span> <span class=\"token class-name\">TodoListElement</span> todoListElement <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TodoListElement</span><span class=\"token punctuation\">(</span>todoMessage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                todoListElement<span class=\"token punctuation\">.</span><span class=\"token function\">addDeleteClickListener</span><span class=\"token punctuation\">(</span>deleteClickEvent <span class=\"token operator\">-></span> todosList<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span>todoListElement<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                todosList<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>todoListElement<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                todoField<span class=\"token punctuation\">.</span><span class=\"token function\">setValue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">HorizontalLayout</span><span class=\"token punctuation\">(</span>todoField<span class=\"token punctuation\">,</span> addButton<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> todosList<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>실행 화면과 소스코드는 다음과 같다.\n\n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 63.56026785714285%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAABEUlEQVQ4y2OQlpG3VVbTnK1naDJZRV1ziqS03BQRUckpImLEYQkpuSkS0nKTJWUUZgHZVQyTpkwt3bP/4P+tO3b937J99/8t23b837ptO9F49979/3ft2ff/yPGT/1euXvOY4dmzZ7n/IeAHEP8C4t9k4J9QMy4x3LhxI+/n7z//P33+/AcI/gHx/98kYKj6PyDTPn36dJXh1q1beSDO79+/QYL/gOA/DBMLgGrBBn79+hVhIBD8+UeKKcQaSKrr6O9Cahr4+x/5AGzgly9frjLcuXMHbiAQ/wVZSAYGG/j9+/crDJcvXy4Ap+ofP/7/+vWLLAzSCwJv3769wdDa2qoyefLkGCCOAOJIMnEE1Ax3APpahduIRdCDAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"plain todo app\"\n        title=\"\"\n        src=\"/static/32a3474d485e5a42418b60bd28f2d391/b9e4f/plain_todo_app.png\"\n        srcset=\"/static/32a3474d485e5a42418b60bd28f2d391/cf440/plain_todo_app.png 148w,\n/static/32a3474d485e5a42418b60bd28f2d391/d2d38/plain_todo_app.png 295w,\n/static/32a3474d485e5a42418b60bd28f2d391/b9e4f/plain_todo_app.png 590w,\n/static/32a3474d485e5a42418b60bd28f2d391/f9b6a/plain_todo_app.png 885w,\n/static/32a3474d485e5a42418b60bd28f2d391/2d849/plain_todo_app.png 1180w,\n/static/32a3474d485e5a42418b60bd28f2d391/bbefa/plain_todo_app.png 1770w,\n/static/32a3474d485e5a42418b60bd28f2d391/079dc/plain_todo_app.png 3584w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  </p>\n<p style=\"text-align: center;\"><a href=\"https://github.com/icednut/vaadin-todo-app.git\">https://github.com/icednut/vaadin-todo-app.git</a></p>\n<p>그럼 Todo 목록 현황 즉 상태를 저장할 클래스가 필요하다. 가장 마지막 상태 관리하는 클래스를 Originator라고 하자. (Memento 패턴에서는 상태 관리하는 클래스를 Originator라고 부른다. 패턴 공부를 위해 여기서는 용어를 통일하자.) MainView는 여기서 Caretaker가 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Route</span>\n<span class=\"token annotation punctuation\">@PWA</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"Design Pattern Exercise Memento Pattern\"</span><span class=\"token punctuation\">,</span> shortName <span class=\"token operator\">=</span> <span class=\"token string\">\"Memento Pattern Exercise\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MainView</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">VerticalLayout</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">final</span> <span class=\"token class-name\">VerticalLayout</span> todosList <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">VerticalLayout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">final</span> <span class=\"token class-name\">TextField</span> todoField <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TextField</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">final</span> <span class=\"token class-name\">Button</span> addButton <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Button</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Add\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">final</span> <span class=\"token class-name\">Button</span> saveButton <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Button</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Save\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">final</span> <span class=\"token class-name\">Button</span> restoreButton <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Button</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Restore\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">final</span> <span class=\"token class-name\">Originator</span> originator <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Originator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>// &lt;1></span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">final</span> <span class=\"token class-name\">LinkedList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Memento</span><span class=\"token punctuation\">></span></span> savedStates <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">LinkedList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">final</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> lastState <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>// &lt;2></span></span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">MainView</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        saveButton<span class=\"token punctuation\">.</span><span class=\"token function\">addClickListener</span><span class=\"token punctuation\">(</span>event <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">            savedStates<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>originator<span class=\"token punctuation\">.</span><span class=\"token function\">saveToMemento</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>// &lt;3></span></span>        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        restoreButton<span class=\"token punctuation\">.</span><span class=\"token function\">addClickListener</span><span class=\"token punctuation\">(</span>event <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">            originator<span class=\"token punctuation\">.</span><span class=\"token function\">restoreFromMemento</span><span class=\"token punctuation\">(</span>savedStates<span class=\"token punctuation\">.</span><span class=\"token function\">getLast</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>// &lt;5></span></span>        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        addButton<span class=\"token punctuation\">.</span><span class=\"token function\">addClickListener</span><span class=\"token punctuation\">(</span>event <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> todoMessage <span class=\"token operator\">=</span> todoField<span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">StringUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">hasText</span><span class=\"token punctuation\">(</span>todoMessage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">                lastState<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>todoMessage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>// &lt;2></span></span><span class=\"gatsby-highlight-code-line\">                originator<span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>lastState<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>// &lt;4></span></span>\n                <span class=\"token keyword\">final</span> <span class=\"token class-name\">TodoListElement</span> todoListElement <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TodoListElement</span><span class=\"token punctuation\">(</span>todoMessage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                todoListElement<span class=\"token punctuation\">.</span><span class=\"token function\">addDeleteClickListener</span><span class=\"token punctuation\">(</span>deleteClickEvent <span class=\"token operator\">-></span> todosList<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span>todoListElement<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                todosList<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>todoListElement<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                todoField<span class=\"token punctuation\">.</span><span class=\"token function\">setValue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token function\">controlComponent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> todosList<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">HorizontalLayout</span> <span class=\"token function\">controlComponent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<hr>\n<h2>Memento 패턴과 Command 패턴을 결합한 Undo, Redo 기능 구현</h2>\n<p>잠시 Undo, Redo 구현을 떠나서 만약에 3 * 3 연산을 하면 뭐가 나올까? 9가 나온다. 하지만 9를 다시 곱하기 연산 이전으로 되돌리면 뭐가 될까? 3이 될 수도 있고 -3이 될 수도 있다(9의 제곱근을 생각해보길). 이렇게 9 이전의 상태가 2개가 나올 수 있기 때문에 뭘로 복원해야 될지를 모르게 된다.\n다시 생각해보면 9를 이전으로 되돌리기 위해서는 이전에 어떠했는지에 대한 상태를 저장해야 한다. 이렇게 상태를 저장하는 로직을 구현할 때 필요한게 바로 Memento 패턴이다.</p>\n<p>텍스트 에디터나 IDE의 Undo, Redo 기능을 보면 이렇게 상태를 캡쳐하여 저장한 뒤 Undo, Redo 이벤트가 발생하면 해당 상태를 복원하는 식으로 구현이 되어 있다고 한다. 그래서 메모리에 상태를 저장하는데 한계가 있으므로 Undo, Redo 횟수가 제한되어 있는 경우가 많다.</p>","frontmatter":{"title":"Todo 앱을 통한 Memento Pattern의 이해 (with Java, Vaadin)","date":"2019-09-03 06:55:28","tags":["java","vaadin","design pattern","memento pattern"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2019/09/03/20190903-memento-pattern/","previous":{"fields":{"slug":"/2019/09/02/20190902-command-pattern/"},"frontmatter":{"title":"Todo 앱을 통한 Command Pattern의 이해 (with Java, Vaadin)"}},"next":null}}