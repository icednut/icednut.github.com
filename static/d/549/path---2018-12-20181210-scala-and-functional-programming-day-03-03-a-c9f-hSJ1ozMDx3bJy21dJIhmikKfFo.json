{"data":{"site":{"siteMetadata":{"title":"Icednut's Notes","author":"Will Lee","siteUrl":"https://icednut.github.io"}},"markdownRemark":{"id":"d6de316d-248e-5c3d-8b1e-b2af8d1aa903","excerpt":"출처: 스칼라로 배우는 함수형 프로그래밍 4장Chapter 04. 예외를 이용하지 않은 오류 처리이번 챕터에서 다룰 내용예외를 던지는 기존의 방식 살펴보기예외를 던지는게 왜 어때서?예외를 안던지고 반환하면 뭐가 좋을까?예외를 던지지 않고 예외 처리를 미루는 방법 Option…","html":"<p>출처: 스칼라로 배우는 함수형 프로그래밍 4장</p>\n<h2>Chapter 04. 예외를 이용하지 않은 오류 처리</h2>\n<p>이번 챕터에서 다룰 내용</p>\n<ul>\n<li>\n<p>예외를 던지는 기존의 방식 살펴보기</p>\n<ul>\n<li>예외를 던지는게 왜 어때서?</li>\n<li>예외를 안던지고 반환하면 뭐가 좋을까?</li>\n</ul>\n</li>\n<li>예외를 던지지 않고 예외 처리를 미루는 방법 Option</li>\n<li>예외를 미루지 말고 예외를 반환하기 Either</li>\n</ul>\n<br/>\n<br/>\n<h3>예외를 던지는 기존 방식</h3>\n<p>1장에서 예외(exception)을 던지는 것이 하나의 부수 효과라고 말했다. (함수형 프로그래밍에서는 부수 효과가 쥐약인데…)</p>\n<blockquote>\n<h5>여기서 잠깐?!</h5>\n<p>Q: 그럼 예외를 던지지 않는다면 어떻게 처리할까?</p>\n<ul>\n<li>A: <code class=\"language-text\">예외를 값으로 돌려주기</code>를 하면 부수효과 없는 함수를 만들 수 있게 된다.</li>\n</ul>\n<p>Q: 예외를 값으로 돌려주면 뭐가 좋을까?</p>\n<ul>\n<li>A: <code class=\"language-text\">참조 투명성</code>을 유지할 수 있게 된다. (참조 투명성을 유지하는 것이 왜 중요한지는 생략)</li>\n</ul>\n<p>오류(유효하지 않은 출력)에 대한 처리를 컴파일 타임에 명시할 수 있게 된다.</p>\n</blockquote>\n<p>예외를 명시적으로 처리하게 하거나 예외를 값으로 반환하기 위해서는 Option과 Either를 사용해야 한다. 이번 장에서는 Option과 Either를 직접 만들어보면서 이해와 사용 방법을 익혀보자.</p>\n<h4>예외가 왜 참조 투명성을 해칠까?</h4>\n<div class=\"gatsby-highlight\" data-language=\"scala\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-scala line-numbers\"><code class=\"language-scala\"><span class=\"token keyword\">def</span> failingFn1<span class=\"token punctuation\">(</span>i<span class=\"token operator\">:</span> <span class=\"token builtin\">Int</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Int</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">val</span> y<span class=\"token operator\">:</span> <span class=\"token builtin\">Int</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> Exception<span class=\"token punctuation\">(</span><span class=\"token string\">\"fail!\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">val</span> x <span class=\"token operator\">=</span> <span class=\"token number\">42</span> <span class=\"token operator\">+</span> <span class=\"token number\">5</span>\n        x <span class=\"token operator\">+</span> y\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">case</span> e<span class=\"token operator\">:</span> Exception <span class=\"token keyword\">=></span> <span class=\"token number\">43</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">def</span> failingFn2<span class=\"token punctuation\">(</span>i<span class=\"token operator\">:</span> <span class=\"token builtin\">Int</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Int</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">val</span> x <span class=\"token operator\">=</span> <span class=\"token number\">42</span> <span class=\"token operator\">+</span> <span class=\"token number\">5</span>\n        x <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> Exception<span class=\"token punctuation\">(</span><span class=\"token string\">\"fail!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Int</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">case</span> e<span class=\"token operator\">:</span> Exception <span class=\"token keyword\">=></span> <span class=\"token number\">43</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>위 함수들을 실행하면 failingFn1을 실행하면 예외가 발생하고 failingFn2를 실행하면 43이 반환된다. 이 결과가 시사하는 바가 뭘까?</p>\n<p>참조에 투명한 문맥이라면 y를 값으로 치환해도 항상 동일한 결과를 반환해야 한다. 하지만 위 예외 발생코드는 문맥의 위치에 따라서 결과값이 달라지는 현상이 발생하고 있다.(try 안에 있느냐 밖에 있느냐..) 즉 문맥(Context)에 의존적이라는 의미다. </p>\n<p>따라서 예외의 문제점은 다음과 같다.</p>\n<ul>\n<li>예외는 참조 투명성을 위반하고 문맥 의존성을 갖게 만든다.</li>\n<li>\n<p>예외가 있는 함수는 리턴에 대해 예측 불가능하다.</p>\n<ul>\n<li>failingFn 함수형식인 Int => Int 만 보고도 예외가 발생할지 알 수 있는가?</li>\n</ul>\n</li>\n</ul>\n<h4>그럼 참조 투명성 있는 예외를 다루는 함수를 만들려면?</h4>\n<p>이거 한 가지만 기억하자. <code class=\"language-text\">예외를 던지지 말고, 예외적인 조건이 발생했음을 뜻하는 값을 돌려주자.</code></p>\n<p>그렇게 하면 예외적인 조건에 대한 처리를 받는 쪽에서 처리해야만 컴파일 통과하게 된다. 참조 투명성도 지키고 예외 처리를 빼먹는 실수도 미연에 방지할 수 있게 된다.</p>\n<blockquote>\n<h5>여기서 잠깐?!</h5>\n<p>Q: Java의 Checked Exception은 예외를 던지면서 동시에 예외 처리를 컴파일 타임에 강제하지 않는가? 이거랑 뭐가 다른건지?</p>\n<ul>\n<li>A: Checked Exception은 고차함수에는 통하지 않는 단점이 있다. 예를 들어 List.map과 같은 고차함수에는 익명 함수에서 Checked Exception이 발생한다면 그 모든 Checked Exception 마다 List.map에 처리를 추가할 것인가?</li>\n<li>(그야말로 이건 미친짓이다..)</li>\n</ul>\n</blockquote>\n<p>그럼 또 다른 예외를 반환하는 부수효과가 있는 함수를 살펴보고 부수효과를 없애보는 과정을 살펴보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"scala\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-scala line-numbers\"><code class=\"language-scala\"><span class=\"token keyword\">def</span> mean<span class=\"token punctuation\">(</span>xs<span class=\"token operator\">:</span> Seq<span class=\"token punctuation\">[</span><span class=\"token builtin\">Double</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Double</span> <span class=\"token operator\">=</span> \n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>xs<span class=\"token punctuation\">.</span>isEmpty<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> ArithmeticException<span class=\"token punctuation\">(</span><span class=\"token string\">\"mean of empty list!\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">else</span> xs<span class=\"token punctuation\">.</span>sum <span class=\"token operator\">/</span> xs<span class=\"token punctuation\">.</span>length</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>위 mean 함수는 xs 파라미터에 따라 예외를 발생할 수도 있고 계산된 결과 값을 반환할 수도 있다. 즉 일부 입력에 대해서는 값을 반환하지 않는 부분함수(partial function)이다.</p>\n<h5>해결1: 예외 대신 null을 반환한다.</h5>\n<p>null을 반환하면 또 다른 문제만 만들뿐이다.</p>\n<ul>\n<li>null 처리를 빼먹을 수 있는 실수를 발생하게 만든다. (게다가 이건 컴파일 타임에 잡히지도 않는다.)</li>\n<li>혹은 null을 검사하는 로직을 넣어야 한다. (if문으로 null을 체크하는 판에 박힌 코드가 생긴다.)</li>\n<li>\n<p>지금은 반환 가능한 Double이지만 커링에서는 어떻게 할 것인가? 이때는 null로도 반환할 수 없다.</p>\n<ul>\n<li><code class=\"language-text\">def max[A](xs: Seq[A])(greater: (A, A) =&gt; Boolean): A</code></li>\n<li>위와 같은 함수 형식에서 xs.isEmpty일 때 null을 반환한다고? null 반환 못한다고!!</li>\n</ul>\n</li>\n</ul>\n<h5>해결2: 예외적인 상황에 처했을 때 반환할 값을 인자로 전달한다.</h5>\n<div class=\"gatsby-highlight\" data-language=\"scala\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-scala line-numbers\"><code class=\"language-scala\"><span class=\"token keyword\">def</span> mean_1<span class=\"token punctuation\">(</span>xs<span class=\"token operator\">:</span> IndexedSeq<span class=\"token punctuation\">[</span><span class=\"token builtin\">Double</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> onEmpty<span class=\"token operator\">:</span> <span class=\"token builtin\">Double</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Double</span> <span class=\"token operator\">=</span> \n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>xs<span class=\"token punctuation\">.</span>isEmpty<span class=\"token punctuation\">)</span> onEmpty\n  <span class=\"token keyword\">else</span> xs<span class=\"token punctuation\">.</span>sum <span class=\"token operator\">/</span> xs<span class=\"token punctuation\">.</span>length</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>이렇게 되면 모든 입력 값에 대해 모든 반환 값을 받으므로 완전 함수(total function)이 되지만, 여기에도 문제가 있다.</p>\n<ul>\n<li>onEmpty를 넘기지 않고도 mean_1 호출하는 것 자체를 취소하고 싶으면 어떻게 할까? (또 if라는 틀에 박힌 코드가 생기겠지..)</li>\n<li>아니면 예외적인 상황에서 완전히 다른 분기로 넘기려면? (역시 중복코드와 실수를 유발할 수 있음)</li>\n</ul>\n<p>결국 해결1, 2는 진정한 해결이 아니라는 의미다.</p>\n<h5>해결3: 예외 처리를 호출하는 곳으로 미루자.</h5>\n<p>바로 다음과 같이 말이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"scala\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-scala line-numbers\"><code class=\"language-scala\"><span class=\"token keyword\">def</span> mean<span class=\"token punctuation\">(</span>xs<span class=\"token operator\">:</span> Seq<span class=\"token punctuation\">[</span><span class=\"token builtin\">Double</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Option<span class=\"token punctuation\">[</span><span class=\"token builtin\">Double</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> \n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>xs<span class=\"token punctuation\">.</span>isEmpty<span class=\"token punctuation\">)</span> None\n  <span class=\"token keyword\">else</span> Some<span class=\"token punctuation\">(</span>xs<span class=\"token punctuation\">.</span>sum <span class=\"token operator\">/</span> xs<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>이렇게 되면 mean을 호출하면 항상 Option을 받기 때문에 완전 함수(total function)이 된다. (야호!) 또한 유효하지 않은 값(None)에 대한 처리를 호출하는 곳에서 명시를 해야하기 때문에 컴파일 타임에서 오류를 미연에 방지하는 코드를 작성하게 된다.</p>\n<h3>예외를 던지지 않고 예외 처리를 미루는 방법 Option</h3>\n<p>그럼 Option의 정의를 살펴보고 직접 구현해보자.</p>\n<h4>연습문제 4.1</h4>\n<script src=\"https://scastie.scala-lang.org/icednut/FsLInrZaQIaPGDHqE0tCnQ.js\"></script>\n<blockquote>\n<h5>여기서 잠깐?!</h5>\n<ul>\n<li><code class=\"language-text\">default: =&gt; B</code>는 타입은 B이지만 default가 실제로 쓰이기 전까지는 평가(실행 혹은 참조)하지 않는다.</li>\n<li><code class=\"language-text\">B &gt;: A</code>는 B가 A와 같거나 A의 상위 형식(Supertype)이어야 함을 뜻한다.</li>\n</ul>\n</blockquote>\n<p>Option을 쓰게 되면 값이 없다거나라는 점검 코드를 작성하지 않고도 그냥 코드를 작성하면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"scala\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-scala line-numbers\"><code class=\"language-scala\"><span class=\"token keyword\">case</span> <span class=\"token keyword\">class</span> Employee<span class=\"token punctuation\">(</span>name<span class=\"token operator\">:</span> <span class=\"token builtin\">String</span><span class=\"token punctuation\">,</span> department<span class=\"token operator\">:</span> <span class=\"token builtin\">String</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> lookupByName<span class=\"token punctuation\">(</span>name<span class=\"token operator\">:</span> <span class=\"token builtin\">String</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Option<span class=\"token punctuation\">[</span>Employee<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token operator\">?</span><span class=\"token operator\">?</span><span class=\"token operator\">?</span>\n\n<span class=\"token keyword\">def</span> joeDepartment<span class=\"token operator\">:</span> Option<span class=\"token punctuation\">[</span><span class=\"token builtin\">String</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> lookupByName<span class=\"token punctuation\">(</span><span class=\"token string\">\"Joe\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>map<span class=\"token punctuation\">(</span>_<span class=\"token punctuation\">.</span>department<span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// lookupByName(\"Joe\")의 결과가 없으면 None을 반환하기 때문에 .map 호출이 유효하다.</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>위 코드를 보면 None일 때 점검하는 코드를 작성했는가? 전혀 아니다.</p>\n<p>또 예외처리에 대해 호출자에서 일관된 처리를 하게 만들 수 있고 문맥에 의존적인 오류로직 따위는 저멀리 사라지게 된다.</p>\n<p>그렇다면 Option을 사용하지 않는 기존의 함수들에 대해서 Option을 적용하고 싶다면 어떻게 할까?</p>\n<div class=\"gatsby-highlight\" data-language=\"scala\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-scala line-numbers\"><code class=\"language-scala\"> <span class=\"token keyword\">def</span> insuranceRateQuote<span class=\"token punctuation\">(</span>age<span class=\"token operator\">:</span> <span class=\"token builtin\">Int</span><span class=\"token punctuation\">,</span> numberOfSpeedingTickets<span class=\"token operator\">:</span> <span class=\"token builtin\">Int</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Double</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>예를 들어 위 함수를 호출하는 함수를 만든다고 해보자. 이 때 인자에 문자열에서 숫자로 파싱하여 전달한다고 할 때 제대로 파싱되면 호출하고 아니라면 호출하지 않게 하려면 어떻게 할까?</p>\n<div class=\"gatsby-highlight\" data-language=\"scala\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-scala line-numbers\"><code class=\"language-scala\"><span class=\"token keyword\">def</span> parseInsuranceRateQuote<span class=\"token punctuation\">(</span>age<span class=\"token operator\">:</span> <span class=\"token builtin\">String</span><span class=\"token punctuation\">,</span> numberOfSpeedingTickets<span class=\"token operator\">:</span> <span class=\"token builtin\">String</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Option<span class=\"token punctuation\">[</span><span class=\"token builtin\">Double</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">val</span> optAge<span class=\"token operator\">:</span> Option<span class=\"token punctuation\">[</span><span class=\"token builtin\">Int</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> Try<span class=\"token punctuation\">(</span>age<span class=\"token punctuation\">.</span>toInt<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">val</span> optNumberOfSpeedingTickets<span class=\"token operator\">:</span> Option<span class=\"token punctuation\">[</span><span class=\"token builtin\">Int</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> Try<span class=\"token punctuation\">(</span>numberOfSpeedingTickets<span class=\"token punctuation\">.</span>toInt<span class=\"token punctuation\">)</span>\n    \n    insuranceRateQuote<span class=\"token punctuation\">(</span>optAge<span class=\"token punctuation\">,</span> optNumberOfSpeeedingTickets<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">def</span> Try<span class=\"token punctuation\">[</span>A<span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span>a<span class=\"token operator\">:</span> <span class=\"token keyword\">=></span> A<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Option<span class=\"token punctuation\">[</span>A<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> \n  <span class=\"token keyword\">try</span> Some<span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">case</span> e<span class=\"token operator\">:</span> Exception <span class=\"token keyword\">=></span> None <span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>여기서 <code class=\"language-text\">age.toInt</code>와 <code class=\"language-text\">numberOfSpeedingTickets.toInt</code>는 충분히 예외가 발생할 수 있는 로직이다. 그러나 Try라는 함수 덕분에 Option으로 감쌀 수 있다. 그러나 문제는 insuranceRateQuote 함수의 인자는 Option을 받을 수 없고 Int만 받을 수 있다.</p>\n<p>이걸 어떻게 해결할까? insuranceRateQuote 함수의 인자를 고쳐야 하는 것일까?</p>\n<p>답은 커링을 써서 값이 있으면 insuranceRateQuote 함수를 호출하고 아니라면 None을 반환하는 고차함수(map2)를 작성한다. 그 고차함수 호출은 다음과 같은 형태가 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"scala\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-scala line-numbers\"><code class=\"language-scala\"><span class=\"token keyword\">def</span> parseInsuranceRateQuote<span class=\"token punctuation\">(</span>age<span class=\"token operator\">:</span> <span class=\"token builtin\">String</span><span class=\"token punctuation\">,</span> numberOfSpeedingTickets<span class=\"token operator\">:</span> <span class=\"token builtin\">String</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Option<span class=\"token punctuation\">[</span><span class=\"token builtin\">Double</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">val</span> optAge<span class=\"token operator\">:</span> Option<span class=\"token punctuation\">[</span><span class=\"token builtin\">Int</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> Try <span class=\"token punctuation\">{</span> age<span class=\"token punctuation\">.</span>toInt <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">val</span> optTickets<span class=\"token operator\">:</span> Option<span class=\"token punctuation\">[</span><span class=\"token builtin\">Int</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> Try <span class=\"token punctuation\">{</span> numberOfSpeedingTickets<span class=\"token punctuation\">.</span>toInt <span class=\"token punctuation\">}</span>\n    map2<span class=\"token punctuation\">(</span>optAge<span class=\"token punctuation\">,</span> optTickets<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>insuranceRateQuote<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>그럼 map2를 구현해보자.</p>\n<h4>연습문제 4.3</h4>\n<script src=\"https://scastie.scala-lang.org/icednut/p0C17LMMTb2ahDZjQ3nKZw.js\"></script>\n<p>그럼 map2 함수에서 좀 더 발전하여 인수 2개 뿐만 아니라 목록으로 받는 고차함수를 작성해보자.</p>\n<h4>연습문제 4.4</h4>\n<script src=\"https://scastie.scala-lang.org/icednut/ftjs3S72RLGQQ8kIv52iCQ.js\"></script>\n<p><code class=\"language-text\">parseInts</code> 함수를 보면 문제점이 하나 있다.</p>\n<p><code class=\"language-text\">a map (i =&gt; MyTry(i.toInt))</code> 때문에 리스트를 한 번 훑어서 <code class=\"language-text\">Option[Int]</code>로 변환한 뒤 <code class=\"language-text\">sequence()</code>의 함수 내부에서 한 번 또 훑는 작업(for-comprehension)을 타서 총 2번의 루프를 타게 된다.</p>\n<p>이걸 해결하기 위해 traverse라는 고차함수를 만들어보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"scala\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-scala line-numbers\"><code class=\"language-scala\"><span class=\"token keyword\">def</span> traverse<span class=\"token punctuation\">[</span>A<span class=\"token punctuation\">,</span> B<span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span>a<span class=\"token operator\">:</span> List<span class=\"token punctuation\">[</span>A<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>f<span class=\"token operator\">:</span> A <span class=\"token keyword\">=></span> Option<span class=\"token punctuation\">[</span>B<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Option<span class=\"token punctuation\">[</span>List<span class=\"token punctuation\">[</span>B<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<h4>연습문제 4.5</h4>\n<script src=\"https://scastie.scala-lang.org/icednut/yDX7Ah8wTFSnimPOqVpWPg.js\"></script>\n<h3>예외를 미루지 말고 예외를 반환하기 Either</h3>\n<p>Option은 무엇이 잘못 되었는지는 생략되고 그냥 None이 반환될 뿐이다. 그러나 아래와 같이 하고 싶을 때도 있을 것이다.</p>\n<ul>\n<li>예외적인 상황에 마주했을 때 예외적인 상황에 대한 자세한 정보를 담은 String을 받고 싶다.</li>\n<li>예외가 발생한 경우 실제 그 예외를 알고 싶다. (Option일 경우는 무슨 예외인지 알 수 없고 그냥 None이기 때문)</li>\n</ul>\n<p>위 문제를 해결하기 위해 실패의 원인을 담고 있는 Either라는 자료 형식을 만들어보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"scala\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-scala line-numbers\"><code class=\"language-scala\"><span class=\"token keyword\">sealed</span> <span class=\"token keyword\">trait</span> Either<span class=\"token punctuation\">[</span><span class=\"token operator\">+</span>E<span class=\"token punctuation\">,</span> <span class=\"token operator\">+</span>A<span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">case</span> <span class=\"token keyword\">class</span> Left<span class=\"token punctuation\">[</span><span class=\"token operator\">+</span>E<span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span>value<span class=\"token operator\">:</span> E<span class=\"token punctuation\">)</span> <span class=\"token keyword\">extends</span> Either<span class=\"token punctuation\">[</span>E<span class=\"token punctuation\">,</span> <span class=\"token builtin\">Nothing</span><span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">case</span> <span class=\"token keyword\">class</span> Right<span class=\"token punctuation\">[</span><span class=\"token operator\">+</span>A<span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span>value<span class=\"token operator\">:</span> A<span class=\"token punctuation\">)</span> <span class=\"token keyword\">extends</span> Either<span class=\"token punctuation\">[</span><span class=\"token builtin\">Nothing</span><span class=\"token punctuation\">,</span> A<span class=\"token punctuation\">]</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>Either와 같은 자료 형식을 서로 소 합집합 즉 분리합집합이라고 한다. (왜? 값과 예외라는 서로 공통점이 없는 값들을 하나의 합집합으로 묶은 자료형이기 때문)</p>\n<p>Either의 사용방법은 다음과 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"scala\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-scala line-numbers\"><code class=\"language-scala\"><span class=\"token keyword\">def</span> mean<span class=\"token punctuation\">(</span>xs<span class=\"token operator\">:</span> IndexedSeq<span class=\"token punctuation\">[</span><span class=\"token builtin\">Double</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Either<span class=\"token punctuation\">[</span><span class=\"token builtin\">String</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">Double</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> \n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>xs<span class=\"token punctuation\">.</span>isEmpty<span class=\"token punctuation\">)</span> Left<span class=\"token punctuation\">(</span><span class=\"token string\">\"mean of empty list!\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">else</span> Right<span class=\"token punctuation\">(</span>xs<span class=\"token punctuation\">.</span>sum <span class=\"token operator\">/</span> xs<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> Try<span class=\"token punctuation\">[</span>A<span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span>a<span class=\"token operator\">:</span> <span class=\"token keyword\">=></span> A<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Either<span class=\"token punctuation\">[</span>Exception<span class=\"token punctuation\">,</span> A<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> \n  <span class=\"token keyword\">try</span> Right<span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">case</span> e<span class=\"token operator\">:</span> Exception <span class=\"token keyword\">=></span> Left<span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4>연습문제 4.6</h4>\n<script src=\"https://scastie.scala-lang.org/icednut/7uOiUSYvQBuD5HyWHB5HXg.js\"></script>\n<p>Either의 사용 예시를 살펴보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"scala\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-scala line-numbers\"><code class=\"language-scala\"><span class=\"token keyword\">def</span> parseInsuranceRateQuote<span class=\"token punctuation\">(</span>age<span class=\"token operator\">:</span> <span class=\"token builtin\">String</span><span class=\"token punctuation\">,</span> numberOfSpeedingTickets<span class=\"token operator\">:</span> <span class=\"token builtin\">String</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Either<span class=\"token punctuation\">[</span>Exception<span class=\"token punctuation\">,</span> <span class=\"token builtin\">Double</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> \n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">{</span>\n        a <span class=\"token keyword\">&lt;-</span> Try <span class=\"token punctuation\">{</span> age<span class=\"token punctuation\">.</span>toInt <span class=\"token punctuation\">}</span>\n        tickets <span class=\"token keyword\">&lt;-</span> Try <span class=\"token punctuation\">{</span> numberOfSpeedingTickets<span class=\"token punctuation\">.</span>toInt <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">yield</span> insuranceRateQuote<span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> tickets<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"scala\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-scala line-numbers\"><code class=\"language-scala\"><span class=\"token keyword\">case</span> <span class=\"token keyword\">class</span> Person<span class=\"token punctuation\">(</span>name<span class=\"token operator\">:</span> Name<span class=\"token punctuation\">,</span> age<span class=\"token operator\">:</span> Age<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">sealed</span> <span class=\"token keyword\">class</span> Name<span class=\"token punctuation\">(</span><span class=\"token keyword\">val</span> value<span class=\"token operator\">:</span> <span class=\"token builtin\">String</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">sealed</span> <span class=\"token keyword\">class</span> Age<span class=\"token punctuation\">(</span><span class=\"token keyword\">val</span> value<span class=\"token operator\">:</span> <span class=\"token builtin\">Int</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> mkName<span class=\"token punctuation\">(</span>name<span class=\"token operator\">:</span> <span class=\"token builtin\">String</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Either<span class=\"token punctuation\">[</span><span class=\"token builtin\">String</span><span class=\"token punctuation\">,</span> Name<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> \n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>name <span class=\"token operator\">==</span> <span class=\"token string\">\"\"</span> <span class=\"token operator\">||</span> name <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> Left<span class=\"token punctuation\">(</span><span class=\"token string\">\"Name is empty.\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">else</span> Right<span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> Name<span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> mkAge<span class=\"token punctuation\">(</span>age<span class=\"token operator\">:</span> <span class=\"token builtin\">Int</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Either<span class=\"token punctuation\">[</span><span class=\"token builtin\">String</span><span class=\"token punctuation\">,</span> Age<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> \n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>age <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> Left<span class=\"token punctuation\">(</span><span class=\"token string\">\"Age is out of range.\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">else</span> Right<span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> Age<span class=\"token punctuation\">(</span>age<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> mkPerson<span class=\"token punctuation\">(</span>name<span class=\"token operator\">:</span> <span class=\"token builtin\">String</span><span class=\"token punctuation\">,</span> age<span class=\"token operator\">:</span> <span class=\"token builtin\">Int</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Either<span class=\"token punctuation\">[</span><span class=\"token builtin\">String</span><span class=\"token punctuation\">,</span> Person<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> \n  mkName<span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>map2<span class=\"token punctuation\">(</span>mkAge<span class=\"token punctuation\">(</span>age<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>Person<span class=\"token punctuation\">(</span>_<span class=\"token punctuation\">,</span> _<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","frontmatter":{"title":"스칼라 스터디 Day03 - 예외를 이용하지 않은 오류 처리","date":"2018-12-10 23:47:36","tags":["scala","functional programming"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2018/12/20181210-scala-and-functional-programming-day03/","previous":{"fields":{"slug":"/2018/12/20181204-scala-and-functional-programming-day02/"},"frontmatter":{"title":"스칼라 스터디 Day02 - 함수적 자료구조"}},"next":{"fields":{"slug":"/2018/12/20181218-scala-and-functional-programming-day04/"},"frontmatter":{"title":"스칼라 스터디 Day04 - 엄격성과 나태성"}}}}