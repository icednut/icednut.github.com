{"data":{"site":{"siteMetadata":{"title":"Icednut's Notes","author":"Will Lee","siteUrl":"https://icednut.github.io"}},"markdownRemark":{"id":"00e628b2-3510-5144-bbb5-2ce7fd3bdf3f","excerpt":"요구사항 추가현재 Todo List 상태를 저장한 뒤에 나중에 필요할 때 복원하고 싶다. 저장 및 복원은 어떻게 구현할까?이럴 때 필요한게 Memento 패턴이다.\n\nTodo App with Memento PatternMemento…","html":"<h2>요구사항 추가</h2>\n<p>현재 Todo List 상태를 저장한 뒤에 나중에 필요할 때 복원하고 싶다. 저장 및 복원은 어떻게 구현할까?</p>\n<p>이럴 때 필요한게 Memento 패턴이다.\n<br/>\n<br/></p>\n<h2>Todo App with Memento Pattern</h2>\n<p>Memento 패턴에 집중하기 위해 다른 패턴들은 잠시 다 걷어내고 이전 포스트에서 봤던 Plain Todo App에 Todo 목록 저장, 복원 기능을 Memento 패턴을 이용하여 구현해보도록 하자.\n<br/>\n<br/></p>\n<p>우선 Save, Restore 버튼을 추가한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Route</span>\n<span class=\"token annotation punctuation\">@PWA</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"Design Pattern Exercise Memento Pattern\"</span><span class=\"token punctuation\">,</span> shortName <span class=\"token operator\">=</span> <span class=\"token string\">\"Memento Pattern Exercise\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MainView</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">VerticalLayout</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">final</span> <span class=\"token class-name\">VerticalLayout</span> todosList <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">VerticalLayout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">final</span> <span class=\"token class-name\">TextField</span> todoField <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TextField</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">final</span> <span class=\"token class-name\">Button</span> addButton <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Button</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Add\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">final</span> <span class=\"token class-name\">Button</span> saveButton <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Button</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Save\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">final</span> <span class=\"token class-name\">Button</span> restoreButton <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Button</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Restore\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">MainView</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        addButton<span class=\"token punctuation\">.</span><span class=\"token function\">addClickListener</span><span class=\"token punctuation\">(</span>event <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> todoValue <span class=\"token operator\">=</span> todoField<span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">StringUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">hasText</span><span class=\"token punctuation\">(</span>todoValue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">final</span> <span class=\"token class-name\">Checkbox</span> checkbox <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Checkbox</span><span class=\"token punctuation\">(</span>todoValue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">final</span> <span class=\"token class-name\">Icon</span> deleteButton <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Icon</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">VaadinIcon</span><span class=\"token punctuation\">.</span>CLOSE_CIRCLE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">final</span> <span class=\"token class-name\">HorizontalLayout</span> todoElementLayout <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HorizontalLayout</span><span class=\"token punctuation\">(</span>checkbox<span class=\"token punctuation\">,</span> deleteButton<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                deleteButton<span class=\"token punctuation\">.</span><span class=\"token function\">setSize</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"15px\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                deleteButton<span class=\"token punctuation\">.</span><span class=\"token function\">addClickListener</span><span class=\"token punctuation\">(</span>deleteEvent <span class=\"token operator\">-></span> todosList<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span>todoElementLayout<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                todoElementLayout<span class=\"token punctuation\">.</span><span class=\"token function\">setAlignItems</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Alignment</span><span class=\"token punctuation\">.</span>CENTER<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                todosList<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>todoElementLayout<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                todoField<span class=\"token punctuation\">.</span><span class=\"token function\">setValue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token function\">add</span><span class=\"token punctuation\">(</span>\n                todosList<span class=\"token punctuation\">,</span>\n                <span class=\"token keyword\">new</span> <span class=\"token class-name\">HorizontalLayout</span><span class=\"token punctuation\">(</span>\n                        <span class=\"token keyword\">new</span> <span class=\"token class-name\">HorizontalLayout</span><span class=\"token punctuation\">(</span>todoField<span class=\"token punctuation\">,</span> addButton<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token keyword\">new</span> <span class=\"token class-name\">Icon</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">VaadinIcon</span><span class=\"token punctuation\">.</span>CHEVRON_UP<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"gatsby-highlight-code-line\">                        <span class=\"token keyword\">new</span> <span class=\"token class-name\">HorizontalLayout</span><span class=\"token punctuation\">(</span>saveButton<span class=\"token punctuation\">,</span> restoreButton<span class=\"token punctuation\">)</span></span>                <span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>실행 화면은 다음과 같다.\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e937242f0406a849ad632aa8175c80dc/079dc/01.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 63.56026785714285%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAABHElEQVQ4y2OQlpGzVVbVmK1raDxZWU1zipSM/BRRMckpouKSU0TECGNRcakpEtJykyWl5WaJS0pXMUydNr304OGj/3ft2fd/5+69/7ds2/5/05Zt/zdv3f5/6zb8GKR22/adQL37/x85duL/8pUrHzM8fvIk9z8E/ADiX0D8mwz8E2rGJYYbN27kgVh///79AwT/gPg/kPUfRP/+DaXxYKj8H5AZnz59uspw69atPKjpf/5BwH8YBgFkNi4AlAcb+PXrV+IMJATwGvifDDB0Dfz9j3wANvDLly9XGe7cuQM3EJR6QBaSgcEGfv/+/QrD5cuXC8Cp+seP/79+/SILg/SCwNu3b28wtLa2qkyePDkGiCOAOJJMHAE1wx0ATTqF9sLFrjsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"01\"\n        title=\"\"\n        src=\"/static/e937242f0406a849ad632aa8175c80dc/b9e4f/01.png\"\n        srcset=\"/static/e937242f0406a849ad632aa8175c80dc/cf440/01.png 148w,\n/static/e937242f0406a849ad632aa8175c80dc/d2d38/01.png 295w,\n/static/e937242f0406a849ad632aa8175c80dc/b9e4f/01.png 590w,\n/static/e937242f0406a849ad632aa8175c80dc/f9b6a/01.png 885w,\n/static/e937242f0406a849ad632aa8175c80dc/2d849/01.png 1180w,\n/static/e937242f0406a849ad632aa8175c80dc/bbefa/01.png 1770w,\n/static/e937242f0406a849ad632aa8175c80dc/079dc/01.png 3584w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>그럼 Todo 목록 현황 즉 상태를 저장할 클래스가 필요하다. 상태 관리하는 클래스를 Originator라고 하자. (Memento 패턴에서는 상태 관리하는 클래스를 Originator라고 부른다.)</p>\n<hr>\n<h2>Memento 패턴과 Command 패턴을 결합한 Undo, Redo 기능 구현</h2>\n<p>잠시 Undo, Redo 구현을 떠나서 만약에 3 * 3 연산을 하면 뭐가 나올까? 9가 나온다. 하지만 9를 다시 곱하기 연산 이전으로 되돌리면 뭐가 될까? 3이 될 수도 있고 -3이 될 수도 있다(9의 제곱근을 생각해보길). 이렇게 9 이전의 상태가 2개가 나올 수 있기 때문에 뭘로 복원해야 될지를 모르게 된다.\n다시 생각해보면 9를 이전으로 되돌리기 위해서는 이전에 어떠했는지에 대한 상태를 저장해야 한다. 이렇게 상태를 저장하는 로직을 구현할 때 필요한게 바로 Memento 패턴이다.</p>\n<p>텍스트 에디터나 IDE의 Undo, Redo 기능을 보면 이렇게 상태를 캡쳐하여 저장한 뒤 Undo, Redo 이벤트가 발생하면 해당 상태를 복원하는 식으로 구현이 되어 있다고 한다. 그래서 메모리에 상태를 저장하는데 한계가 있으므로 Undo, Redo 횟수가 제한되어 있는 경우가 많다.</p>","frontmatter":{"title":"Todo 앱을 통한 Memento Pattern의 이해 (with Java, Vaadin)","date":"2019-09-03 06:55:28","tags":["java","vaadin","design pattern","memento pattern"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2019/09/03/20190903-memento-pattern/","previous":{"fields":{"slug":"/2019/09/02/20190902-command-pattern/"},"frontmatter":{"title":"Todo 앱을 통한 Command Pattern의 이해 (with Java, Vaadin)"}},"next":null}}