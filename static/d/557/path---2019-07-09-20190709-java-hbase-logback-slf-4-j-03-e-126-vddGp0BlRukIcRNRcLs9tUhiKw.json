{"data":{"site":{"siteMetadata":{"title":"Icednut's Notes","author":"Will Lee","siteUrl":"https://icednut.github.io"}},"markdownRemark":{"id":"d39b067a-cc8e-5668-9eb9-922b68c7b143","excerpt":"이슈: hbase-client 디펜던시를 추가하면 로그가 안나옴최근 logback을 사용하고 있는 스칼라 Akka 프로젝트에서 hbase를 연동할 일이 있어서  디펜던시 추가 후 hbase…","html":"<h3>이슈: hbase-client 디펜던시를 추가하면 로그가 안나옴</h3>\n<p>최근 logback을 사용하고 있는 스칼라 Akka 프로젝트에서 hbase를 연동할 일이 있어서 <code class=\"language-text\">hbase-shaded-client</code> 디펜던시 추가 후 hbase 관련 데이터 조회 및 저장 작업을 진행하게 되었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"scala\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-scala line-numbers\"><code class=\"language-scala\"><span class=\"token comment\">// build.sbt</span>\nlibraryDependencies <span class=\"token operator\">++</span><span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"com.typesafe.akka\"</span> <span class=\"token operator\">%</span><span class=\"token operator\">%</span> <span class=\"token string\">\"akka-slf4j\"</span> <span class=\"token operator\">%</span> akkaVersion<span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"com.typesafe.scala-logging\"</span> <span class=\"token operator\">%</span><span class=\"token operator\">%</span> <span class=\"token string\">\"scala-logging\"</span> <span class=\"token operator\">%</span> scalaLoggingVersion<span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"ch.qos.logback\"</span> <span class=\"token operator\">%</span> <span class=\"token string\">\"logback-classic\"</span> <span class=\"token operator\">%</span> <span class=\"token string\">\"1.1.7\"</span><span class=\"token punctuation\">,</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token string\">\"org.apache.hbase\"</span> <span class=\"token operator\">%</span> <span class=\"token string\">\"hbase-shaded-client\"</span> <span class=\"token operator\">%</span> hbaseClientVersion</span><span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>그런데 위 디펜던시를 추가한 순간 콘솔에 로그가 나오질 않았다. 정확하게는 <code class=\"language-text\">org.slf4j.Logger</code>로 출력한 내용은 나오질 않고 System.out.print로 출력한 코드만 나오고 있었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"plain\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-plain line-numbers\"><code class=\"language-plain\">// 서버 로그 \n\n/Library/Java/JavaVirtualMachines/jdk1.8.0_201.jdk/Contents/Home/bin/java ...\nConnected to the target VM, address: &#39;127.0.0.1:55918&#39;, transport: &#39;socket&#39;\nSLF4J: Class path contains multiple SLF4J bindings.\nSLF4J: Found binding in [jar:file:/Users/xxx/.ivy2/cache/org.slf4j/slf4j-log4j12/jars/slf4j-log4j12-1.7.5.jar!/org/slf4j/impl/StaticLoggerBinder.class]\nSLF4J: Found binding in [jar:file:/Users/xxx/.ivy2/cache/ch.qos.logback/logback-classic/jars/logback-classic-1.1.7.jar!/org/slf4j/impl/StaticLoggerBinder.class]\nSLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an explanation.\nSLF4J: Actual binding is of type [org.slf4j.impl.Log4jLoggerFactory]\nlog4j:WARN No appenders could be found for logger (com.xxx.DatabaseSupport$).\nlog4j:WARN Please initialize the log4j system properly.\nlog4j:WARN See http://logging.apache.org/log4j/1.2/faq.html#noconfig for more info.\nJava config name: ***\nLoaded from Java config\nJava config name: ***\nLoaded from Java config\n&gt;&gt;&gt; KdcAccessibility: reset\n&gt;&gt;&gt; KdcAccessibility: reset\n...</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>근데 또 어떨 때는 slf4j-log4j12/StaticLoggerBinder와 logback/StaticLoggerBinder의 로딩 순서가 서로 바뀌면서 로딩이 되면서 로그가 나오는 경우도 있었다. (허허…)</p>\n<div class=\"gatsby-highlight\" data-language=\"plain\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-plain line-numbers\"><code class=\"language-plain\">// 서버 로그\n\n/Library/Java/JavaVirtualMachines/jdk1.8.0_201.jdk/Contents/Home/bin/java ...\nConnected to the target VM, address: &#39;127.0.0.1:56170&#39;, transport: &#39;socket&#39;\nSLF4J: Class path contains multiple SLF4J bindings.\nSLF4J: Found binding in [jar:file:/Users/xxx/.ivy2/cache/ch.qos.logback/logback-classic/jars/logback-classic-1.1.7.jar!/org/slf4j/impl/StaticLoggerBinder.class]\nSLF4J: Found binding in [jar:file:/Users/xxx/.ivy2/cache/org.slf4j/slf4j-log4j12/jars/slf4j-log4j12-1.7.5.jar!/org/slf4j/impl/StaticLoggerBinder.class]\nSLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an explanation.\nSLF4J: Actual binding is of type [ch.qos.logback.classic.util.ContextSelectorStaticBinder]\n[xxx-macbook.local:2019-07-10 11:23:21] INFO [com.xxx.DatabaseSupport$:&lt;init&gt;:14] initializing database mysql\n[xxx-macbook.local:2019-07-10 11:23:21] WARN [slick.basic.DatabaseConfig:warn:25] Use `mysql.profile` instead of `mysql.driver`. The latter is deprecated since Slick 3.2 and will be removed.\n[xxx-macbook.local:2019-07-10 11:23:21] DEBUG [com.zaxxer.hikari.HikariConfig:logConfiguration:841] mysql.db - configuration:\n[xxx-macbook.local:2019-07-10 11:23:21] DEBUG [com.zaxxer.hikari.HikariConfig:logConfiguration:857] allowPoolSuspension.............false\n[xxx-macbook.local:2019-07-10 11:23:21] DEBUG [com.zaxxer.hikari.HikariConfig:logConfiguration:857] autoCommit......................true\n[xxx-macbook.local:2019-07-10 11:23:21] DEBUG [com.zaxxer.hikari.HikariConfig:logConfiguration:857] catalog.........................null\n[xxx-macbook.local:2019-07-10 11:23:21] DEBUG [com.zaxxer.hikari.HikariConfig:logConfiguration:857] connectionInitSql...............null\n[xxx-macbook.local:2019-07-10 11:23:21] DEBUG [com.zaxxer.hikari.HikariConfig:logConfiguration:857] connectionTestQuery.............null\n[xxx-macbook.local:2019-07-10 11:23:21] DEBUG [com.zaxxer.hikari.HikariConfig:logConfiguration:857] connectionTimeout...............1000\n[xxx-macbook.local:2019-07-10 11:23:21] DEBUG [com.zaxxer.hikari.HikariConfig:logConfiguration:857] dataSource......................null\n[xxx-macbook.local:2019-07-10 11:23:21] DEBUG [com.zaxxer.hikari.HikariConfig:logConfiguration:857] dataSourceClassName.............null\n[xxx-macbook.local:2019-07-10 11:23:21] DEBUG [com.zaxxer.hikari.HikariConfig:logConfiguration:857] dataSourceJNDI..................null\n...</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<br/>\n<br/>\n<h3>해결</h3>\n<p>구글에서 좀 찾아보니 hbase-client 추가 후 로그가 안나올 경우 slf4j, log4j 디펜던시를 exclude 해보라는 글이 보였다. (<a href=\"https://kimfish.co.kr/285\">https://kimfish.co.kr/285</a>) 그래서 아래와 같이 slf4j와 log4j 디펜던시를 제외한 후 어플리케이션을 재시작해보니 로그가 정상적으로 나왔다. 심지어 StaticLoggerBinder 클래스를 여러 개 찾았다는 로그도 보이질 않았다.</p>\n<div class=\"gatsby-highlight\" data-language=\"scala\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-scala line-numbers\"><code class=\"language-scala\"><span class=\"token comment\">// build.sbt</span>\nlibraryDependencies <span class=\"token operator\">++</span><span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"com.typesafe.akka\"</span> <span class=\"token operator\">%</span><span class=\"token operator\">%</span> <span class=\"token string\">\"akka-slf4j\"</span> <span class=\"token operator\">%</span> akkaVersion<span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"com.typesafe.scala-logging\"</span> <span class=\"token operator\">%</span><span class=\"token operator\">%</span> <span class=\"token string\">\"scala-logging\"</span> <span class=\"token operator\">%</span> scalaLoggingVersion<span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"ch.qos.logback\"</span> <span class=\"token operator\">%</span> <span class=\"token string\">\"logback-classic\"</span> <span class=\"token operator\">%</span> <span class=\"token string\">\"1.1.7\"</span><span class=\"token punctuation\">,</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token string\">\"org.apache.hbase\"</span> <span class=\"token operator\">%</span> <span class=\"token string\">\"hbase-shaded-client\"</span> <span class=\"token operator\">%</span> hbaseClientVersion excludeAll<span class=\"token punctuation\">(</span></span><span class=\"gatsby-highlight-code-line\">    ExclusionRule<span class=\"token punctuation\">(</span>organization <span class=\"token operator\">=</span> <span class=\"token string\">\"org.slf4j\"</span><span class=\"token punctuation\">,</span> name <span class=\"token operator\">=</span> <span class=\"token string\">\"slf4j-log4j12\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">    ExclusionRule<span class=\"token punctuation\">(</span>organization <span class=\"token operator\">=</span> <span class=\"token string\">\"log4j\"</span><span class=\"token punctuation\">,</span> name <span class=\"token operator\">=</span> <span class=\"token string\">\"log4j\"</span><span class=\"token punctuation\">)</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">// 서버 로그\n\n/Library/Java/JavaVirtualMachines/jdk1.8.0_201.jdk/Contents/Home/bin/java ...\nConnected to the target VM, address: &#39;127.0.0.1:56047&#39;, transport: &#39;socket&#39;\n[xxx-macbook.local:2019-07-10 11:17:52] INFO [com.xxx.DatabaseSupport$:&lt;init&gt;:14] initializing database mysql\n[xxx-macbook.local:2019-07-10 11:17:52] WARN [slick.basic.DatabaseConfig:warn:25] Use `mysql.profile` instead of `mysql.driver`. The latter is deprecated since Slick 3.2 and will be removed.\n[xxx-macbook.local:2019-07-10 11:17:53] DEBUG [com.zaxxer.hikari.HikariConfig:logConfiguration:841] mysql.db - configuration:\n[xxx-macbook.local:2019-07-10 11:17:53] DEBUG [com.zaxxer.hikari.HikariConfig:logConfiguration:857] allowPoolSuspension.............false\n[xxx-macbook.local:2019-07-10 11:17:53] DEBUG [com.zaxxer.hikari.HikariConfig:logConfiguration:857] autoCommit......................true\n[xxx-macbook.local:2019-07-10 11:17:53] DEBUG [com.zaxxer.hikari.HikariConfig:logConfiguration:857] catalog.........................null\n[xxx-macbook.local:2019-07-10 11:17:53] DEBUG [com.zaxxer.hikari.HikariConfig:logConfiguration:857] connectionInitSql...............null\n[xxx-macbook.local:2019-07-10 11:17:53] DEBUG [com.zaxxer.hikari.HikariConfig:logConfiguration:857] connectionTestQuery.............null\n[xxx-macbook.local:2019-07-10 11:17:53] DEBUG [com.zaxxer.hikari.HikariConfig:logConfiguration:857] connectionTimeout...............1000\n[xxx-macbook.local:2019-07-10 11:17:53] DEBUG [com.zaxxer.hikari.HikariConfig:logConfiguration:857] dataSource......................null\n[xxx-macbook.local:2019-07-10 11:17:53] DEBUG [com.zaxxer.hikari.HikariConfig:logConfiguration:857] dataSourceClassName.............null\n[xxx-macbook.local:2019-07-10 11:17:53] DEBUG [com.zaxxer.hikari.HikariConfig:logConfiguration:857] dataSourceJNDI..................null\n...\nJava config name: ***\nLoaded from Java config\nJava config name: ***\nLoaded from Java config\n&gt;&gt;&gt; KdcAccessibility: reset\n&gt;&gt;&gt; KdcAccessibility: reset\n...</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<br/>\n<br/>\n<h3>왜 그런걸까?</h3>\n<p>답은 이미 로그에 나와있다. 먼저 첫 번째 서버 로그를 살펴보면 slf4j-log4j12의 StaticLoggerBinder가 먼저 로딩되고 있었다. </p>\n<div class=\"gatsby-highlight\" data-language=\"plain\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-plain line-numbers\"><code class=\"language-plain\">// 서버 로그 \n\n/Library/Java/JavaVirtualMachines/jdk1.8.0_201.jdk/Contents/Home/bin/java ...\nConnected to the target VM, address: &#39;127.0.0.1:55918&#39;, transport: &#39;socket&#39;\nSLF4J: Class path contains multiple SLF4J bindings.\nSLF4J: Found binding in [jar:file:/Users/xxx/.ivy2/cache/org.slf4j/slf4j-log4j12/jars/slf4j-log4j12-1.7.5.jar!/org/slf4j/impl/StaticLoggerBinder.class]\nSLF4J: Found binding in [jar:file:/Users/xxx/.ivy2/cache/ch.qos.logback/logback-classic/jars/logback-classic-1.1.7.jar!/org/slf4j/impl/StaticLoggerBinder.class]\nSLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an explanation.\nSLF4J: Actual binding is of type [org.slf4j.impl.Log4jLoggerFactory]\nlog4j:WARN No appenders could be found for logger (com.xxx.DatabaseSupport$).\nlog4j:WARN Please initialize the log4j system properly.\nlog4j:WARN See http://logging.apache.org/log4j/1.2/faq.html#noconfig for more info.\n...</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>문제는 slf4j-log4j12의 로그 바인더가 로딩이 되었지만 프로젝트에는 로그 출력에 대한 설정이 없기 때문에 로그 출력이 되질 않았던 것이다. 두 번째 서버 로그에는 다행히도 logback의 로그 바인더가 먼저 로딩이 되었고 프로젝트에는 이미 logback 관련 서버 로그 출력 설정이 되어 있어서 서버 로그가 출력이 되고 있었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"plain\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-plain line-numbers\"><code class=\"language-plain\">// 서버 로그\n\n/Library/Java/JavaVirtualMachines/jdk1.8.0_201.jdk/Contents/Home/bin/java ...\nConnected to the target VM, address: &#39;127.0.0.1:56170&#39;, transport: &#39;socket&#39;\nSLF4J: Class path contains multiple SLF4J bindings.\nSLF4J: Found binding in [jar:file:/Users/xxx/.ivy2/cache/ch.qos.logback/logback-classic/jars/logback-classic-1.1.7.jar!/org/slf4j/impl/StaticLoggerBinder.class]\nSLF4J: Found binding in [jar:file:/Users/xxx/.ivy2/cache/org.slf4j/slf4j-log4j12/jars/slf4j-log4j12-1.7.5.jar!/org/slf4j/impl/StaticLoggerBinder.class]\nSLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an explanation.\nSLF4J: Actual binding is of type [ch.qos.logback.classic.util.ContextSelectorStaticBinder]\n...</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-xml line-numbers\"><code class=\"language-xml\">logback.xml\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>configuration</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>appender</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>APPLICATION<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>ch.qos.logback.core.rolling.RollingFileAppender<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>File</span><span class=\"token punctuation\">></span></span>${LOG_PATH}/application.log<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>File</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>encoder</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>pattern</span><span class=\"token punctuation\">></span></span>[${HOSTNAME}:%d{yyyy-MM-dd HH:mm:ss}] %level [%logger:%method:%L] %replace(%msg){'\\n', ' '}%n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>pattern</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>encoder</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>rollingPolicy</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>ch.qos.logback.core.rolling.TimeBasedRollingPolicy<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>fileNamePattern</span><span class=\"token punctuation\">></span></span>${LOG_PATH}/application.%d{yyyy-MM-dd}.log<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>fileNamePattern</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>rollingPolicy</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>appender</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>logger</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>akka<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">level</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>info<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">additivity</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>false<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>appender-ref</span> <span class=\"token attr-name\">ref</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>APPLICATION<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>logger</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>root</span> <span class=\"token attr-name\">level</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>info<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>appender-ref</span> <span class=\"token attr-name\">ref</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>APPLICATION<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>root</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>configuration</span><span class=\"token punctuation\">></span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>로깅 구현체 디펜던시가 2개라서 로그 바인더가 둘 중 하나만 선택 된다는 것은 이해가 가는데 로그 바인더의 로딩 순서가 왜 상황에 따라 다른 것일까? 로딩 순서를 알기 위해서는 로그 바인더의 로딩 과정을 살펴볼 필요가 있다.\n<br/>\n<br/></p>\n<h3>Slf4j의 로그 바인더 로딩 과정</h3>\n<p>logback이나 log4j를 보면 항상 따라오는 디펜던시가 있는데 바로 slf4j-api라는 디펜던시이다. slf4j는 Simple Logging Facade for Java의 약자로 다양한 로깅 프레임워크(ex: java.util.logging, logback, log4j)에 대한 추상화 퍼사드를 제공한다. 따라서 slf4j-api 라는 퍼사드만 사용하게 되면 구현체(ex: java.util.logging, logback, log4j)는 어떤걸 쓰던지 상관없이 동일한 메소드로 로깅을 할 수 있게 된다.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d8261ab119309917e25180ef0ae42abe/04090/concrete-bindings.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 55.208333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7GAAAOzAEQOiUYAAACUElEQVQoz3VQS08TYRSduDMujb/AtSvduzHxP7hyY0IUY8S4UDRgQBR0ZYxxZeJGiYDRwhRSBSxD6VCYTiltGSo0nc6beT8733wz8zn4ihvP7t5zzz3nXgyvLlJCFSHUYlvTxAeiWXJ9t1ArkOymHTiNbmOmNLtWJ2zPxrfz35hiitI6W39HTFc7NDZpjT3ShmUklqP1oaMbM8H7APnPrIlx/6GOtGK4clu9/jmYcxJn3ByZ8EY95H4Jl4bUQTzKYeWGtkqJfpiKOsiXe0zPhwla31W+UmI/Qr2jAN9gO3IIY1SsSURdBRB1paBACh2hj61RreVKw/KBoWubFYrlpTRJm7X9KsWAKNZlrVza4QQdxpCu7dK7DIAxL4jlLbonqZjvup5tgBRNUeDWkvSk5BYU585+82arUTSNVwJ3rU6/4Lo9Px0pucMlz43QfCcawKWFDsCSJM2+1Y/iq28ql5/mL7w8eF7lryzNn1temeK40Y2Niwv4pXqtLAdnH2+dGqG7dnK/IGJ3NwfyGhb4mbfrOo6ncEDlRNV0QZLoqq8oSZqiIPB5HoZhDCNX5o9kOYxRaOlSp63bPmYYhizLpmX/THAMGMfrJLm8ugoh5ARhAc+zXTbrp+nviSRNLMvKSqzN7CmS2A+CwLH7jpVxMYSHe3uHDJPEsaIoNE3LsnKsyS78o/+1C/t+wB72VMXwdnh7i3O2Oadr+QcwYgDQMmsAwjBE/wE2Swr33lamSfH86/bJB+TpscYg0T6T+3hiZm6y2aSItU+5nGma/8b+ix/5mjMTumojRQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"concrete bindings\"\n        title=\"\"\n        src=\"/static/d8261ab119309917e25180ef0ae42abe/b9e4f/concrete-bindings.png\"\n        srcset=\"/static/d8261ab119309917e25180ef0ae42abe/cf440/concrete-bindings.png 148w,\n/static/d8261ab119309917e25180ef0ae42abe/d2d38/concrete-bindings.png 295w,\n/static/d8261ab119309917e25180ef0ae42abe/b9e4f/concrete-bindings.png 590w,\n/static/d8261ab119309917e25180ef0ae42abe/f9b6a/concrete-bindings.png 885w,\n/static/d8261ab119309917e25180ef0ae42abe/04090/concrete-bindings.png 1152w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p style=\"text-align: center\">[출처: https://www.slf4j.org/manual.html]</p>\n<p>위에 스크린샷은 slf4j 공식 홈페이지의 유저 메뉴얼에서 가져온 이미지인데 자세히 보면 Application에서는 모두 slf4j-api를 참조하고 있는 것을 볼 수 있다.</p>\n<p>그럼 slf4j-api의 어떤 API를 통해서 로깅을 하게 되는 것일까? 이미 써본 사람은 알겠지만 org.slf4j.LoggerFactory 라는 클래스를 통해 Logger를 결정한 뒤 그렇게 결정된 Logger로 로깅을 하면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>slf4j</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">LoggerFactory</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">LoggerFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Logger</span> <span class=\"token function\">getLogger</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">        <span class=\"token class-name\">ILoggerFactory</span> iLoggerFactory <span class=\"token operator\">=</span> <span class=\"token function\">getILoggerFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>        <span class=\"token keyword\">return</span> iLoggerFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getLogger</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Logger</span> <span class=\"token function\">getLogger</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> clazz<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">        <span class=\"token class-name\">Logger</span> logger <span class=\"token operator\">=</span> <span class=\"token function\">getLogger</span><span class=\"token punctuation\">(</span>clazz<span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>DETECT_LOGGER_NAME_MISMATCH<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> autoComputedCallingClass <span class=\"token operator\">=</span> <span class=\"token class-name\">Util</span><span class=\"token punctuation\">.</span><span class=\"token function\">getCallingClass</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>autoComputedCallingClass <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">nonMatchingClasses</span><span class=\"token punctuation\">(</span>clazz<span class=\"token punctuation\">,</span> autoComputedCallingClass<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token class-name\">Util</span><span class=\"token punctuation\">.</span><span class=\"token function\">report</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Detected logger name mismatch. Given name: \\\"%s\\\"; computed name: \\\"%s\\\".\"</span><span class=\"token punctuation\">,</span> logger<span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                                autoComputedCallingClass<span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token class-name\">Util</span><span class=\"token punctuation\">.</span><span class=\"token function\">report</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"See \"</span> <span class=\"token operator\">+</span> LOGGER_NAME_MISMATCH_URL <span class=\"token operator\">+</span> <span class=\"token string\">\" for an explanation\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> logger<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">ILoggerFactory</span> <span class=\"token function\">getILoggerFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>INITIALIZATION_STATE <span class=\"token operator\">==</span> UNINITIALIZED<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">synchronized</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">LoggerFactory</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>INITIALIZATION_STATE <span class=\"token operator\">==</span> UNINITIALIZED<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    INITIALIZATION_STATE <span class=\"token operator\">=</span> ONGOING_INITIALIZATION<span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">                    <span class=\"token function\">performInitialization</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>INITIALIZATION_STATE<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">case</span> SUCCESSFUL_INITIALIZATION<span class=\"token operator\">:</span>\n            <span class=\"token keyword\">return</span> <span class=\"token class-name\">StaticLoggerBinder</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSingleton</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getLoggerFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">case</span> NOP_FALLBACK_INITIALIZATION<span class=\"token operator\">:</span>\n            <span class=\"token keyword\">return</span> NOP_FALLBACK_FACTORY<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">case</span> FAILED_INITIALIZATION<span class=\"token operator\">:</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalStateException</span><span class=\"token punctuation\">(</span>UNSUCCESSFUL_INIT_MSG<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">case</span> ONGOING_INITIALIZATION<span class=\"token operator\">:</span>\n            <span class=\"token comment\">// support re-entrant behavior.</span>\n            <span class=\"token comment\">// See also http://jira.qos.ch/browse/SLF4J-97</span>\n            <span class=\"token keyword\">return</span> SUBST_FACTORY<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalStateException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Unreachable code\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">performInitialization</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">        <span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>INITIALIZATION_STATE <span class=\"token operator\">==</span> SUCCESSFUL_INITIALIZATION<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">versionSanityCheck</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>URL<span class=\"token punctuation\">></span></span> staticLoggerBinderPathSet <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\n            <span class=\"token comment\">// the next line does the binding</span>\n<span class=\"gatsby-highlight-code-line\">            <span class=\"token class-name\">StaticLoggerBinder</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSingleton</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>            INITIALIZATION_STATE <span class=\"token operator\">=</span> SUCCESSFUL_INITIALIZATION<span class=\"token punctuation\">;</span>\n            <span class=\"token function\">reportActualBinding</span><span class=\"token punctuation\">(</span>staticLoggerBinderPathSet<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token function\">fixSubstituteLoggers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token function\">replayEvents</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            SUBST_FACTORY<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">NoClassDefFoundError</span> ncde<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">String</span> msg <span class=\"token operator\">=</span> ncde<span class=\"token punctuation\">.</span><span class=\"token function\">getMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">messageContainsOrgSlf4jImplStaticLoggerBinder</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n                <span class=\"token keyword\">throw</span> ncde<span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>java<span class=\"token punctuation\">.</span>lang<span class=\"token punctuation\">.</span><span class=\"token class-name\">NoSuchMethodError</span> nsme<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n            <span class=\"token keyword\">throw</span> nsme<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalStateException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Unexpected initialization failure\"</span><span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>LoggerFactory의 getLogger 메소드들을 살펴보면 getILoggerFactory 메소드를 호출하는 것을 볼 수 있다. 또 getILoggerFactory 안에는 performInitialization > bind 메소드를 호출하고 있는데 bind 메소드 안에는 StaticLoggerBinder.getSingleton() 메소드를 호출하고 있다. 이 때 로깅 구현체의 StaticLoggerBinder가 결정되어 로딩되게 된다.</p>","frontmatter":{"title":"Java Hbase-client 디펜던시 추가 후 로그가 제대로 안나오는 이슈 (with Slf4j, Logback)","date":"2019-07-09 21:13:01","tags":["java","logging","SLF4J","Logback"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2019/07/09/20190709-java-hbase-logback-slf4j/","previous":{"fields":{"slug":"/2019/01/31/20190131-rxjava-infinite-iterable/"},"frontmatter":{"title":"RxJava를 이용하여 크기를 가늠할 수 없는 Iterable에서 데이터 읽고 처리하기"}},"next":null}}