<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>grpc 살펴보기 (grpc overview) | Icednut&#39;s Note</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="keywords" content="gRPC">
  
  
  
  
  <meta name="description" content="목차 About gRPC Why gRPC? gRPC 내부 구조 및 동작 과정 gRPC 개발 맛보기 protobuf 정의 gRPC Server gRPC Client     gRPC 통신의 4가지 방식  Unary Server Streaming Client Streaming 양방향 Streaming   고민해볼 문제 Testing Authenticatoin (">
<meta name="keywords" content="gRPC">
<meta property="og:type" content="article">
<meta property="og:title" content="gRPC 살펴보기 (gRPC Overview)">
<meta property="og:url" content="http://icednut.github.io/2018/07/04/20180706-about-grpc/index.html">
<meta property="og:site_name" content="Icednut&#39;s Note">
<meta property="og:description" content="목차 About gRPC Why gRPC? gRPC 내부 구조 및 동작 과정 gRPC 개발 맛보기 protobuf 정의 gRPC Server gRPC Client     gRPC 통신의 4가지 방식  Unary Server Streaming Client Streaming 양방향 Streaming   고민해볼 문제 Testing Authenticatoin (">
<meta property="og:locale" content="Korean">
<meta property="og:image" content="http://icednut.github.io/images/20180706-about-grpc/rpc.png">
<meta property="og:image" content="http://icednut.github.io/images/20180706-about-grpc/google_rpcs_per_second.png">
<meta property="og:image" content="http://icednut.github.io/images/20180706-about-grpc/grpc_interoperability.png">
<meta property="og:image" content="http://icednut.github.io/images/20180706-about-grpc/grpc_architecture.png">
<meta property="og:image" content="http://icednut.github.io/images/20180706-about-grpc/grpc_java.png">
<meta property="og:image" content="http://icednut.github.io/images/20180706-about-grpc/grpc_server_sequence_diagram-build.png">
<meta property="og:image" content="http://icednut.github.io/images/20180706-about-grpc/grpc_server_sequence_diagram-start.png">
<meta property="og:image" content="http://icednut.github.io/images/20180706-about-grpc/grpc_server_sequence_diagram-connect.png">
<meta property="og:image" content="http://icednut.github.io/images/20180706-about-grpc/grpc_server_sequence_diagram-run.png">
<meta property="og:image" content="http://icednut.github.io/images/20180706-about-grpc/http2.png">
<meta property="og:updated_time" content="2018-11-27T06:40:43.300Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="gRPC 살펴보기 (gRPC Overview)">
<meta name="twitter:description" content="목차 About gRPC Why gRPC? gRPC 내부 구조 및 동작 과정 gRPC 개발 맛보기 protobuf 정의 gRPC Server gRPC Client     gRPC 통신의 4가지 방식  Unary Server Streaming Client Streaming 양방향 Streaming   고민해볼 문제 Testing Authenticatoin (">
<meta name="twitter:image" content="http://icednut.github.io/images/20180706-about-grpc/rpc.png">
  
    <link rel="alternate" href="/atom.xml" title="Icednut&#39;s Note" type="application/atom+xml">
  

  

  <link rel="icon" href="/css/images/mylogo.jpg">
  <link rel="apple-touch-icon" href="/css/images/mylogo.jpg">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
  <link rel="stylesheet" href="/css/style.css">

  <script src="/js/jquery-3.1.1.min.js"></script>
  <script src="/js/bootstrap.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css">

  
    <link rel="stylesheet" href="/css/dialog.css">
  

  

  
    <link rel="stylesheet" href="/css/header-post.css">
  

  
  
  

<link rel="stylesheet" href="/css/prism-coy.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>
</html>


  <body data-spy="scroll" data-target="#toc" data-offset="50">


  
  <div id="container">
    <div id="wrap">
      
        <header>

    <div id="allheader" class="navbar navbar-default navbar-static-top" role="navigation">
        <div class="navbar-inner">
          
          <div class="container"> 
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>

            
              <a class="brand" style="border-width: 0;">
                <p>Icednut&#39;s Note</p>
              </a>
            
            
            <div class="navbar-collapse collapse">
              <ul class="hnav navbar-nav">
                
                  <li> <a class="main-nav-link" href="/">Home</a> </li>
                
                  <li> <a class="main-nav-link" href="/archives">Archives</a> </li>
                
                  <li> <a class="main-nav-link" href="/categories">Categories</a> </li>
                
                  <li> <a class="main-nav-link" href="/tags">Tags</a> </li>
                
                  <li> <a class="main-nav-link" href="/about">About</a> </li>
                
                  <li><div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="">
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something...">
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div></li>
            </ul></div>
          </div>
                
      </div>
    </div>

</header>



      
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;"><article id="post-20180706-about-grpc" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      gRPC 살펴보기 (gRPC Overview)
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2018/07/04/20180706-about-grpc/" class="article-date">
	  <time datetime="2018-07-04T13:15:27.000Z" itemprop="datePublished">2018-07-04</time>
	</a>

      
      
      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="목차"><a href="#목차" class="headerlink" title="목차"></a>목차</h2><ul>
<li><strong>About gRPC</strong><ul>
<li>Why gRPC?</li>
<li>gRPC 내부 구조 및 동작 과정</li>
<li>gRPC 개발 맛보기<ul>
<li>protobuf 정의</li>
<li>gRPC Server</li>
<li>gRPC Client</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>gRPC 통신의 4가지 방식</strong></p>
<ul>
<li>Unary</li>
<li>Server Streaming</li>
<li>Client Streaming</li>
<li>양방향 Streaming</li>
</ul>
</li>
<li><strong>고민해볼 문제</strong><ul>
<li>Testing</li>
<li>Authenticatoin (TLS, OAuth)</li>
<li>Load Balancing (Client-side, Server-side)</li>
<li>Monitoring</li>
<li>Proxies, Web (REST Adapter, grpc-gateway)</li>
<li>Versioning</li>
</ul>
</li>
<li><strong>참고 자료</strong></li>
</ul>
<h2 id="About-gRPC"><a href="#About-gRPC" class="headerlink" title="About gRPC"></a>About gRPC</h2><p><strong>gRPC는 HTTP2 기반의 오픈 소스 하이 퍼포먼스 원격 프로시저 호출(RPC) 프레임워크 입니다.</strong> gRPC에서 클라이언트 어플리케이션은 다른 서버 어플리케이션의 메서드를 마치 로컬 객체인 것처럼 직접 호출할 수 있으므로 분산 어플리케이션 및 서비스를 보다 쉽게 만들 수 있습니다. 많은 RPC 처럼 gRPC는 서비스를 정의하고 파라미터 및 리턴 유형을 사용하여 원격으로 호출할 수있는 메소드를 지정한다는 아이디어를 기반으로 합니다.</p>
<blockquote>
<h5 id="RPC-Remote-Procedure-Call-이란"><a href="#RPC-Remote-Procedure-Call-이란" class="headerlink" title="RPC(Remote Procedure Call)이란?"></a>RPC(Remote Procedure Call)이란?</h5><p><strong>원격 프로시저 호출</strong>(remote procedure call, 리모트 프로시저 콜, RPC)은 별도의 원격 제어를 위한 코딩 없이 다른 주소 공간에서 함수나 프로시저를 실행할 수 있게 하는 프로세스 간 통신 기술이다. 다시 말해, 원격 프로시저 호출을 이용하면 프로그래머는 함수가 실행 프로그램에 로컬 위치에 있든 원격 위치에 있든 동일한 코드를 이용할 수 있다.</p>
<p><img src="/images/20180706-about-grpc/rpc.png"></p>
<p>출처: <a href="https://ko.wikipedia.org/wiki/%EC%9B%90%EA%B2%A9_%ED%94%84%EB%A1%9C%EC%8B%9C%EC%A0%80_%ED%98%B8%EC%B6%9C" target="_blank" rel="noopener">https://ko.wikipedia.org/wiki/%EC%9B%90%EA%B2%A9_%ED%94%84%EB%A1%9C%EC%8B%9C%EC%A0%80_%ED%98%B8%EC%B6%9C</a></p>
</blockquote>
<p>또한 구글은 사내에서 Stubby라는 RPC 프레임워크를 만들어서 사용하고 있었는데 하루에 초당 100억건의 RPC Call을 처리한다고 합니다. 구글은 Stubby 다음 버전을 계획하면서 오픈소스로 외부에 공개하기로 결정하였고 이에 따라 gRPC가 탄생하게 되었습니다. 참고로 gRPC는 성능을 중요시하기 때문에 HTTP2 기반으로 동작합니다.</p>
<p><img src="/images/20180706-about-grpc/google_rpcs_per_second.png"></p>
<h3 id="잠깐-왜-이제와서-RPC를-거들먹거리는건가-Why-gRPC"><a href="#잠깐-왜-이제와서-RPC를-거들먹거리는건가-Why-gRPC" class="headerlink" title="잠깐! 왜 이제와서 RPC를 거들먹거리는건가? (Why gRPC?)"></a>잠깐! 왜 이제와서 RPC를 거들먹거리는건가? (Why gRPC?)</h3><ul>
<li>RPC 기술들: CORBA, DCOM, RMI (Java RMI)</li>
<li>CORBA (with Java)로 헬로 월드 찍어 보셨어요? (<a href="http://www.ejbtutorial.com/programming/tutorial-for-corba-hello-world-using-java" target="_blank" rel="noopener">http://www.ejbtutorial.com/programming/tutorial-for-corba-hello-world-using-java</a>)</li>
</ul>
<p>이렇게 힘든데 왜 구글은 RPC를 사용하는걸까요? 구글은 Stubby를 통해 다음과 같은 점들을 배웠다고 합니다. (gRPC Motivation)</p>
<ol>
<li>HTTP/JSON doesn`t cut it!</li>
<li>Establish a lingua granca[^1]</li>
<li>Design for fault tolerance and provide control knobs</li>
<li>Don`t fly blind: Service Analytics</li>
<li>Diagonosing problems: Tracing</li>
<li>Load Balancing is critical</li>
</ol>
<p>(시간 관계상 이 부분은 다른 자료로 대체하도록 하겠습니다. <a href="https://www.slideshare.net/datawire/bringing-learnings-from-googley-microservices-with-grpc-varun-talwar-google" target="_blank" rel="noopener">https://www.slideshare.net/datawire/bringing-learnings-from-googley-microservices-with-grpc-varun-talwar-google</a>)</p>
<p>그리하여 gRPC는 다음과 같은 사양 갖추었습니다.</p>
<ul>
<li>Transport: HTTP/2[^2]</li>
<li>Wire format: Protocol Buffers 3<a href="https://developers.google.com/protocol-buffers/docs/proto3" target="_blank" rel="noopener">^3</a> (Binary)</li>
<li>Service definition: Protocol Buffers IDL</li>
</ul>
<p>gRPC는 이런 HTTP/2의 특징을 기반으로 하기때문에 양방향 스트리밍이 가능하고, 기본적인 통신 속도가 빠릅니다. on-connection 상태에서 비동기 통신의 구현이 용이합니다. 정리하자면 gRPC를 사용해야할 이유는 다음과 같습니다.</p>
<ul>
<li>Binary protocol (HTTP/2),</li>
<li>Multiplexing many requests on one connection (HTTP/2)</li>
<li>Header compression (HTTP/2)</li>
<li>Strongly typed service and message definition (Protobuf)</li>
<li>Idiomatic client/server library implementations in many languages</li>
<li>gRPC Benchmarking: <a href="https://github.com/david-cao/gRPCBenchmarks" target="_blank" rel="noopener">https://github.com/david-cao/gRPCBenchmarks</a></li>
</ul>
<h3 id="gRPC의-특징"><a href="#gRPC의-특징" class="headerlink" title="gRPC의 특징"></a>gRPC의 특징</h3><ul>
<li><p><strong>간단한 서비스 정의 (Simple Service Definition)</strong></p>
<ul>
<li><p>서비스 정의(모델 정의, 통신 과정 정의)를 Protocol Buffer를 사용</p>
</li>
<li><p>Protocol Buffer는 XML과 같은 구조화된 데이터 정의라고 보면 되며, 일종의 IDL(Interface Definition Language)이다. (그러나 XML보다 직관적이고 표현이 풍부하다)</p>
</li>
<li><p>Protocol Buffer는 .proto 파일로 정의하며 서비스 인터페이스와 메세지 페이로드를 정의할 때 사용</p>
</li>
<li><p>protobuf example</p>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">service</span> <span class="title">HelloService</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">rpc</span> SayHello(HelloRequest) <span class="keyword">returns</span> (HelloResponse)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">HelloRequest</span> </span>&#123;</span><br><span class="line">  <span class="built_in">string</span> greeting = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">HelloResponse</span> </span>&#123;</span><br><span class="line">  <span class="built_in">string</span> reply = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>다양한 언어와 플랫폼에서 동작 (Works across language and platforms)</strong></p>
<ul>
<li>protobuf로 생성한 서비스 정의에 따라 클라이언트와 서버에서 사용하는 언어에 맞게 모델과 인터페이스 Stubs를 생성</li>
<li>각 언어에 맞는 gRPC 프레임워크를 통해 개발 및 실행 진행</li>
<li>공식 지원하는 변환 타겟 언어: C/C++, C#, Dart*, Go, Java, Node.js, PHP*, Python, Ruby (*은 아직 Beta 단계)</li>
</ul>
<p><img src="/images/20180706-about-grpc/grpc_interoperability.png"></p>
</li>
<li><p><strong>양방향 스트리밍과 통합 인증 (Bi-directional streaming and integrated auth)</strong></p>
<ul>
<li>http/2 기반의 양방향 스트리밍과 조립 가능한 인증 및 인터셉터 인터페이스를 제공</li>
<li>인증에는 SSL/TLS 혹은 Google Token-based authentication을 사용하거나 직접 인증 시스템을 연동할 수 있음</li>
</ul>
</li>
</ul>
<h3 id="따라서-gRPC는-이런-곳에-적용하면-좋습니다"><a href="#따라서-gRPC는-이런-곳에-적용하면-좋습니다" class="headerlink" title="따라서 gRPC는 이런 곳에 적용하면 좋습니다."></a>따라서 gRPC는 이런 곳에 적용하면 좋습니다.</h3><ul>
<li>Server to Server</li>
<li>Server to Mobile device</li>
<li>ex) 주식 시장, 게임, 스마트홈 디바이스 등등</li>
</ul>
<h3 id="이쯤에서-gRPC의-내부-구조와-동작-과정을-살펴봅시다"><a href="#이쯤에서-gRPC의-내부-구조와-동작-과정을-살펴봅시다" class="headerlink" title="이쯤에서 gRPC의 내부 구조와 동작 과정을 살펴봅시다"></a>이쯤에서 gRPC의 내부 구조와 동작 과정을 살펴봅시다</h3><p>gRPC는 여러 가지 언어(C/C++, C#, Dart, Go, Java, Node.js, PHP, Python, Ruby에서 동작 가능합니다. 그러나 gRPC는 3가지 언어(C, Java, Go)로 동일하게 구현되어 있습니다.  그 외 나머지 언어들은 핵심은 C-Runtime 라이브러리로 형태로 개발하여 각 언어별로 랩핑되어 있습니다. 이렇게 한 이유는 개발 비용 절감과 구현, 언어별 퍼포먼스 일관성을 가져갈 수 있기 때문입니다.</p>
<ul>
<li>grpc-java (<a href="https://github.com/grpc/grpc-java" target="_blank" rel="noopener">https://github.com/grpc/grpc-java</a>)</li>
<li>grpc-go (<a href="https://github.com/grpc/grpc-go" target="_blank" rel="noopener">https://github.com/grpc/grpc-go</a>)</li>
<li>grpc (<a href="https://github.com/grpc/grpc" target="_blank" rel="noopener">https://github.com/grpc/grpc</a>)</li>
</ul>
<p>그 중에서 gRPC Java는 다음과 같은 아키텍처를 갖추고 있습니다.</p>
<p><img src="/images/20180706-about-grpc/grpc_architecture.png"></p>
<p><img src="/images/20180706-about-grpc/grpc_java.png"></p>
<p>gRPC 동작과정을 살펴보기 전에 간단하게 gRPC를 사용하여 Hello world 메세지를 주고 받는 Server, Client Java Application을 개발해보도록 하겠습니다. 개발 과정은 다음과 같습니다.</p>
<ol>
<li>Protocol Buffer 3 (IDL)을 이용하여 RPC 인터페이스 및 모델 정의</li>
<li>프로젝트 셋팅 (with Gradle)</li>
<li>서버 개발</li>
<li>클라이언트 개발</li>
</ol>
<h4 id="개발-과정"><a href="#개발-과정" class="headerlink" title="개발 과정"></a>개발 과정</h4><h5 id="1-프로젝트-셋팅-with-Gradle"><a href="#1-프로젝트-셋팅-with-Gradle" class="headerlink" title="1. 프로젝트 셋팅 (with Gradle)"></a>1. 프로젝트 셋팅 (with Gradle)</h5><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">apply <span class="string">plugin:</span> <span class="string">'java'</span></span><br><span class="line">apply <span class="string">plugin:</span> <span class="string">'com.google.protobuf'</span></span><br><span class="line"></span><br><span class="line">targetCompatibility = versionJavaLang</span><br><span class="line">sourceCompatibility = versionJavaLang</span><br><span class="line"></span><br><span class="line">protobuf &#123;</span><br><span class="line">    protoc &#123;</span><br><span class="line">        artifact = <span class="string">"com.google.protobuf:protoc:$&#123;protocVersion&#125;"</span></span><br><span class="line">    &#125;</span><br><span class="line">    plugins &#123;</span><br><span class="line">        grpc &#123;</span><br><span class="line">            artifact = <span class="string">"io.grpc:protoc-gen-grpc-java:$&#123;grpcVersion&#125;"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    generateProtoTasks &#123;</span><br><span class="line">        ofSourceSet(<span class="string">'main'</span>).each &#123; task -&gt;</span><br><span class="line">            task.builtins &#123;</span><br><span class="line">                java &#123;</span><br><span class="line">                    outputSubDir = <span class="string">'protoGen'</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            task.plugins &#123;</span><br><span class="line">                grpc &#123;</span><br><span class="line">                    outputSubDir = <span class="string">'protoGen'</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    generatedFilesBaseDir = <span class="string">"$projectDir/src/"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sourceSets &#123;</span><br><span class="line">    main &#123;</span><br><span class="line">        java &#123;</span><br><span class="line">            srcDir <span class="string">'src/main/java'</span></span><br><span class="line">            srcDir <span class="string">'src/main/protoGen'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    compile(<span class="string">"com.google.api.grpc:proto-google-common-protos:1.0.0"</span>)</span><br><span class="line">    compile(<span class="string">"com.google.protobuf:protobuf-java-util:$&#123;protobufVersion&#125;"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task cleanProtoGen &#123;</span><br><span class="line">    doFirst &#123;</span><br><span class="line">        delete(<span class="string">"$projectDir/src/main/protoGen"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">clean.dependsOn cleanProtoGen</span><br></pre></td></tr></table></figure>
<h5 id="2-Protocol-Buffer-3을-이용하여-RPC-인터페이스-및-모델-정의"><a href="#2-Protocol-Buffer-3을-이용하여-RPC-인터페이스-및-모델-정의" class="headerlink" title="2. Protocol Buffer 3을 이용하여 RPC 인터페이스 및 모델 정의"></a>2. Protocol Buffer 3을 이용하여 RPC 인터페이스 및 모델 정의</h5><p>아래와 같이 모델과 RPC Stub 인터페이스를 정의합니다. 그런 뒤 Gradle의 generateProto를 수행하면 HelloRequest, HelloReply 모델 클래스와 커넥션 처리 로직이 담긴 Greeter Stub 클래스가 생성이 됩니다. 특이한 점은 모델 클래스 안에 파싱 로직이 담겨있고 Stub은 서버 측 뿐만 아니라 Java Client 측에서 호출할 수 있는 Stub 로직도 같이 생성됩니다. (서버 측 GreeterGrpc.GreeterImplBase, 클라이언트 측: GreeterGrpc.GreeterBlockingStub)</p>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">syntax = <span class="string">"proto3"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">option</span> java_multiple_files = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">option</span> java_package = <span class="string">"io.icednut.grpc.common.exercise.helloworld"</span>;</span><br><span class="line"><span class="keyword">option</span> java_outer_classname = <span class="string">"HelloWorldProto"</span>;</span><br><span class="line"><span class="keyword">option</span> objc_class_prefix = <span class="string">"HLW"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> helloworld;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Greeting 서비스 정의</span></span><br><span class="line"><span class="class"><span class="keyword">service</span> <span class="title">Greeter</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 파라미터로 받은 인사요청에 담긴 이름으로 인사 메세지가 담긴 모델 반환하기</span></span><br><span class="line">  <span class="function"><span class="keyword">rpc</span> SayHello(HelloRequest) <span class="keyword">returns</span> (HelloReply) &#123;&#125;</span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">HelloRequest</span> </span>&#123;</span><br><span class="line">    <span class="built_in">string</span> name = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">HelloReply</span> </span>&#123;</span><br><span class="line">    <span class="built_in">string</span> <span class="class"><span class="keyword">message</span> = 1;</span></span><br><span class="line"><span class="class">&#125;</span></span><br></pre></td></tr></table></figure>
<h5 id="3-서버-개발"><a href="#3-서버-개발" class="headerlink" title="3. 서버 개발"></a>3. 서버 개발</h5><p>Java 서버 측 디펜던시를 추가합니다.</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">compile <span class="string">'io.grpc:grpc-netty:1.13.1'</span></span><br><span class="line">compile <span class="string">'io.grpc:grpc-protobuf:1.13.1'</span></span><br><span class="line">compile <span class="string">'io.grpc:grpc-stub:1.13.1'</span></span><br></pre></td></tr></table></figure>
<p>Greeter 서비스를 개발합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GreeterService</span> <span class="keyword">extends</span> <span class="title">GreeterGrpc</span>.<span class="title">GreeterImplBase</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">(HelloRequest req, StreamObserver&lt;HelloReply&gt; responseObserver)</span> </span>&#123;</span><br><span class="line">        HelloReply reply = HelloReply.newBuilder()</span><br><span class="line">                                     .setMessage(<span class="string">"Hello "</span> + req.getName())</span><br><span class="line">                                     .build();</span><br><span class="line">        responseObserver.onNext(reply);</span><br><span class="line">        responseObserver.onCompleted();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Greeter 서비스 처리를 진행할 서버를 개발합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GrpcCommonServer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(GrpcCommonServer.class);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Server server;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> port;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GrpcCommonServer</span><span class="params">(<span class="keyword">int</span> port, List&lt;BindableService&gt; services)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.port = port;</span><br><span class="line"></span><br><span class="line">        ServerBuilder&lt;?&gt; serverBuilder = ServerBuilder.forPort(<span class="keyword">this</span>.port);</span><br><span class="line">        services.forEach(service -&gt; serverBuilder.addService(service));</span><br><span class="line">        <span class="keyword">this</span>.server = serverBuilder.build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">        server.start();</span><br><span class="line">        logger.info(<span class="string">"Server started, listening on "</span> + port);</span><br><span class="line">        <span class="keyword">this</span>.blockUntilShutdown();</span><br><span class="line"></span><br><span class="line">        Runtime.getRuntime().addShutdownHook(<span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            System.err.println(<span class="string">"*** shutting down gRPC server since JVM is shutting down"</span>);</span><br><span class="line">            GrpcCommonServer.<span class="keyword">this</span>.stop();</span><br><span class="line">            System.err.println(<span class="string">"*** server shut down"</span>);</span><br><span class="line">        &#125;));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (server != <span class="keyword">null</span>) &#123;</span><br><span class="line">            server.shutdown();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">blockUntilShutdown</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (server != <span class="keyword">null</span>) &#123;</span><br><span class="line">            server.awaitTermination();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Java Main 메소드에서 서버를 실행합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GrpcServerApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">        GrpcCommonServer server = <span class="keyword">new</span> GrpcCommonServer(<span class="number">50551</span>, Arrays.asList(<span class="keyword">new</span> GreeterService()));</span><br><span class="line">        server.start();</span><br><span class="line">        server.blockUntilShutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="3-1-서버측-동작-과정"><a href="#3-1-서버측-동작-과정" class="headerlink" title="3.1. 서버측 동작 과정"></a>3.1. 서버측 동작 과정</h5><p>서버측 동작 과정은 크게 서버 생성, 서버 실행 및 대기, 서버 종료 과정으로 나뉩니다. gRPC 프레임워크에 따라 RPC를 처리할 서버를 생성한 뒤 Netty 서버를 실행하고 Netty 서버가 소켓 및 HTTP2 프로토콜을 사용하여 RPC Call 요청 처리 대기를 합니다. RPC Call 요청이 들어오면 HTTP2 프로토콜로 바이너리 데이터를 주고 받는 방식으로 진행 됩니다. 서버 생성 과정을 살펴보면 다음과 같습니다.</p>
<p><strong>[서버 생성]</strong></p>
<p><img src="/images/20180706-about-grpc/grpc_server_sequence_diagram-build.png"></p>
<p>요청을 받을 프로세스의 포트와 요청에 부름을 받을 메소드가 담긴 service 객체를 조합하여 최종적으로 NettyServer를 생성한다</p>
<p>이렇게 생성한 서버에 start 메소드를 실행하면 요청 처리 대기 상태가 됩니다.</p>
<p><strong>[서버 실행]</strong></p>
<p><img src="/images/20180706-about-grpc/grpc_server_sequence_diagram-start.png"></p>
<p>요청 처리 대기 상태라는 말은 NioEventLoop가 실행되어 의미 있는 커넥션이 맺어질 때 <strong>io.grpc.netty.NettyServerTransport</strong> 와 <strong>io.grpc.netty.ProtocolNegotiators</strong>를 통해 <strong>io.grpc.netty.GrpcHttp2ConnectionHandler</strong> 타입의 응답 처리기(Handler)를 만들어서 클라이언트와의 연결 및 클라이언트와 주고 받는 데이터(byte array)를 처리하게 됩니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ProtocolNegotiator <span class="title">serverPlaintext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> ProtocolNegotiator() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Handler <span class="title">newHandler</span><span class="params">(<span class="keyword">final</span> GrpcHttp2ConnectionHandler handler)</span> </span>&#123;</span><br><span class="line">      <span class="class"><span class="keyword">class</span> <span class="title">PlaintextHandler</span> <span class="keyword">extends</span> <span class="title">ChannelHandlerAdapter</span> <span class="keyword">implements</span> <span class="title">Handler</span> </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handlerAdded</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">          handler.handleProtocolNegotiationCompleted(Attributes.newBuilder()</span><br><span class="line">                .set(Grpc.TRANSPORT_ATTR_REMOTE_ADDR, ctx.channel().remoteAddress())</span><br><span class="line">                .build(), <span class="keyword">null</span>);</span><br><span class="line">          ctx.pipeline().replace(<span class="keyword">this</span>, <span class="keyword">null</span>, handler);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ...</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> PlaintextHandler();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>GrpcHttp2ConnectionHandler는 <strong>io.netty.handler.codec.http2.Http2ConnectionHandler</strong> 를 상속받은 구현체로 HTTP2 스펙을 따르며 그에 따른 커낵션 및 라이프사이클을 수행합니다.</p>
<p><img src="/images/20180706-about-grpc/grpc_server_sequence_diagram-connect.png"></p>
<p>그런 다음 클라이언트와 커낵션을 맺은 뒤 해당 커넥션과 protobuf Stub을 사용해서 byte array 형태의 데이터를 주고 받습니다. 앞의 Hello world 예제를 기준으로 설명하면 클라이언트는 sayHello()라는 함수를 호출하면 HelloRequest의 멤버인 String name을 byte array로 변환하여 전송합니다. 그러면 서버에서는 byte array stream으로 받고 연결을 끊지 않은채 스트림에서 데이터를 읽어와 <strong>io.grpc.protobuf.ProtoLiteUtils</strong> 클래스를 통해 모델 객체로 파싱합니다. (궁금해서 모델의 byte array를 열어보니 JSON 형태가 아닌 tag: value 형태의 문자열이었습니다.) 이렇게 파싱한 모델 객체와 byte array에 명시된 호출할 메소드를 호출하여 비로소 우리가 작성한 비지니스 로직을 실행하게 됩니다.</p>
<p><img src="/images/20180706-about-grpc/grpc_server_sequence_diagram-run.png"></p>
<h5 id="4-클라이언트-개발"><a href="#4-클라이언트-개발" class="headerlink" title="4. 클라이언트 개발"></a>4. 클라이언트 개발</h5><p>클라이언트는 일반 Java command line application으로 가정하고 진행하도록 하겠습니다. 먼저 아래와 같이 디펜던시를 추가합니다.</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">compile <span class="string">'io.grpc:grpc-netty:1.13.1'</span></span><br><span class="line">compile <span class="string">'io.grpc:grpc-protobuf:1.13.1'</span></span><br><span class="line">compile <span class="string">'io.grpc:grpc-stub:1.13.1'</span></span><br></pre></td></tr></table></figure>
<p>앞에 서버측에서 정의한 protobuf를 그대로 똑같이 사용하여 모델 및 Stub을 사용합니다. 그런 다음 해당 Stub을 사용하는 HelloWroldClient 클래스를 정의합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorldClient</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ManagedChannel channel;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> GreeterGrpc.GreeterBlockingStub blockingStub;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HelloWorldClient</span><span class="params">(String host, <span class="keyword">int</span> port)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(ManagedChannelBuilder.forAddress(host, port)</span><br><span class="line">                .usePlaintext()</span><br><span class="line">                .build());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    HelloWorldClient(ManagedChannel channel) &#123;</span><br><span class="line">        <span class="keyword">this</span>.channel = channel;</span><br><span class="line">        blockingStub = GreeterGrpc.newBlockingStub(channel);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>여기서 서버와의 접속 수단인 ManagedChannel 객체를 생성하고 Stub에 조립하여 사용합니다. 이렇게 하면 사실 개발자는 내부 통신 과정을 알 필요가 없습니다. 그 다음 stub.sayHello() 메소드를 사용하면 개발자가 보기엔 서버측의 메소드를 사용한 것처럼 보이지만 내부적으로는 Netty Client를 통해 HTTP2 방식으로 byte array 데이터를 전송하게 됩니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorldClient</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ManagedChannel channel;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> GreeterGrpc.GreeterBlockingStub blockingStub;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HelloWorldClient</span><span class="params">(String host, <span class="keyword">int</span> port)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(ManagedChannelBuilder.forAddress(host, port)</span><br><span class="line">                .usePlaintext()</span><br><span class="line">                .build());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    HelloWorldClient(ManagedChannel channel) &#123;</span><br><span class="line">        <span class="keyword">this</span>.channel = channel;</span><br><span class="line">        blockingStub = GreeterGrpc.newBlockingStub(channel);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">greet</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        HelloRequest request = HelloRequest.newBuilder()</span><br><span class="line">                .setName(name)</span><br><span class="line">                .setAge(<span class="number">10</span>)</span><br><span class="line">                .build();</span><br><span class="line">        HelloReply response;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            response = blockingStub.sayHello(request);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (StatusRuntimeException e) &#123;</span><br><span class="line">            logger.log(Level.WARNING, <span class="string">"RPC failed: &#123;0&#125;"</span>, e.getStatus());</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        logger.info(<span class="string">"Greeting: "</span> + response.getMessage() + <span class="string">"|"</span> + response.getAge());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="4-1-클라이언트-측-동작-과정"><a href="#4-1-클라이언트-측-동작-과정" class="headerlink" title="4.1. 클라이언트 측 동작 과정"></a>4.1. 클라이언트 측 동작 과정</h5><p>클라이언트 측은 사실 Stub 객체의 동작과정만 잘 알면 됩니다. 그 안에서 데이터 변환 및 서버 호출을 결정하고 수행하고 있습니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">1.</span><br><span class="line">io.grpc.netty.NettyClientHandler - [id: 0x42c055ac, L:/127.0.0.1:53048 - R:localhost/127.0.0.1:8090] OUTBOUND SETTINGS: ack=false settings=&#123;ENABLE_PUSH=0, MAX_CONCURRENT_STREAMS=0, INITIAL_WINDOW_SIZE=1048576, MAX_HEADER_LIST_SIZE=8192&#125;</span><br><span class="line">io.grpc.netty.NettyClientHandler - [id: 0x42c055ac, L:/127.0.0.1:53048 - R:localhost/127.0.0.1:8090] OUTBOUND WINDOW_UPDATE: streamId=0 windowSizeIncrement=983041</span><br><span class="line">io.grpc.netty.NettyClientHandler - [id: 0x42c055ac, L:/127.0.0.1:53048 - R:localhost/127.0.0.1:8090] INBOUND SETTINGS: ack=false settings=&#123;MAX_CONCURRENT_STREAMS=2147483647, INITIAL_WINDOW_SIZE=1048576, MAX_HEADER_LIST_SIZE=8192&#125;</span><br><span class="line">io.grpc.netty.NettyClientHandler - [id: 0x42c055ac, L:/127.0.0.1:53048 - R:localhost/127.0.0.1:8090] OUTBOUND SETTINGS: ack=true</span><br><span class="line">io.grpc.netty.NettyClientHandler - [id: 0x42c055ac, L:/127.0.0.1:53048 - R:localhost/127.0.0.1:8090] INBOUND WINDOW_UPDATE: streamId=0 windowSizeIncrement=983041</span><br><span class="line"></span><br><span class="line">2.</span><br><span class="line">io.grpc.netty.NettyClientHandler - [id: 0x42c055ac, L:/127.0.0.1:53048 - R:localhost/127.0.0.1:8090] OUTBOUND DATA: streamId=3 padding=0 endStream=true length=14 bytes=00000000090a05776f726c64100a</span><br><span class="line"></span><br><span class="line">3.</span><br><span class="line">io.grpc.netty.NettyClientHandler - [id: 0x42c055ac, L:/127.0.0.1:53048 - R:localhost/127.0.0.1:8090] INBOUND HEADERS: streamId=3 headers=GrpcHttp2ResponseHeaders[:status: 200, content-type: application/grpc, grpc-encoding: identity, grpc-accept-encoding: gzip] streamDependency=0 weight=16 exclusive=false padding=0 endStream=false</span><br><span class="line"></span><br><span class="line">4.</span><br><span class="line">io.grpc.netty.NettyClientHandler - [id: 0x42c055ac, L:/127.0.0.1:53048 - R:localhost/127.0.0.1:8090] INBOUND DATA: streamId=3 padding=0 endStream=false length=18 bytes=000000000d0a0b48656c6c6f20776f726c64</span><br><span class="line"></span><br><span class="line">5.</span><br><span class="line">io.grpc.netty.NettyClientHandler - [id: 0x42c055ac, L:/127.0.0.1:53048 - R:localhost/127.0.0.1:8090] INBOUND HEADERS: streamId=3 headers=GrpcHttp2ResponseHeaders[grpc-status: 0] streamDependency=0 weight=16 exclusive=false padding=0 endStream=true</span><br><span class="line"></span><br><span class="line">6.</span><br><span class="line">io.grpc.netty.NettyClientHandler - [id: 0x42c055ac, L:/127.0.0.1:53048 - R:localhost/127.0.0.1:8090] OUTBOUND GO_AWAY: lastStreamId=0 errorCode=0 length=0 bytes=</span><br></pre></td></tr></table></figure>
<h2 id="gRPC-통신의-4가지-방식"><a href="#gRPC-통신의-4가지-방식" class="headerlink" title="gRPC 통신의 4가지 방식"></a>gRPC 통신의 4가지 방식</h2><p>길찾기(?) 서비스를 통해 gRPC의 4가지 통신 방식을 살펴보도록 하겠습니다. 먼저 protobuf를 먼저 정의합니다.</p>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">syntax = <span class="string">"proto3"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">option</span> java_multiple_files = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">option</span> java_package = <span class="string">"io.grpc.examples.routeguide"</span>;</span><br><span class="line"><span class="keyword">option</span> java_outer_classname = <span class="string">"RouteGuideProto"</span>;</span><br><span class="line"><span class="keyword">option</span> objc_class_prefix = <span class="string">"RTG"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> routeguide;</span><br><span class="line"></span><br><span class="line"><span class="comment">// RouteGuide 서비스 정의합니다.</span></span><br><span class="line"><span class="comment">// 서비스가 제공하는 RPC 메서드를 선언하고, 각 메서드의 요청/응답 메시지를 정의합니다.</span></span><br><span class="line"><span class="class"><span class="keyword">service</span> <span class="title">RouteGuide</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 단순한 RPC</span></span><br><span class="line">  <span class="comment">// 클라이언트에서 요청를 보내고 서버의 응답을 리턴합니다</span></span><br><span class="line">  <span class="function"><span class="keyword">rpc</span> GetFeature(Point) <span class="keyword">returns</span> (Feature) &#123;&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  // 서버에서 클라이언트로 스트리밍하는 RPC</span></span><br><span class="line"><span class="function">  // 클라이언트에서 요청을 보내고 서버로 부터 더이상 받을 메시지가 없을때까지</span></span><br><span class="line"><span class="function">  // 스트림(sequence of messages)을 읽습니다</span></span><br><span class="line"><span class="function">  // 스트림을 사용하기 위해서 stream 키워드를 사용합니다</span></span><br><span class="line"><span class="function">  <span class="keyword">rpc</span> ListFeatures(Rectangle) <span class="keyword">returns</span> (stream Feature) &#123;&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  // 클라이언트에서 서버로 스트리밍하는 RPC</span></span><br><span class="line"><span class="function">  // 클라이언트에서 스트림을 모두 서버에 쓰고 끝나면 서버의 응답을 리턴합니다</span></span><br><span class="line"><span class="function">  <span class="keyword">rpc</span> RecordRoute(stream Point) <span class="keyword">returns</span> (RouteSummary) &#123;&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  // 양방향 스트리밍 RPC</span></span><br><span class="line"><span class="function">  // 클라이언트와 서버가 서로 독립적으로 스트림을 읽고 씁니다.</span></span><br><span class="line"><span class="function">  <span class="keyword">rpc</span> RouteChat(stream RouteNote) <span class="keyword">returns</span> (stream RouteNote) &#123;&#125;</span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// 서비스의 요청/응답 메시지와 타입 정의를 작성합니다.</span></span><br><span class="line"><span class="function">message Point &#123;</span></span><br><span class="line"><span class="function">  int32 latitude = 1</span>;</span><br><span class="line">  <span class="built_in">int32</span> longitude = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">Rectangle</span> </span>&#123;</span><br><span class="line">  Point lo = <span class="number">1</span>;</span><br><span class="line">  Point hi = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">Feature</span> </span>&#123;</span><br><span class="line">  <span class="built_in">string</span> name = <span class="number">1</span>;</span><br><span class="line">  Point location = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">FeatureDatabase</span> </span>&#123;</span><br><span class="line">  <span class="keyword">repeated</span> Feature feature = <span class="number">1</span>;   <span class="comment">// repeated를 사용하면 자바에서 List&lt;Feature&gt;로 생성</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">RouteNote</span> </span>&#123;</span><br><span class="line">  Point location = <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">string</span> <span class="class"><span class="keyword">message</span> = 2;</span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">message</span> RouteSummary </span>&#123;</span><br><span class="line">  <span class="built_in">int32</span> point_count = <span class="number">1</span>;  <span class="comment">// &lt;-- 추후 메시지 변화에 따른 하위 호환성을 위해서 숫자를 지정해야함.</span></span><br><span class="line">  <span class="built_in">int32</span> feature_count = <span class="number">2</span>;</span><br><span class="line">  <span class="built_in">int32</span> distance = <span class="number">3</span>;</span><br><span class="line">  <span class="built_in">int32</span> elapsed_time = <span class="number">4</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-Unary-call"><a href="#1-Unary-call" class="headerlink" title="1. Unary call"></a>1. Unary call</h3><h5 id="Server"><a href="#Server" class="headerlink" title="Server"></a>Server</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RouteGuideService</span> <span class="keyword">extends</span> <span class="title">RouteGuideGrpc</span>.<span class="title">RouteGuideImplBase</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getFeature</span><span class="params">(Point request, StreamObserver&lt;Feature&gt; responseObserver)</span> </span>&#123;</span><br><span class="line">        responseObserver.onNext(checkFeature(request));</span><br><span class="line">        responseObserver.onCompleted();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Client"><a href="#Client" class="headerlink" title="Client"></a>Client</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RouteGuideClient</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ManagedChannel channel;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RouteGuideGrpc.RouteGuideBlockingStub blockingStub;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RouteGuideClient</span><span class="params">(ManagedChannelBuilder&lt;?&gt; channelBuilder)</span> </span>&#123;</span><br><span class="line">        channel = channelBuilder.build();</span><br><span class="line">        blockingStub = RouteGuideGrpc.newBlockingStub(channel);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getFeature</span><span class="params">(<span class="keyword">int</span> lat, <span class="keyword">int</span> lon)</span> </span>&#123;</span><br><span class="line">        Point request = Point.newBuilder()</span><br><span class="line">                             .setLatitude(lat)</span><br><span class="line">                             .setLongitude(lon)</span><br><span class="line">                             .build();</span><br><span class="line"></span><br><span class="line">        Feature feature;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            feature = blockingStub.getFeature(request);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (StatusRuntimeException e) &#123;</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-Server-Streaming"><a href="#2-Server-Streaming" class="headerlink" title="2. Server Streaming"></a>2. Server Streaming</h3><h5 id="Server-1"><a href="#Server-1" class="headerlink" title="Server"></a>Server</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RouteGuideService</span> <span class="keyword">extends</span> <span class="title">RouteGuideGrpc</span>.<span class="title">RouteGuideImplBase</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listFeatures</span><span class="params">(Rectangle request, StreamObserver&lt;Feature&gt; responseObserver)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> left = min(request.getLo().getLongitude(), request.getHi().getLongitude());</span><br><span class="line">        <span class="keyword">int</span> right = max(request.getLo().getLongitude(), request.getHi().getLongitude());</span><br><span class="line">        <span class="keyword">int</span> top = max(request.getLo().getLatitude(), request.getHi().getLatitude());</span><br><span class="line">        <span class="keyword">int</span> bottom = min(request.getLo().getLatitude(), request.getHi().getLatitude());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Feature feature : features) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!RouteGuideUtil.exists(feature)) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> lat = feature.getLocation().getLatitude();</span><br><span class="line">            <span class="keyword">int</span> lon = feature.getLocation().getLongitude();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (lon &gt;= left &amp;&amp; lon &lt;= right &amp;&amp; lat &gt;= bottom &amp;&amp; lat &lt;= top) &#123;</span><br><span class="line">                responseObserver.onNext(feature);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        responseObserver.onCompleted();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Client-1"><a href="#Client-1" class="headerlink" title="Client"></a>Client</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RouteGuideClient</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ManagedChannel channel;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RouteGuideGrpc.RouteGuideBlockingStub blockingStub;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RouteGuideClient</span><span class="params">(ManagedChannelBuilder&lt;?&gt; channelBuilder)</span> </span>&#123;</span><br><span class="line">        channel = channelBuilder.build();</span><br><span class="line">        blockingStub = RouteGuideGrpc.newBlockingStub(channel);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listFeatures</span><span class="params">(<span class="keyword">int</span> lowLat, <span class="keyword">int</span> lowLon, <span class="keyword">int</span> hiLat, <span class="keyword">int</span> hiLon)</span> </span>&#123;</span><br><span class="line">        Rectangle request =</span><br><span class="line">                Rectangle.newBuilder()</span><br><span class="line">                        .setLo(Point.newBuilder().setLatitude(lowLat).setLongitude(lowLon).build())</span><br><span class="line">                        .setHi(Point.newBuilder().setLatitude(hiLat).setLongitude(hiLon).build()).build();</span><br><span class="line">        Iterator&lt;Feature&gt; features;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            features = blockingStub.listFeatures(request);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; features.hasNext(); i++) &#123;</span><br><span class="line">                Feature feature = features.next();</span><br><span class="line">                info(<span class="string">"Result #"</span> + i + <span class="string">": &#123;0&#125;"</span>, feature);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (StatusRuntimeException e) &#123;</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-Client-Streaming"><a href="#3-Client-Streaming" class="headerlink" title="3. Client Streaming"></a>3. Client Streaming</h3><h5 id="Server-2"><a href="#Server-2" class="headerlink" title="Server"></a>Server</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RouteGuideService</span> <span class="keyword">extends</span> <span class="title">RouteGuideGrpc</span>.<span class="title">RouteGuideImplBase</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> StreamObserver&lt;Point&gt; <span class="title">recordRoute</span><span class="params">(StreamObserver&lt;RouteSummary&gt; responseObserver)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> StreamObserver&lt;Point&gt;() &#123;</span><br><span class="line">            <span class="keyword">int</span> pointCount;</span><br><span class="line">            <span class="keyword">int</span> featureCount;</span><br><span class="line">            <span class="keyword">int</span> distance;</span><br><span class="line">            Point previous;</span><br><span class="line">            <span class="keyword">long</span> startTime = System.nanoTime();</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(Point point)</span> </span>&#123;</span><br><span class="line">                pointCount++;</span><br><span class="line">                <span class="keyword">if</span> (RouteGuideUtil.exists(checkFeature(point))) &#123;</span><br><span class="line">                    featureCount++;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (previous != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    distance += calcDistance(previous, point);</span><br><span class="line">                &#125;</span><br><span class="line">                previous = point;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable t)</span> </span>&#123;</span><br><span class="line">                logger.log(Level.WARNING, <span class="string">"Encountered error in recordRoute"</span>, t);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCompleted</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">long</span> seconds = NANOSECONDS.toSeconds(System.nanoTime() - startTime);</span><br><span class="line">                responseObserver.onNext(RouteSummary.newBuilder().setPointCount(pointCount)</span><br><span class="line">                        .setFeatureCount(featureCount).setDistance(distance)</span><br><span class="line">                        .setElapsedTime((<span class="keyword">int</span>) seconds).build());</span><br><span class="line">                responseObserver.onCompleted();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Client-2"><a href="#Client-2" class="headerlink" title="Client"></a>Client</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RouteGuideClient</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ManagedChannel channel;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RouteGuideGrpc.RouteGuideStub asyncStub;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RouteGuideClient</span><span class="params">(ManagedChannelBuilder&lt;?&gt; channelBuilder)</span> </span>&#123;</span><br><span class="line">        channel = channelBuilder.build();</span><br><span class="line">        asyncStub = RouteGuideGrpc.newStub(channel);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">recordRoute</span><span class="params">(List&lt;Feature&gt; features, <span class="keyword">int</span> numPoints)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> CountDownLatch finishLatch = <span class="keyword">new</span> CountDownLatch(<span class="number">1</span>);</span><br><span class="line">        StreamObserver&lt;RouteSummary&gt; responseObserver = <span class="keyword">new</span> StreamObserver&lt;RouteSummary&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(RouteSummary summary)</span> </span>&#123;</span><br><span class="line">                <span class="comment">// summary 처리</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable t)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (testHelper != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    testHelper.onRpcError(t);</span><br><span class="line">                &#125;</span><br><span class="line">                finishLatch.countDown();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCompleted</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                finishLatch.countDown();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        StreamObserver&lt;Point&gt; requestObserver = asyncStub.recordRoute(responseObserver);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; numPoints; ++i) &#123;</span><br><span class="line">                <span class="keyword">int</span> index = random.nextInt(features.size());</span><br><span class="line">                Point point = features.get(index).getLocation();</span><br><span class="line">                requestObserver.onNext(point);</span><br><span class="line">                Thread.sleep(random.nextInt(<span class="number">1000</span>) + <span class="number">500</span>);</span><br><span class="line">                <span class="keyword">if</span> (finishLatch.getCount() == <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException e) &#123;</span><br><span class="line">            requestObserver.onError(e);</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125;</span><br><span class="line">        requestObserver.onCompleted();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!finishLatch.await(<span class="number">1</span>, TimeUnit.MINUTES)) &#123;</span><br><span class="line">            warning(<span class="string">"recordRoute can not finish within 1 minutes"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-양방향-Streaming"><a href="#4-양방향-Streaming" class="headerlink" title="4. 양방향 Streaming"></a>4. 양방향 Streaming</h3><h5 id="Server-3"><a href="#Server-3" class="headerlink" title="Server"></a>Server</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RouteGuideService</span> <span class="keyword">extends</span> <span class="title">RouteGuideGrpc</span>.<span class="title">RouteGuideImplBase</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> StreamObserver&lt;RouteNote&gt; <span class="title">routeChat</span><span class="params">(StreamObserver&lt;RouteNote&gt; responseObserver)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> StreamObserver&lt;RouteNote&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(RouteNote note)</span> </span>&#123;</span><br><span class="line">                List&lt;RouteNote&gt; notes = getOrCreateNotes(note.getLocation());</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Respond with all previous notes at this location.</span></span><br><span class="line">                <span class="keyword">for</span> (RouteNote prevNote : notes.toArray(<span class="keyword">new</span> RouteNote[<span class="number">0</span>])) &#123;</span><br><span class="line">                    responseObserver.onNext(prevNote);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Now add the new note to the list</span></span><br><span class="line">                notes.add(note);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable t)</span> </span>&#123;</span><br><span class="line">                logger.log(Level.WARNING, <span class="string">"Encountered error in routeChat"</span>, t);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCompleted</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                responseObserver.onCompleted();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Client-3"><a href="#Client-3" class="headerlink" title="Client"></a>Client</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RouteGuideClient</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ManagedChannel channel;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RouteGuideGrpc.RouteGuideStub asyncStub;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RouteGuideClient</span><span class="params">(ManagedChannelBuilder&lt;?&gt; channelBuilder)</span> </span>&#123;</span><br><span class="line">        channel = channelBuilder.build();</span><br><span class="line">        asyncStub = RouteGuideGrpc.newStub(channel);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CountDownLatch <span class="title">routeChat</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> CountDownLatch finishLatch = <span class="keyword">new</span> CountDownLatch(<span class="number">1</span>);</span><br><span class="line">        StreamObserver&lt;RouteNote&gt; requestObserver =</span><br><span class="line">                asyncStub.routeChat(<span class="keyword">new</span> StreamObserver&lt;RouteNote&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(RouteNote note)</span> </span>&#123;</span><br><span class="line">                        <span class="comment">//</span></span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable t)</span> </span>&#123;</span><br><span class="line">                        warning(<span class="string">"RouteChat Failed: &#123;0&#125;"</span>, Status.fromThrowable(t));</span><br><span class="line">                        <span class="keyword">if</span> (testHelper != <span class="keyword">null</span>) &#123;</span><br><span class="line">                            testHelper.onRpcError(t);</span><br><span class="line">                        &#125;</span><br><span class="line">                        finishLatch.countDown();</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCompleted</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                        info(<span class="string">"Finished RouteChat"</span>);</span><br><span class="line">                        finishLatch.countDown();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            RouteNote[] requests =</span><br><span class="line">                    &#123;newNote(<span class="string">"First message"</span>, <span class="number">0</span>, <span class="number">0</span>), newNote(<span class="string">"Second message"</span>, <span class="number">0</span>, <span class="number">1</span>),</span><br><span class="line">                            newNote(<span class="string">"Third message"</span>, <span class="number">1</span>, <span class="number">0</span>), newNote(<span class="string">"Fourth message"</span>, <span class="number">1</span>, <span class="number">1</span>)&#125;;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (RouteNote request : requests) &#123;</span><br><span class="line">                requestObserver.onNext(request);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException e) &#123;</span><br><span class="line">            requestObserver.onError(e);</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125;</span><br><span class="line">        requestObserver.onCompleted();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> finishLatch;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="고민해볼-문제"><a href="#고민해볼-문제" class="headerlink" title="고민해볼 문제"></a>고민해볼 문제</h2><ul>
<li><h5 id="Testing"><a href="#Testing" class="headerlink" title="Testing"></a>Testing</h5><ul>
<li>gRPC client <a href="https://www.npmjs.com/package/grpcc" target="_blank" rel="noopener">https://www.npmjs.com/package/grpcc</a></li>
<li>gRPC JUnit Test <a href="https://grpc.io/blog/gracefully_clean_up_in_grpc_junit_tests" target="_blank" rel="noopener">https://grpc.io/blog/gracefully_clean_up_in_grpc_junit_tests</a></li>
</ul>
</li>
<li><h5 id="Authenticatoin"><a href="#Authenticatoin" class="headerlink" title="Authenticatoin"></a>Authenticatoin</h5><ul>
<li>TLS, OAuth</li>
</ul>
</li>
<li><h5 id="Load-Balancing-Client-side-Server-side"><a href="#Load-Balancing-Client-side-Server-side" class="headerlink" title="Load Balancing (Client-side, Server-side)"></a>Load Balancing (Client-side, Server-side)</h5><ul>
<li>Load Balancing in gRPC <a href="https://grpc.io/blog/loadbalancing" target="_blank" rel="noopener">https://grpc.io/blog/loadbalancing</a> <a href="https://github.com/grpc/grpc/blob/master/doc/load-balancing.md" target="_blank" rel="noopener">https://github.com/grpc/grpc/blob/master/doc/load-balancing.md</a></li>
<li>gRPC Load Balancing Example in Kubernetes <a href="https://github.com/saturnism/grpc-java-by-example/tree/master/kubernetes-lb-example" target="_blank" rel="noopener">https://github.com/saturnism/grpc-java-by-example/tree/master/kubernetes-lb-example</a></li>
<li>Spring-gRPC Load Balancing with Eureka <a href="https://github.com/saturnism/grpc-java-by-example/tree/master/springboot-example" target="_blank" rel="noopener">https://github.com/saturnism/grpc-java-by-example/tree/master/springboot-example</a></li>
</ul>
</li>
<li><h5 id="Monitoring"><a href="#Monitoring" class="headerlink" title="Monitoring"></a>Monitoring</h5><ul>
<li>Zipkin, Prometheus, Statsd, Google, DIY</li>
<li>java-grpc-prometheus example <a href="https://github.com/grpc-ecosystem/java-grpc-prometheus" target="_blank" rel="noopener">https://github.com/grpc-ecosystem/java-grpc-prometheus</a></li>
</ul>
</li>
<li><h5 id="Proxies-Web"><a href="#Proxies-Web" class="headerlink" title="Proxies, Web"></a>Proxies, Web</h5><ul>
<li>haproxy, traefik, grpc-gateway</li>
<li>Grpc LB, Service Discovery (etcd, zookeeper, eureka)</li>
</ul>
</li>
<li><h5 id="Versioning"><a href="#Versioning" class="headerlink" title="Versioning"></a>Versioning</h5></li>
</ul>
<h2 id="참고자료"><a href="#참고자료" class="headerlink" title="참고자료"></a>참고자료</h2><ul>
<li><a href="https://grpc.io/docs/guides/concepts.html" target="_blank" rel="noopener">https://grpc.io/docs/guides/concepts.html</a></li>
<li><a href="https://github.com/grpc/grpc-java" target="_blank" rel="noopener">https://github.com/grpc/grpc-java</a></li>
<li><a href="https://github.com/grpc/grpc-web" target="_blank" rel="noopener">https://github.com/grpc/grpc-web</a></li>
<li><a href="https://github.com/grpc-ecosystem" target="_blank" rel="noopener">https://github.com/grpc-ecosystem</a></li>
<li><p><a href="https://github.com/grpc-ecosystem/awesome-grpc" target="_blank" rel="noopener">https://github.com/grpc-ecosystem/awesome-grpc</a></p>
</li>
<li><p><a href="https://github.com/saturnism/grpc-java-by-example" target="_blank" rel="noopener">https://github.com/saturnism/grpc-java-by-example</a></p>
</li>
<li><a href="https://medium.com/@goinhacker/microservices-with-grpc-d504133d191d" target="_blank" rel="noopener">https://medium.com/@goinhacker/microservices-with-grpc-d504133d191d</a></li>
<li><a href="https://www.slideshare.net/borisovalex/enabling-googley-microservices-with-http2-and-grpc?next_slideshow=1" target="_blank" rel="noopener">https://www.slideshare.net/borisovalex/enabling-googley-microservices-with-http2-and-grpc?next_slideshow=1</a></li>
<li><a href="https://www.slideshare.net/VarunTalwar4/grpc-design-and-implementation" target="_blank" rel="noopener">https://www.slideshare.net/VarunTalwar4/grpc-design-and-implementation</a></li>
<li><a href="https://www.slideshare.net/datawire/bringing-learnings-from-googley-microservices-with-grpc-varun-talwar-google" target="_blank" rel="noopener">https://www.slideshare.net/datawire/bringing-learnings-from-googley-microservices-with-grpc-varun-talwar-google</a></li>
<li><a href="http://www.baeldung.com/grpc-introduction" target="_blank" rel="noopener">http://www.baeldung.com/grpc-introduction</a></li>
<li>Armeria</li>
</ul>
<p>[^1]: 링구아 프랑카(lingua franca)는 서로 다른 모어를 사용하는 화자들이 의사소통을 하기 위해 공통어로 사용하는 제 3의 언어(때로는 한 집단의 모어)를 말하며 국가나 단체에서 공식적으로 정한 언어를 뜻하는 공용어와는 다른 개념이다. 정의를 통해 알 수 있듯, <strong>링구아 프랑카</strong>는 특정 언어를 지칭하는 표현이 아니라, 언어 가교의 기능을 수행하는 언어들을 통칭하는 표현이다. 여기에서 의미가 파생되어 학술, 상업 등의 특정 분야에서 널리 사용되는 언어라는 뜻으로 사용되기도 한다. 피진이나 크리올은 <strong>링구아 프랑카</strong>와 유사한 개념이지만 정의상 완전히 일치하지는 않는다. (그러나 대다수가 언어 가교의 기능을 수행하기에 많은 부분 겹친다고 볼 수 있다) - <a href="https://ko.wikipedia.org/wiki/%EB%A7%81%EA%B5%AC%EC%95%84_%ED%94%84%EB%9E%91%EC%B9%B4" target="_blank" rel="noopener">https://ko.wikipedia.org/wiki/%EB%A7%81%EA%B5%AC%EC%95%84_%ED%94%84%EB%9E%91%EC%B9%B4</a><br>[^2]: HTTP/1은 기본적으로 클라이언트가 서버에 요청을 보내고, 서버가 요청에 대한 응답을 보내는 구조입니다. 따라서 요청 단위로 클라이언트와 서버를 왕복해야 합니다. 또한 쿠키를 포함한 헤더 크기는 불필요하게 큽니다. 이런 특징때문에 HTTP/1은 느립니다. 성능을 개선하기 위해서 구글은 SPDY를 개발하고, 이를 기반으로 HTTP/2 표준이 만들어집니다. 성능이 개선된 HTTP/2의 주요 특징은 아래와 같습니다. <strong>Header Compression</strong>: Header Table과 Huffman Encoding 기법을 사용하여 HTTP/2 헤더정보를 압축하였습니다. <strong>Multiplexed Streams</strong>: HTTP/1에서 요청마다 새로운 커넥션을 자주 만드는 것과는 달리 HTTP/2는 한개의 커넥션으로 동시에 여러개의 메시지를 주고 받을 수 있습니다. <strong>Server Push</strong>: HTTP/2에서는 클라이언트의 요청없이도 서버가 리소스를 보낼 수 있습니다. 클라이언트 요청이 최소화되기 때문에 성능이 향상될 수 있습니다. <strong>Stream Priority</strong>: 요청에 우선순위를 지정하여 중요한 리소스를 먼저 전달받을 수 있습니다. <a href="http://www.http2demo.io/" target="_blank" rel="noopener">http://www.http2demo.io/</a>  <a href="http://http2.golang.org/gophertiles?latency=1000" target="_blank" rel="noopener">http://http2.golang.org/gophertiles?latency=1000</a></p>
<p><img src="/images/20180706-about-grpc/http2.png"></p>

      
    </div>
    <footer class="article-footer">
      
      
      <div>
        <ul class="post-copyright">
          <li class="post-copyright-author">
          <strong>Post author:  </strong>Icednut
          </li>
          <li class="post-copyright-link">
          <strong>Post link:  </strong>
          <a href="/2018/07/04/20180706-about-grpc/" target="_blank" title="gRPC 살펴보기 (gRPC Overview)">http://icednut.github.io/2018/07/04/20180706-about-grpc/</a>
          </li>
          <li class="post-copyright-license">
            <strong>Copyright Notice:   </strong>
            All articles in this blog are licensed under <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">CC BY-NC-ND 4.0</a>
            unless stating additionally.
          </li>
         
        </ul>
<div>
</div></div>
      
      
        
	<section id="comments" class="comment">
	  <div id="disqus_thread">
	  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
	  </div>
	</section>

	<script type="text/javascript">
	var disqus_shortname = 'icednut';
	(function(){
	  var dsq = document.createElement('script');
	  dsq.type = 'text/javascript';
	  dsq.async = true;
	  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	}());
	(function(){
	  var dsq = document.createElement('script');
	  dsq.type = 'text/javascript';
	  dsq.async = true;
	  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
	  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	}());
	</script>



      
      

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/11/25/20181125-scala-and-functional-programming-day01/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          스칼라 스터디 Day01 - 함수형 프로그래밍이란?
        
      </div>
    </a>
  
  
    <a href="/2018/05/24/20180524-java-stream-tips/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Java9에서의 Stream에 관한 짧은 팁</div>
    </a>
  
</nav>

  
</article>

<!-- Table of Contents -->

</section>
        
      </div>
      
      <footer id="footer">
  

  <div class="container">
      	<div class="row">
	      <p> Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/iTimeTraveler/hexo-theme-hiker" target="_blank">Hexo-theme-hiker</a> </p>
	      <p id="copyRightEn">Copyright &copy; 2013 - 2019 Icednut&#39;s Note All Rights Reserved.</p>
	      
	      
  		   	<p id="copyRightCn">Icednut hold copyright</p>
  		   
		</div>

		
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");
    var allheader = document.getElementById("allheader");

    wrapdiv.style.minHeight = document.body.offsetHeight + "px";
    if (allheader != null) {
      contentdiv.style.minHeight = document.body.offsetHeight - allheader.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    } else {
      contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    }
</script>
    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/categories" class="mobile-nav-link">Categories</a>
  
    <a href="/tags" class="mobile-nav-link">Tags</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav> -->
    

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/scripts.js"></script>


  <script src="/js/home.js"></script>



  <script src="/js/dialog.js"></script>



<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-91631073-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->












  </div>

  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="myModalLabel">设置</h2>
      </div>
      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">


      <div class="modal-body">
          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" onclick="javascript:setFontSize();" aria-expanded="true" aria-controls="collapseOne">
              正文字号大小
            </a>
          </div>
          <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
          <div class="panel-body">
            您已调整页面字体大小
          </div>
        </div>
      


          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" onclick="javascript:setBackground();" aria-expanded="true" aria-controls="collapseTwo">
              夜间护眼模式
            </a>
        </div>
          <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
          <div class="panel-body">
            夜间模式已经开启，再次单击按钮即可关闭 
          </div>
        </div>

        <div>
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="true" aria-controls="collapseThree">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;关 于&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
        </div>
         <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
          <div class="panel-body">
            Icednut&#39;s Note
          </div>
          <div class="panel-body">
            Copyright © 2019 Icednut All Rights Reserved.
          </div>
        </div>
      </div>


      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <div class="modal-footer">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
      </div>
    </div>
  </div>
</div>
  
  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
  
</body>
</html>