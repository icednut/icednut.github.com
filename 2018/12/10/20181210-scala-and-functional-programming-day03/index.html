<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>스칼라 스터디 day03 - 예외를 이용하지 않은 오류 처리 | Icednut&#39;s Note</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="keywords" content="scalafunctional programming">
  
  
  
  
  <meta name="description" content="출처: 스칼라로 배우는 함수형 프로그래밍 4장 Chapter 04. 예외를 이용하지 않은 오류 처리이번 챕터에서 다룰 내용  예외를 던지는 기존의 방식 살펴보기 예외를 던지는게 왜 어때서? 예외를 안던지고 반환하면 뭐가 좋을까?   예외를 던지지 않고 예외 처리를 미루는 방법 Option 예외를 미루지 말고 예외를 반환하기 Either    예외를 던지는">
<meta name="keywords" content="scala,functional programming">
<meta property="og:type" content="article">
<meta property="og:title" content="스칼라 스터디 Day03 - 예외를 이용하지 않은 오류 처리">
<meta property="og:url" content="http://icednut.github.io/2018/12/10/20181210-scala-and-functional-programming-day03/index.html">
<meta property="og:site_name" content="Icednut&#39;s Note">
<meta property="og:description" content="출처: 스칼라로 배우는 함수형 프로그래밍 4장 Chapter 04. 예외를 이용하지 않은 오류 처리이번 챕터에서 다룰 내용  예외를 던지는 기존의 방식 살펴보기 예외를 던지는게 왜 어때서? 예외를 안던지고 반환하면 뭐가 좋을까?   예외를 던지지 않고 예외 처리를 미루는 방법 Option 예외를 미루지 말고 예외를 반환하기 Either    예외를 던지는">
<meta property="og:locale" content="Korean">
<meta property="og:updated_time" content="2018-12-11T13:53:47.784Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="스칼라 스터디 Day03 - 예외를 이용하지 않은 오류 처리">
<meta name="twitter:description" content="출처: 스칼라로 배우는 함수형 프로그래밍 4장 Chapter 04. 예외를 이용하지 않은 오류 처리이번 챕터에서 다룰 내용  예외를 던지는 기존의 방식 살펴보기 예외를 던지는게 왜 어때서? 예외를 안던지고 반환하면 뭐가 좋을까?   예외를 던지지 않고 예외 처리를 미루는 방법 Option 예외를 미루지 말고 예외를 반환하기 Either    예외를 던지는">
  
    <link rel="alternate" href="/atom.xml" title="Icednut&#39;s Note" type="application/atom+xml">
  

  

  <link rel="icon" href="/css/images/mylogo.jpg">
  <link rel="apple-touch-icon" href="/css/images/mylogo.jpg">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
  <link rel="stylesheet" href="/css/style.css">

  <script src="/js/jquery-3.1.1.min.js"></script>
  <script src="/js/bootstrap.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css">

  
    <link rel="stylesheet" href="/css/dialog.css">
  

  

  
    <link rel="stylesheet" href="/css/header-post.css">
  

  
  
  

</head>
</html>


  <body data-spy="scroll" data-target="#toc" data-offset="50">


  
  <div id="container">
    <div id="wrap">
      
        <header>

    <div id="allheader" class="navbar navbar-default navbar-static-top" role="navigation">
        <div class="navbar-inner">
          
          <div class="container"> 
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>

            
              <a class="brand" style="border-width: 0;">
                <p>Icednut&#39;s Note</p>
              </a>
            
            
            <div class="navbar-collapse collapse">
              <ul class="hnav navbar-nav">
                
                  <li> <a class="main-nav-link" href="/">Home</a> </li>
                
                  <li> <a class="main-nav-link" href="/archives">Archives</a> </li>
                
                  <li> <a class="main-nav-link" href="/categories">Categories</a> </li>
                
                  <li> <a class="main-nav-link" href="/tags">Tags</a> </li>
                
                  <li> <a class="main-nav-link" href="/about">About</a> </li>
                
                  <li><div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="">
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something...">
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div></li>
            </ul></div>
          </div>
                
      </div>
    </div>

</header>



      
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;"><article id="post-20181210-scala-and-functional-programming-day03" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      스칼라 스터디 Day03 - 예외를 이용하지 않은 오류 처리
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2018/12/10/20181210-scala-and-functional-programming-day03/" class="article-date">
	  <time datetime="2018-12-10T14:47:36.000Z" itemprop="datePublished">2018-12-10</time>
	</a>

      
      
      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>출처: 스칼라로 배우는 함수형 프로그래밍 4장</p>
<h2 id="Chapter-04-예외를-이용하지-않은-오류-처리"><a href="#Chapter-04-예외를-이용하지-않은-오류-처리" class="headerlink" title="Chapter 04. 예외를 이용하지 않은 오류 처리"></a>Chapter 04. 예외를 이용하지 않은 오류 처리</h2><p>이번 챕터에서 다룰 내용</p>
<ul>
<li>예외를 던지는 기존의 방식 살펴보기<ul>
<li>예외를 던지는게 왜 어때서?</li>
<li>예외를 안던지고 반환하면 뭐가 좋을까?</li>
</ul>
</li>
<li>예외를 던지지 않고 예외 처리를 미루는 방법 Option</li>
<li>예외를 미루지 말고 예외를 반환하기 Either</li>
</ul>
<p><br></p>
<p><br></p>
<h3 id="예외를-던지는-기존-방식"><a href="#예외를-던지는-기존-방식" class="headerlink" title="예외를 던지는 기존 방식"></a>예외를 던지는 기존 방식</h3><p>1장에서 예외(exception)을 던지는 것이 하나의 부수 효과라고 말했다. (함수형 프로그래밍에서는 부수 효과가 쥐약인데…)</p>
<blockquote>
<h5 id="여기서-잠깐"><a href="#여기서-잠깐" class="headerlink" title="여기서 잠깐?!"></a>여기서 잠깐?!</h5><p>Q: 그럼 예외를 던지지 않는다면 어떻게 처리할까?</p>
<ul>
<li>A: <code>예외를 값으로 돌려주기</code>를 하면 부수효과 없는 함수를 만들 수 있게 된다.</li>
</ul>
<p>Q: 예외를 값으로 돌려주면 뭐가 좋을까?</p>
<ul>
<li>A: <code>참조 투명성</code>을 유지할 수 있게 된다. (참조 투명성을 유지하는 것이 왜 중요한지는 생략)</li>
</ul>
<p>오류(유효하지 않은 출력)에 대한 처리를 컴파일 타임에 명시할 수 있게 된다.</p>
</blockquote>
<p>예외를 명시적으로 처리하게 하거나 예외를 값으로 반환하기 위해서는 Option과 Either를 사용해야 한다. 이번 장에서는 Option과 Either를 직접 만들어보면서 이해와 사용 방법을 익혀보자.</p>
<h4 id="예외가-왜-참조-투명성을-해칠까"><a href="#예외가-왜-참조-투명성을-해칠까" class="headerlink" title="예외가 왜 참조 투명성을 해칠까?"></a>예외가 왜 참조 투명성을 해칠까?</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">failingFn1</span></span>(i: <span class="type">Int</span>): <span class="type">Int</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> y: <span class="type">Int</span> = <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">Exception</span>(<span class="string">"fail!"</span>)</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">val</span> x = <span class="number">42</span> + <span class="number">5</span></span><br><span class="line">        x + y</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> e: <span class="type">Exception</span> =&gt; <span class="number">43</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">failingFn2</span></span>(i: <span class="type">Int</span>): <span class="type">Int</span> = &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">val</span> x = <span class="number">42</span> + <span class="number">5</span></span><br><span class="line">        x + ((<span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">Exception</span>(<span class="string">"fail!"</span>)): <span class="type">Int</span>)</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> e: <span class="type">Exception</span> =&gt; <span class="number">43</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>위 함수들을 실행하면 failingFn1을 실행하면 예외가 발생하고 failingFn2를 실행하면 43이 반환된다. 이 결과가 시사하는 바가 뭘까?</p>
<p>참조에 투명한 문맥이라면 y를 값으로 치환해도 항상 동일한 결과를 반환해야 한다. 하지만 위 예외 발생코드는 문맥의 위치에 따라서 결과값이 달라지는 현상이 발생하고 있다.(try 안에 있느냐 밖에 있느냐..) 즉 문맥(Context)에 의존적이라는 의미다. </p>
<p>따라서 예외의 문제점은 다음과 같다.</p>
<ul>
<li>예외는 참조 투명성을 위반하고 문맥 의존성을 갖게 만든다.</li>
<li>예외가 있는 함수는 리턴에 대해 예측 불가능하다.<ul>
<li>failingFn 함수형식인 Int =&gt; Int 만 보고도 예외가 발생할지 알 수 있는가?</li>
</ul>
</li>
</ul>
<h4 id="그럼-참조-투명성-있는-예외를-다루는-함수를-만들려면"><a href="#그럼-참조-투명성-있는-예외를-다루는-함수를-만들려면" class="headerlink" title="그럼 참조 투명성 있는 예외를 다루는 함수를 만들려면?"></a>그럼 참조 투명성 있는 예외를 다루는 함수를 만들려면?</h4><p>이거 한 가지만 기억하자. <code>예외를 던지지 말고, 예외적인 조건이 발생했음을 뜻하는 값을 돌려주자.</code></p>
<p>그렇게 하면 예외적인 조건에 대한 처리를 받는 쪽에서 처리해야만 컴파일 통과하게 된다. 참조 투명성도 지키고 예외 처리를 빼먹는 실수도 미연에 방지할 수 있게 된다.</p>
<blockquote>
<h5 id="여기서-잠깐-1"><a href="#여기서-잠깐-1" class="headerlink" title="여기서 잠깐?!"></a>여기서 잠깐?!</h5><p>Q: Java의 Checked Exception은 예외를 던지면서 동시에 예외 처리를 컴파일 타임에 강제하지 않는가? 이거랑 뭐가 다른건지?</p>
<ul>
<li>A: Checked Exception은 고차함수에는 통하지 않는 단점이 있다. 예를 들어 List.map과 같은 고차함수에는 익명 함수에서 Checked Exception이 발생한다면 그 모든 Checked Exception 마다 List.map에 처리를 추가할 것인가?</li>
<li>(그야말로 이건 미친짓이다..)</li>
</ul>
</blockquote>
<p>그럼 또 다른 예외를 반환하는 부수효과가 있는 함수를 살펴보고 부수효과를 없애보는 과정을 살펴보자.</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mean</span></span>(xs: <span class="type">Seq</span>[<span class="type">Double</span>]): <span class="type">Double</span> = </span><br><span class="line">  <span class="keyword">if</span> (xs.isEmpty) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">ArithmeticException</span>(<span class="string">"mean of empty list!"</span>)</span><br><span class="line">  <span class="keyword">else</span> xs.sum / xs.length</span><br></pre></td></tr></table></figure>
<p>위 mean 함수는 xs 파라미터에 따라 예외를 발생할 수도 있고 계산된 결과 값을 반환할 수도 있다. 즉 일부 입력에 대해서는 값을 반환하지 않는 부분함수(partial function)이다.</p>
<h5 id="해결1-예외-대신-null을-반환한다"><a href="#해결1-예외-대신-null을-반환한다" class="headerlink" title="해결1: 예외 대신 null을 반환한다."></a>해결1: 예외 대신 null을 반환한다.</h5><p>null을 반환하면 또 다른 문제만 만들뿐이다.</p>
<ul>
<li>null 처리를 빼먹을 수 있는 실수를 발생하게 만든다. (게다가 이건 컴파일 타임에 잡히지도 않는다.)</li>
<li>혹은 null을 검사하는 로직을 넣어야 한다. (if문으로 null을 체크하는 판에 박힌 코드가 생긴다.)</li>
<li>지금은 반환 가능한 Double이지만 커링에서는 어떻게 할 것인가? 이때는 null로도 반환할 수 없다.<ul>
<li><code>def max[A](xs: Seq[A])(greater: (A, A) =&gt; Boolean): A</code></li>
<li>위와 같은 함수 형식에서 xs.isEmpty일 때 null을 반환한다고? null 반환 못한다고!!</li>
</ul>
</li>
</ul>
<h5 id="해결2-예외적인-상황에-처했을-때-반환할-값을-인자로-전달한다"><a href="#해결2-예외적인-상황에-처했을-때-반환할-값을-인자로-전달한다" class="headerlink" title="해결2: 예외적인 상황에 처했을 때 반환할 값을 인자로 전달한다."></a>해결2: 예외적인 상황에 처했을 때 반환할 값을 인자로 전달한다.</h5><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mean_1</span></span>(xs: <span class="type">IndexedSeq</span>[<span class="type">Double</span>], onEmpty: <span class="type">Double</span>): <span class="type">Double</span> = </span><br><span class="line">  <span class="keyword">if</span> (xs.isEmpty) onEmpty</span><br><span class="line">  <span class="keyword">else</span> xs.sum / xs.length</span><br></pre></td></tr></table></figure>
<p>이렇게 되면 모든 입력 값에 대해 모든 반환 값을 받으므로 완전 함수(total function)이 되지만, 여기에도 문제가 있다.</p>
<ul>
<li>onEmpty를 넘기지 않고도 mean_1 호출하는 것 자체를 취소하고 싶으면 어떻게 할까? (또 if라는 틀에 박힌 코드가 생기겠지..)</li>
<li>아니면 예외적인 상황에서 완전히 다른 분기로 넘기려면? (역시 중복코드와 실수를 유발할 수 있음)</li>
</ul>
<p>결국 해결1, 2는 진정한 해결이 아니라는 의미다.</p>
<h5 id="해결3-예외-처리를-호출하는-곳으로-미루자"><a href="#해결3-예외-처리를-호출하는-곳으로-미루자" class="headerlink" title="해결3: 예외 처리를 호출하는 곳으로 미루자."></a>해결3: 예외 처리를 호출하는 곳으로 미루자.</h5><p>바로 다음과 같이 말이다.</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mean</span></span>(xs: <span class="type">Seq</span>[<span class="type">Double</span>]): <span class="type">Option</span>[<span class="type">Double</span>] = </span><br><span class="line">  <span class="keyword">if</span> (xs.isEmpty) <span class="type">None</span></span><br><span class="line">  <span class="keyword">else</span> <span class="type">Some</span>(xs.sum / xs.length)</span><br></pre></td></tr></table></figure>
<p>이렇게 되면 mean을 호출하면 항상 Option을 받기 때문에 완전 함수(total function)이 된다. (야호!) 또한 유효하지 않은 값(None)에 대한 처리를 호출하는 곳에서 명시를 해야하기 때문에 컴파일 타임에서 오류를 미연에 방지하는 코드를 작성하게 된다.</p>
<h3 id="예외를-던지지-않고-예외-처리를-미루는-방법-Option"><a href="#예외를-던지지-않고-예외-처리를-미루는-방법-Option" class="headerlink" title="예외를 던지지 않고 예외 처리를 미루는 방법 Option"></a>예외를 던지지 않고 예외 처리를 미루는 방법 Option</h3><p>그럼 Option의 정의를 살펴보고 직접 구현해보자.</p>
<h4 id="연습문제-4-1"><a href="#연습문제-4-1" class="headerlink" title="연습문제 4.1"></a>연습문제 4.1</h4><script src="https://scastie.scala-lang.org/icednut/FsLInrZaQIaPGDHqE0tCnQ.js"></script>

<blockquote>
<h5 id="여기서-잠깐-2"><a href="#여기서-잠깐-2" class="headerlink" title="여기서 잠깐?!"></a>여기서 잠깐?!</h5><ul>
<li><code>default: =&gt; B</code>는 타입은 B이지만 default가 실제로 쓰이기 전까지는 평가(실행 혹은 참조)하지 않는다.</li>
<li><code>B &gt;: A</code>는 B가 A와 같거나 A의 상위 형식(Supertype)이어야 함을 뜻한다.</li>
</ul>
</blockquote>
<p>Option을 쓰게 되면 값이 없다거나라는 점검 코드를 작성하지 않고도 그냥 코드를 작성하면 된다.</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span>(<span class="params">name: <span class="type">String</span>, department: <span class="type">String</span></span>)</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">def</span> <span class="title">lookupByName</span>(<span class="params">name: <span class="type">String</span></span>)</span>: <span class="type">Option</span>[<span class="type">Employee</span>] = ???</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">joeDepartment</span></span>: <span class="type">Option</span>[<span class="type">String</span>] = lookupByName(<span class="string">"Joe"</span>).map(_.department)</span><br><span class="line"><span class="comment">// lookupByName("Joe")의 결과가 없으면 None을 반환하기 때문에 .map 호출이 유효하다.</span></span><br></pre></td></tr></table></figure>
<p>위 코드를 보면 None일 때 점검하는 코드를 작성했는가? 전혀 아니다.</p>
<p>또 예외처리에 대해 호출자에서 일관된 처리를 하게 만들 수 있고 문맥에 의존적인 오류로직 따위는 저멀리 사라지게 된다.</p>
<p>그렇다면 Option을 사용하지 않는 기존의 함수들에 대해서 Option을 적용하고 싶다면 어떻게 할까?</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">insuranceRateQuote</span></span>(age: <span class="type">Int</span>, numberOfSpeedingTickets: <span class="type">Int</span>): <span class="type">Double</span></span><br></pre></td></tr></table></figure>
<p>예를 들어 위 함수를 호출하는 함수를 만든다고 해보자. 이 때 인자에 문자열에서 숫자로 파싱하여 전달한다고 할 때 제대로 파싱되면 호출하고 아니라면 호출하지 않게 하려면 어떻게 할까?</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parseInsuranceRateQuote</span></span>(age: <span class="type">String</span>, numberOfSpeedingTickets: <span class="type">String</span>): <span class="type">Option</span>[<span class="type">Double</span>] = &#123;</span><br><span class="line">    <span class="keyword">val</span> optAge: <span class="type">Option</span>[<span class="type">Int</span>] = <span class="type">Try</span>(age.toInt)</span><br><span class="line">    <span class="keyword">val</span> optNumberOfSpeedingTickets: <span class="type">Option</span>[<span class="type">Int</span>] = <span class="type">Try</span>(numberOfSpeedingTickets.toInt)</span><br><span class="line">    </span><br><span class="line">    insuranceRateQuote(optAge, optNumberOfSpeeedingTickets)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Try</span></span>[<span class="type">A</span>](a: =&gt; <span class="type">A</span>): <span class="type">Option</span>[<span class="type">A</span>] = </span><br><span class="line">  <span class="keyword">try</span> <span class="type">Some</span>(a)</span><br><span class="line">  <span class="keyword">catch</span> &#123; <span class="keyword">case</span> e: <span class="type">Exception</span> =&gt; <span class="type">None</span> &#125;</span><br></pre></td></tr></table></figure>
<p>여기서 <code>age.toInt</code>와 <code>numberOfSpeedingTickets.toInt</code>는 충분히 예외가 발생할 수 있는 로직이다. 그러나 Try라는 함수 덕분에 Option으로 감쌀 수 있다. 그러나 문제는 insuranceRateQuote 함수의 인자는 Option을 받을 수 없고 Int만 받을 수 있다.</p>
<p>이걸 어떻게 해결할까? insuranceRateQuote 함수의 인자를 고쳐야 하는 것일까?</p>
<p>답은 커링을 써서 값이 있으면 insuranceRateQuote 함수를 호출하고 아니라면 None을 반환하는 고차함수(map2)를 작성한다. 그 고차함수 호출은 다음과 같은 형태가 된다.</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parseInsuranceRateQuote</span></span>(age: <span class="type">String</span>, numberOfSpeedingTickets: <span class="type">String</span>): <span class="type">Option</span>[<span class="type">Double</span>] = &#123;</span><br><span class="line">    <span class="keyword">val</span> optAge: <span class="type">Option</span>[<span class="type">Int</span>] = <span class="type">Try</span> &#123; age.toInt &#125;</span><br><span class="line">    <span class="keyword">val</span> optTickets: <span class="type">Option</span>[<span class="type">Int</span>] = <span class="type">Try</span> &#123; numberOfSpeedingTickets.toInt &#125;</span><br><span class="line">    map2(optAge, optTickets)(insuranceRateQuote)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>그럼 map2를 구현해보자.</p>
<h4 id="연습문제-4-3"><a href="#연습문제-4-3" class="headerlink" title="연습문제 4.3"></a>연습문제 4.3</h4><script src="https://scastie.scala-lang.org/icednut/p0C17LMMTb2ahDZjQ3nKZw.js"></script>

<p>그럼 map2 함수에서 좀 더 발전하여 인수 2개 뿐만 아니라 목록으로 받는 고차함수를 작성해보자.</p>
<h4 id="연습문제-4-4"><a href="#연습문제-4-4" class="headerlink" title="연습문제 4.4"></a>연습문제 4.4</h4><script src="https://scastie.scala-lang.org/icednut/ftjs3S72RLGQQ8kIv52iCQ.js"></script>

<p><code>parseInts</code> 함수를 보면 문제점이 하나 있다.</p>
<p><code>a map (i =&gt; MyTry(i.toInt))</code> 때문에 리스트를 한 번 훑어서 <code>Option[Int]</code>로 변환한 뒤 <code>sequence()</code>의 함수 내부에서 한 번 또 훑는 작업(for-comprehension)을 타서 총 2번의 루프를 타게 된다.</p>
<p>이걸 해결하기 위해 traverse라는 고차함수를 만들어보자.</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">traverse</span></span>[<span class="type">A</span>, <span class="type">B</span>](a: <span class="type">List</span>[<span class="type">A</span>])(f: <span class="type">A</span> =&gt; <span class="type">Option</span>[<span class="type">B</span>]): <span class="type">Option</span>[<span class="type">List</span>[<span class="type">B</span>]]</span><br></pre></td></tr></table></figure>
<h4 id="연습문제-4-5"><a href="#연습문제-4-5" class="headerlink" title="연습문제 4.5"></a>연습문제 4.5</h4><script src="https://scastie.scala-lang.org/icednut/yDX7Ah8wTFSnimPOqVpWPg.js"></script>



<h3 id="예외를-미루지-말고-예외를-반환하기-Either"><a href="#예외를-미루지-말고-예외를-반환하기-Either" class="headerlink" title="예외를 미루지 말고 예외를 반환하기 Either"></a>예외를 미루지 말고 예외를 반환하기 Either</h3><p>Option은 무엇이 잘못 되었는지는 생략되고 그냥 None이 반환될 뿐이다. 그러나 아래와 같이 하고 싶을 때도 있을 것이다.</p>
<ul>
<li>예외적인 상황에 마주했을 때 예외적인 상황에 대한 자세한 정보를 담은 String을 받고 싶다.</li>
<li>예외가 발생한 경우 실제 그 예외를 알고 싶다. (Option일 경우는 무슨 예외인지 알 수 없고 그냥 None이기 때문)</li>
</ul>
<p>위 문제를 해결하기 위해 실패의 원인을 담고 있는 Either라는 자료 형식을 만들어보자.</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">sealed</span> <span class="class"><span class="keyword">trait</span> <span class="title">Either</span>[+<span class="type">E</span>, +<span class="type">A</span>]</span></span><br><span class="line"><span class="class"><span class="title">case</span> <span class="title">class</span> <span class="title">Left</span>[+<span class="type">E</span>](<span class="params">value: <span class="type">E</span></span>) <span class="keyword">extends</span> <span class="title">Either</span>[<span class="type">E</span>, <span class="type">Nothing</span>]</span></span><br><span class="line"><span class="class"><span class="title">case</span> <span class="title">class</span> <span class="title">Right</span>[+<span class="type">A</span>](<span class="params">value: <span class="type">A</span></span>) <span class="keyword">extends</span> <span class="title">Either</span>[<span class="type">Nothing</span>, <span class="type">A</span>]</span></span><br></pre></td></tr></table></figure>
<p>Either와 같은 자료 형식을 서로 소 합집합 즉 분리합집합이라고 한다. (왜? 값과 예외라는 서로 공통점이 없는 값들을 하나의 합집합으로 묶은 자료형이기 때문)</p>
<p>Either의 사용방법은 다음과 같다.</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mean</span></span>(xs: <span class="type">IndexedSeq</span>[<span class="type">Double</span>]): <span class="type">Either</span>[<span class="type">String</span>, <span class="type">Double</span>] = </span><br><span class="line">  <span class="keyword">if</span> (xs.isEmpty) <span class="type">Left</span>(<span class="string">"mean of empty list!"</span>)</span><br><span class="line">  <span class="keyword">else</span> <span class="type">Right</span>(xs.sum / xs.length)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Try</span></span>[<span class="type">A</span>](a: =&gt; <span class="type">A</span>): <span class="type">Either</span>[<span class="type">Exception</span>, <span class="type">A</span>] = </span><br><span class="line">  <span class="keyword">try</span> <span class="type">Right</span>(a)</span><br><span class="line">  <span class="keyword">catch</span> &#123; <span class="keyword">case</span> e: <span class="type">Exception</span> =&gt; <span class="type">Left</span>(e) &#125;</span><br></pre></td></tr></table></figure>
<h4 id="연습문제-4-6"><a href="#연습문제-4-6" class="headerlink" title="연습문제 4.6"></a>연습문제 4.6</h4><script src="https://scastie.scala-lang.org/icednut/7uOiUSYvQBuD5HyWHB5HXg.js"></script>

<p>Either의 사용 예시를 살펴보자.</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parseInsuranceRateQuote</span></span>(age: <span class="type">String</span>, numberOfSpeedingTickets: <span class="type">String</span>): <span class="type">Either</span>[<span class="type">Exception</span>, <span class="type">Double</span>] = </span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        a &lt;- <span class="type">Try</span> &#123; age.toInt &#125;</span><br><span class="line">        tickets &lt;- <span class="type">Try</span> &#123; numberOfSpeedingTickets.toInt &#125;</span><br><span class="line">    &#125; <span class="keyword">yield</span> insuranceRateQuote(a, tickets)</span><br></pre></td></tr></table></figure>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span>(<span class="params">name: <span class="type">Name</span>, age: <span class="type">Age</span></span>)</span></span><br><span class="line"><span class="class"><span class="title">sealed</span> <span class="title">class</span> <span class="title">Name</span>(<span class="params">val value: <span class="type">String</span></span>)</span></span><br><span class="line"><span class="class"><span class="title">sealed</span> <span class="title">class</span> <span class="title">Age</span>(<span class="params">val value: <span class="type">Int</span></span>)</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">def</span> <span class="title">mkName</span>(<span class="params">name: <span class="type">String</span></span>)</span>: <span class="type">Either</span>[<span class="type">String</span>, <span class="type">Name</span>] = </span><br><span class="line">  <span class="keyword">if</span> (name == <span class="string">""</span> || name == <span class="literal">null</span>) <span class="type">Left</span>(<span class="string">"Name is empty."</span>)</span><br><span class="line">  <span class="keyword">else</span> <span class="type">Right</span>(<span class="keyword">new</span> <span class="type">Name</span>(name))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mkAge</span></span>(age: <span class="type">Int</span>): <span class="type">Either</span>[<span class="type">String</span>, <span class="type">Age</span>] = </span><br><span class="line">  <span class="keyword">if</span> (age &lt; <span class="number">0</span>) <span class="type">Left</span>(<span class="string">"Age is out of range."</span>)</span><br><span class="line">  <span class="keyword">else</span> <span class="type">Right</span>(<span class="keyword">new</span> <span class="type">Age</span>(age))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mkPerson</span></span>(name: <span class="type">String</span>, age: <span class="type">Int</span>): <span class="type">Either</span>[<span class="type">String</span>, <span class="type">Person</span>] = </span><br><span class="line">  mkName(name).map2(mkAge(age))(<span class="type">Person</span>(_, _))</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      
      
      <div>
        <ul class="post-copyright">
          <li class="post-copyright-author">
          <strong>Post author:  </strong>Icednut
          </li>
          <li class="post-copyright-link">
          <strong>Post link:  </strong>
          <a href="/2018/12/10/20181210-scala-and-functional-programming-day03/" target="_blank" title="스칼라 스터디 Day03 - 예외를 이용하지 않은 오류 처리">http://icednut.github.io/2018/12/10/20181210-scala-and-functional-programming-day03/</a>
          </li>
          <li class="post-copyright-license">
            <strong>Copyright Notice:   </strong>
            All articles in this blog are licensed under <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">CC BY-NC-ND 4.0</a>
            unless stating additionally.
          </li>
         
        </ul>
<div>
</div></div>
      
      
        
	<section id="comments" class="comment">
	  <div id="disqus_thread">
	  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
	  </div>
	</section>

	<script type="text/javascript">
	var disqus_shortname = 'icednut';
	(function(){
	  var dsq = document.createElement('script');
	  dsq.type = 'text/javascript';
	  dsq.async = true;
	  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	}());
	(function(){
	  var dsq = document.createElement('script');
	  dsq.type = 'text/javascript';
	  dsq.async = true;
	  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
	  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	}());
	</script>



      
      

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/12/17/20181218-scala-and-functional-programming-day04/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          스칼라 스터디 Day04 - 엄격성과 나태성
        
      </div>
    </a>
  
  
    <a href="/2018/12/04/20181204-scala-and-functional-programming-day02/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">스칼라 스터디 Day02 - 함수적 자료구조</div>
    </a>
  
</nav>

  
</article>

<!-- Table of Contents -->

</section>
        
      </div>
      
      <footer id="footer">
  

  <div class="container">
      	<div class="row">
	      <p> Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/iTimeTraveler/hexo-theme-hiker" target="_blank">Hexo-theme-hiker</a> </p>
	      <p id="copyRightEn">Copyright &copy; 2013 - 2018 Icednut&#39;s Note All Rights Reserved.</p>
	      
	      
  		   	<p id="copyRightCn">Icednut hold copyright</p>
  		   
		</div>

		
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");
    var allheader = document.getElementById("allheader");

    wrapdiv.style.minHeight = document.body.offsetHeight + "px";
    if (allheader != null) {
      contentdiv.style.minHeight = document.body.offsetHeight - allheader.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    } else {
      contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    }
</script>
    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/categories" class="mobile-nav-link">Categories</a>
  
    <a href="/tags" class="mobile-nav-link">Tags</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav> -->
    

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/scripts.js"></script>


  <script src="/js/home.js"></script>



  <script src="/js/dialog.js"></script>



<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-91631073-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->












  </div>

  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="myModalLabel">设置</h2>
      </div>
      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">


      <div class="modal-body">
          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" onclick="javascript:setFontSize();" aria-expanded="true" aria-controls="collapseOne">
              正文字号大小
            </a>
          </div>
          <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
          <div class="panel-body">
            您已调整页面字体大小
          </div>
        </div>
      


          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" onclick="javascript:setBackground();" aria-expanded="true" aria-controls="collapseTwo">
              夜间护眼模式
            </a>
        </div>
          <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
          <div class="panel-body">
            夜间模式已经开启，再次单击按钮即可关闭 
          </div>
        </div>

        <div>
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="true" aria-controls="collapseThree">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;关 于&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
        </div>
         <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
          <div class="panel-body">
            Icednut&#39;s Note
          </div>
          <div class="panel-body">
            Copyright © 2018 Icednut All Rights Reserved.
          </div>
        </div>
      </div>


      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <div class="modal-footer">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
      </div>
    </div>
  </div>
</div>
  
  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
  
</body>
</html>