<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>to-do app 개발을 통한 composite pattern 이해하기 (javascript, java 버전) | Icednut&#39;s Note</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="keywords" content="design patterncomposite pattern">
  
  
  
  
  <meta name="description" content="다룰 내용 디자인 패턴 중에 Composite Pattern에 대해 정리 Composite Pattern을 Javascript 버전, Java 버전으로 각각 작성 To-do 앱을 개발한다고 가정하고 해당 패턴을 적용 화면(HTML, CSS)개발은 생략하고 실행코드와 비즈니스 코드만 다룰 예정  들어가기 전에 Composite Pattern은 뭘까? 한 마디">
<meta name="keywords" content="design pattern,composite pattern">
<meta property="og:type" content="article">
<meta property="og:title" content="To-Do App 개발을 통한 Composite Pattern 이해하기 (javascript, java 버전)">
<meta property="og:url" content="http://icednut.github.io/2018/03/27/20180327-understanding-composite-pattern/index.html">
<meta property="og:site_name" content="Icednut&#39;s Note">
<meta property="og:description" content="다룰 내용 디자인 패턴 중에 Composite Pattern에 대해 정리 Composite Pattern을 Javascript 버전, Java 버전으로 각각 작성 To-do 앱을 개발한다고 가정하고 해당 패턴을 적용 화면(HTML, CSS)개발은 생략하고 실행코드와 비즈니스 코드만 다룰 예정  들어가기 전에 Composite Pattern은 뭘까? 한 마디">
<meta property="og:locale" content="Korean">
<meta property="og:image" content="http://icednut.github.io/images/20180327-understanding-composite-pattern/todo.png">
<meta property="og:image" content="http://icednut.github.io/images/20180327-understanding-composite-pattern/step_2_class_diagram.png">
<meta property="og:image" content="http://icednut.github.io/images/20180327-understanding-composite-pattern/todo2.png">
<meta property="og:image" content="http://icednut.github.io/images/20180327-understanding-composite-pattern/step_3_class_diagram.png">
<meta property="og:image" content="http://icednut.github.io/images/20180327-understanding-composite-pattern/step_4_class_diagram.png">
<meta property="og:image" content="http://icednut.github.io/images/20180327-understanding-composite-pattern/sequence_diagram.png">
<meta property="og:updated_time" content="2018-11-27T06:40:43.287Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="To-Do App 개발을 통한 Composite Pattern 이해하기 (javascript, java 버전)">
<meta name="twitter:description" content="다룰 내용 디자인 패턴 중에 Composite Pattern에 대해 정리 Composite Pattern을 Javascript 버전, Java 버전으로 각각 작성 To-do 앱을 개발한다고 가정하고 해당 패턴을 적용 화면(HTML, CSS)개발은 생략하고 실행코드와 비즈니스 코드만 다룰 예정  들어가기 전에 Composite Pattern은 뭘까? 한 마디">
<meta name="twitter:image" content="http://icednut.github.io/images/20180327-understanding-composite-pattern/todo.png">
  
    <link rel="alternate" href="/atom.xml" title="Icednut&#39;s Note" type="application/atom+xml">
  

  

  <link rel="icon" href="/css/images/mylogo.jpg">
  <link rel="apple-touch-icon" href="/css/images/mylogo.jpg">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
  <link rel="stylesheet" href="/css/style.css">

  <script src="/js/jquery-3.1.1.min.js"></script>
  <script src="/js/bootstrap.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css">

  
    <link rel="stylesheet" href="/css/dialog.css">
  

  

  
    <link rel="stylesheet" href="/css/header-post.css">
  

  
  
  

<link rel="stylesheet" href="/css/prism-coy.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>
</html>


  <body data-spy="scroll" data-target="#toc" data-offset="50">


  
  <div id="container">
    <div id="wrap">
      
        <header>

    <div id="allheader" class="navbar navbar-default navbar-static-top" role="navigation">
        <div class="navbar-inner">
          
          <div class="container"> 
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>

            
              <a class="brand" style="border-width: 0;">
                <p>Icednut&#39;s Note</p>
              </a>
            
            
            <div class="navbar-collapse collapse">
              <ul class="hnav navbar-nav">
                
                  <li> <a class="main-nav-link" href="/">Home</a> </li>
                
                  <li> <a class="main-nav-link" href="/archives">Archives</a> </li>
                
                  <li> <a class="main-nav-link" href="/categories">Categories</a> </li>
                
                  <li> <a class="main-nav-link" href="/tags">Tags</a> </li>
                
                  <li> <a class="main-nav-link" href="/about">About</a> </li>
                
                  <li><div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="">
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something...">
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div></li>
            </ul></div>
          </div>
                
      </div>
    </div>

</header>



      
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;"><article id="post-20180327-understanding-composite-pattern" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      To-Do App 개발을 통한 Composite Pattern 이해하기 (javascript, java 버전)
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2018/03/27/20180327-understanding-composite-pattern/" class="article-date">
	  <time datetime="2018-03-27T07:10:53.000Z" itemprop="datePublished">2018-03-27</time>
	</a>

      
      
      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="다룰-내용"><a href="#다룰-내용" class="headerlink" title="다룰 내용"></a>다룰 내용</h2><ul>
<li>디자인 패턴 중에 Composite Pattern에 대해 정리</li>
<li>Composite Pattern을 Javascript 버전, Java 버전으로 각각 작성</li>
<li>To-do 앱을 개발한다고 가정하고 해당 패턴을 적용</li>
<li>화면(HTML, CSS)개발은 생략하고 실행코드와 비즈니스 코드만 다룰 예정</li>
</ul>
<p>들어가기 전에 Composite Pattern은 뭘까? 한 마디로 정의하자면 Tree 메뉴와 같이 재귀호출하여 처리하는 행위를 추상화한 것을 Composite Pattern이라고 한다. 뭔말인지 모르겠으니까 To-Do App을 구현하면서 알아보자.</p>
<h2 id="To-Do-Domain"><a href="#To-Do-Domain" class="headerlink" title="To-Do Domain"></a>To-Do Domain</h2><p>우선 To-Do App이 뭔지 알아보자. (이것을 To-Do App의 Domain을 알아보자 라고 한다.)</p>
<p>TODO 앱은 일단 다음과 같다.</p>
<p><img src="/images/20180327-understanding-composite-pattern/todo.png"></p>
<p>그림을 보면 왼쪽에 뭔가 분류 항목(리스트)가 있고, 오른쪽에는 할 일 항목이 있는 것을 볼 수 있다. 이렇게 화면을 보고 데이터가 어떻게 되어 있을지를 상상해봐야 하는데 이걸 도메인 훈련이라고 부르며 상당한 노력과 경험이 필요하다. (도메인을 보고 완벽하게 데이터로 환원시킬 수 있어야 한다.)</p>
<p>도메인 파악에는 여러 방법론이 있지만 데이터베이스를 바탕으로 도메인을 파악할 경우 그 도메인에서 행위를 명사로 표현할 수 있는 것과 동사로 표현할 수 있는 것으로 나뉜다. 여기서 명사는 엔티티(Entity)라고 부르고 동사는 행동(Behavior)라고 부른다.</p>
<p>엔티티라고 부르는 것은 데이터와 연관이 있다. 위 그림 To-Do App 도메인에서 엔티티는 무엇일까? 일단 왼쪽이나 오른쪽 둘다 공통적으로 보여지는 리스트 엔티티가 있을 것이고, 할 일 항목 하나하나가 엔티티가 보인다. 결국 TaskList와 TaskItem으로 엔티티를 표현할 수 있다. (데이터베이스에서는 이 엔티티가 테이블이 되겠지만 객체지향 세계에서는 클래스가 되고 인스턴스가 된다.)</p>
<h2 id="Step1-실행코드-작성하기"><a href="#Step1-실행코드-작성하기" class="headerlink" title="Step1. 실행코드 작성하기"></a>Step1. 실행코드 작성하기</h2><p>To-Do App의 도메인을 알아봤으니 실행 코드를 작성해보자. 실행 코드를 작성하자는 말은 To-Do App을 실행시키는 코드를 작성한다는 의미이다.</p>
<blockquote>
<p>왜 실행코드부터 작성할까?</p>
<p>코드는 사람이 사용하기 편한 방향으로 개발해야되는데 실행 코드를 먼저 작성해보면 사용자 측면에서 개발하게 된다. 이렇게 실행하는 코드가 있으면 좋을텐데라고 생각하고 실행코드 부터 작성하면 사용자 측면에서 생각하여 개발하게 된다는 의미이다. 실행코드 말고 프로덕션 코드부터 만드는 것은 똥을 만들 가능성이 커진다.</p>
</blockquote>
<h5 id="Javascript-버전-app-js"><a href="#Javascript-버전-app-js" class="headerlink" title="Javascript 버전 - app.js"></a>Javascript 버전 - app.js</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> list1 = <span class="keyword">new</span> TaskList(<span class="string">'비사이드'</span>);</span><br><span class="line">list1.add(<span class="string">'지라설치'</span>);</span><br><span class="line">list1.add(<span class="string">'지라클라우드접속'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> list2 = <span class="keyword">new</span> TaskList(<span class="string">'s75'</span>);</span><br><span class="line">list2.add(<span class="string">'2강 답안 작성'</span>);</span><br><span class="line">list2.add(<span class="string">'3강 교안 작성'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(list1.byTitle());</span><br><span class="line"><span class="built_in">console</span>.log(list2.byDate());</span><br></pre></td></tr></table></figure>
<h5 id="Java-버전-Application-java"><a href="#Java-버전-Application-java" class="headerlink" title="Java 버전 - Application.java"></a>Java 버전 - Application.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        TaskList list1 = <span class="keyword">new</span> TaskList(<span class="string">"비사이드"</span>);</span><br><span class="line">        list1.add(<span class="string">"지라설치"</span>);</span><br><span class="line">        list1.add(<span class="string">"지라클라우드 접속"</span>);</span><br><span class="line">        </span><br><span class="line">        TaskList list2 = <span class="keyword">new</span> TaskList(<span class="string">"s75"</span>);</span><br><span class="line">        list2.add(<span class="string">"2강 답안 작성"</span>);</span><br><span class="line">        list2.add(<span class="string">"3강 교안 작성"</span>);</span><br><span class="line">        </span><br><span class="line">        System.out.println(list1.byTitle(<span class="keyword">false</span>));</span><br><span class="line">        System.out.println(list2.byDate(<span class="keyword">false</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>작성한 실행코드를 보면서 생각해보자. TaskList 인스턴스를 만들면서 파라미터로 항목의 이름을 넘겼는데 그럼 작성일시는 안넘겨도 될까? 아마 내부적으로 현재 시간으로 셋팅하는게 들어가겠지? 하고 혼자 생각해보면서 실행코드에 뭔가 누락된 부분이 있는지 검토해본다.</p>
<p>TaskList의 할일(Task)를 등록하는 함수의 이름을 add라고 지었는데 왜 이렇게 지었을까?</p>
<p>코드 작성에서 작명은 상향식과 하향식이 있는데 상향식은 의미를 넓게 지은뒤 리팩토링하면서 점점 구체적인 의미로 짓는 것이며, 하향식은 그 반대이다. 상향식으로 지어놓으면 추후 추가되는 요구사항에 대한 의미에 유연하게 대응할 수 있으므로 상향식으로 짓는 것이 좋다. (그래서 일단 넓은 의미로 add라고 이름을 지은 것)</p>
<h2 id="Step-2-할-일-등록-및-조회-개발"><a href="#Step-2-할-일-등록-및-조회-개발" class="headerlink" title="Step 2. 할 일 등록 및 조회 개발"></a>Step 2. 할 일 등록 및 조회 개발</h2><p>그 다음 할 일을 나타내는 Task 클래스를 먼저 작성하는게 좋을까? 아니면 할 일을 관리하는 TaskList 클래스를 작성하는게 좋을까? 여기서 둘의 관계를 고찰해보면 할일 목록(TaskList)은 할일(Task)을 담고 있기 때문에 TaskList는 Task에 의존성이 있다고 볼 수 있다. 의존성이 없는 엔티티부터 구체화하는 것이 편한데 여기서는 Task가 의존성이 없기 때문에 Task 클래스 부터 작성하는 것이 편하다. 이렇게 도메인만 보고 엔티티의 의존성을 파악하려면 경험이 필요하다. (으…난 솔직히 TaskList 부터 작성하려고 생각하고 있었는데…)</p>
<p>그럼 Task 클래스부터 작성해보자. (할일 제목과 등록 날짜 기준으로 정렬도 할 수 있게 해보자.)</p>
<h5 id="task-js"><a href="#task-js" class="headerlink" title="task.js"></a>task.js</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Task = <span class="class"><span class="keyword">class</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(title, date)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!title) <span class="keyword">throw</span> <span class="string">'invalid title'</span>;</span><br><span class="line">        <span class="keyword">this</span>._title = title;</span><br><span class="line">        <span class="keyword">this</span>._date = date;</span><br><span class="line">        <span class="keyword">this</span>._isComplete = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    isComplete()&#123;<span class="keyword">return</span> <span class="keyword">this</span>._isComplete;&#125;</span><br><span class="line">    toggle()&#123;<span class="keyword">this</span>._isComplete = !<span class="keyword">this</span>._isComplete;&#125;</span><br><span class="line">    sortTitle(task)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>._title &gt; task._title;</span><br><span class="line">    &#125;</span><br><span class="line">    sortDate(task)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>._date &gt; task._date;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> taskSort = &#123;</span><br><span class="line">    title:<span class="function">(<span class="params">a, b</span>)=&gt;</span>a.sortTitle(b),</span><br><span class="line">    date:<span class="function">(<span class="params">a, b</span>)=&gt;</span>a.sortDate(b)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Task-java"><a href="#Task-java" class="headerlink" title="Task.java"></a>Task.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Task</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime date;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isComplete;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Task</span><span class="params">(String title, LocalDateTime date)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.title = Optional.ofNullable(title).orElseThrow(() -&gt; <span class="keyword">new</span> InvalidTitleException());</span><br><span class="line">        <span class="keyword">this</span>.date = date;</span><br><span class="line">        <span class="keyword">this</span>.isComplete = <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isComplete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.isComplete;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">toggle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.isComplete = !<span class="keyword">this</span>.isComplete;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">sortTitle</span><span class="params">(Task task)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.title.compareTo(task.title);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">sortDate</span><span class="params">(Task task)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.date.compareTo(task.date);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TaskSort</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Comparator&lt;Task&gt;&gt; sortMethods;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TaskSort</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sortMethods = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        sortMethods.put(<span class="string">"title"</span>, (a, b) -&gt; a.sortTitle(b));</span><br><span class="line">        sortMethods.put(<span class="string">"date"</span>, (a, b) -&gt; a.sortDate(b));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Comparator&lt;Task&gt; <span class="title">getSortMethod</span><span class="params">(String sortType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sortMethods.get(sortType);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Task 클래스를 살펴보면 할일을 완료했는지 여부에 대한 _isComplete라는 필드도 보이고 이걸 toggle() 함수를 통해 값을 변경하는 것을 볼 수 있다. 이렇게 Task의 완료를 toggle() 함수를 통해 제어(_isComplete의 값을 변경)하는 것을 캡슐화라고 한다. 또 다른 캡슐화로는 TaskSort가 있는데 여기에는 Task 제목(title)로 정렬할 것인지, 등록일시(date)로 정렬할 것인지에 대한 행위만 들어있다. 그 구체적인 행위는 Task에게 위임하고 TaskSort의 title과 date 필드의 value는 뭘 기준으로 정렬하는 것인지에 대한 행위만 들어있다. Task에 위임된 sortTitle과 sortDate 함수를 보면 정렬에 필요한 정렬 비교 기준 로직이 들어있다. 이렇게 정렬에 대한 핵심 로직은 감춰진채 Task에서는 정렬에 관한 인터페이스(함수)만 노출한 것도 캡슐화라고 할 수 있다.</p>
<p>이제 할 일 목록(TaskList)를 작성해보자. Task에서 준비한 할일 제목(title), 등록날짜(date)에 대한 정렬을 실행할 수 있는 인터페이스를 TaskList에서 제공한다. title과 date에 따라 소팅하는 로직을 태스크가 갖고 있는 것은 객체지행에 위배되기 때문이다. 그러므로 TaskList에서 제공한 정렬 관련 함수는 Task에게 정렬에 대한 핵심 로직을 위임하여 TaskList는 실행만 하게 한다.</p>
<h5 id="task-list-js"><a href="#task-list-js" class="headerlink" title="task_list.js"></a>task_list.js</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> TaskList = <span class="class"><span class="keyword">class</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(title)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!title) <span class="keyword">throw</span> <span class="string">'invalid title'</span>;</span><br><span class="line">        <span class="keyword">this</span>._title = title;</span><br><span class="line">        <span class="keyword">this</span>._list = [];</span><br><span class="line">    &#125;</span><br><span class="line">    add(title, date = <span class="built_in">Date</span>.now())&#123;<span class="keyword">this</span>._list.push(<span class="keyword">new</span> Task(title, date));&#125;</span><br><span class="line">    remove(task)&#123;</span><br><span class="line">        <span class="keyword">const</span> list = <span class="keyword">this</span>._list;</span><br><span class="line">        <span class="keyword">if</span>(list.include(task)) list.splice(list.indexOf(task), <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    byTitle(stateGroup = <span class="literal">true</span>)&#123;<span class="keyword">return</span> <span class="keyword">this</span>._getResult(<span class="string">'title'</span>, stateGroup);&#125;</span><br><span class="line">    byDate(stateGroup = <span class="literal">true</span>)&#123;<span class="keyword">return</span> <span class="keyword">this</span>._getResult(<span class="string">'date'</span>, stateGroup);&#125;</span><br><span class="line">    _getResult(sort, stateGroup)&#123;</span><br><span class="line">        <span class="keyword">const</span> list = <span class="keyword">this</span>._list, s = taskSort[sort];</span><br><span class="line">        <span class="keyword">return</span> !stateGroup ? [...list].sort(s) : [</span><br><span class="line">            ...list.filter(<span class="function"><span class="params">v</span>=&gt;</span>!v.isComplete()).sort(s),</span><br><span class="line">            ...list.filter(<span class="function"><span class="params">v</span>=&gt;</span>v.isComplete()).sort(s)</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="TaskList-java"><a href="#TaskList-java" class="headerlink" title="TaskList.java"></a>TaskList.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TaskList</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Task&gt; list;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TaskList</span><span class="params">(String title, List&lt;Task&gt; list)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.title = title;</span><br><span class="line">        <span class="keyword">this</span>.list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(String title, LocalDateTime date)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.list.add(<span class="keyword">new</span> Task(title, date));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(String title)</span> </span>&#123;</span><br><span class="line">        add(title, LocalDateTime.now());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(Task task)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (list.contains(task)) &#123;</span><br><span class="line">            list.remove(task);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Task&gt; <span class="title">byTitle</span><span class="params">(<span class="keyword">boolean</span> stateGroup)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.getResult(<span class="string">"title"</span>, stateGroup);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Task&gt; <span class="title">byDate</span><span class="params">(<span class="keyword">boolean</span> stateGroup)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.getResult(<span class="string">"date"</span>, stateGroup);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> List&lt;Task&gt; <span class="title">getResult</span><span class="params">(String sortType, <span class="keyword">boolean</span> stateGroup)</span> </span>&#123;</span><br><span class="line">        TaskSort taskSort = <span class="keyword">new</span> TaskSort();</span><br><span class="line">        Comparator&lt;Task&gt; sortMethod = taskSort.getSortMethod(sortType);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> !stateGroup ?</span><br><span class="line">                list.stream().sorted(sortMethod).collect(Collectors.toList()) :</span><br><span class="line">                <span class="keyword">new</span> ArrayList&lt;&gt;() &#123;&#123;</span><br><span class="line">                    <span class="keyword">this</span>.addAll(list.stream().filter(v -&gt; !v.isComplete()).sorted(sortMethod).collect(Collectors.toList()));</span><br><span class="line">                    <span class="keyword">this</span>.addAll(list.stream().filter(v -&gt; v.isComplete()).sorted(sortMethod).collect(Collectors.toList()));</span><br><span class="line">                &#125;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Step-2-Class-Diagram"><a href="#Step-2-Class-Diagram" class="headerlink" title="Step 2. Class Diagram"></a>Step 2. Class Diagram</h3><p style="text-align: center;"><img src="/images/20180327-understanding-composite-pattern/step_2_class_diagram.png"></p>

<h3 id="Step-2-결과물"><a href="#Step-2-결과물" class="headerlink" title="Step 2. 결과물"></a>Step 2. 결과물</h3><h5 id="javascript"><a href="#javascript" class="headerlink" title="javascript"></a>javascript</h5><ul>
<li><a href="https://github.com/icednut/design-pattern-study/tree/master/composite_pattern/javascript/step_02" target="_blank" rel="noopener">https://github.com/icednut/design-pattern-study/tree/master/composite_pattern/javascript/step_02</a></li>
</ul>
<h5 id="java"><a href="#java" class="headerlink" title="java"></a>java</h5><ul>
<li><a href="https://github.com/icednut/design-pattern-study/tree/master/composite_pattern/java/step2" target="_blank" rel="noopener">https://github.com/icednut/design-pattern-study/tree/master/composite_pattern/java/step2</a></li>
</ul>
<h2 id="Step-3-태스크-하위로-태스크-달기-구현"><a href="#Step-3-태스크-하위로-태스크-달기-구현" class="headerlink" title="Step 3. 태스크 하위로 태스크 달기 구현"></a>Step 3. 태스크 하위로 태스크 달기 구현</h2><p><img src="/images/20180327-understanding-composite-pattern/todo2.png"></p>
<p>요구사항이 추가되어서 태스크 하위로 태스크 목록을 볼 수 있어야 한다고 하자. 뭐 일단 하위로 얼만큼 달리는지는 생각하지 말고 1단만 달린다고 해보자. 실행코드는 아마 다음과 같을 것이다.</p>
<h5 id="app-js"><a href="#app-js" class="headerlink" title="app.js"></a>app.js</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> list1 = <span class="keyword">new</span> TaskList(<span class="string">'비사이드'</span>);</span><br><span class="line">list1.add(<span class="string">'지라설치'</span>);</span><br><span class="line">list1.add(<span class="string">'지라클라우드 접속'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> list2 = <span class="keyword">new</span> TaskList(<span class="string">'s75'</span>);</span><br><span class="line">list2.add(<span class="string">'2강 답안 작성'</span>);</span><br><span class="line">list2.add(<span class="string">'3강 교안 작성'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> list = list2.byDate();</span><br><span class="line">list[<span class="number">1</span>].task.add(<span class="string">'코드 정리'</span>);</span><br><span class="line">list[<span class="number">1</span>].task.add(<span class="string">'다이어그램정리'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(list2.byDate()[<span class="number">1</span>].sub);</span><br></pre></td></tr></table></figure>
<h5 id="Application-java"><a href="#Application-java" class="headerlink" title="Application.java"></a>Application.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        TaskList list1 = <span class="keyword">new</span> TaskList(<span class="string">"비사이드"</span>);</span><br><span class="line">        list1.add(<span class="string">"지라설치"</span>);</span><br><span class="line">        list1.add(<span class="string">"지라클라우드 접속"</span>);</span><br><span class="line">        </span><br><span class="line">        TaskList list2 = <span class="keyword">new</span> TaskList(<span class="string">"s75"</span>);</span><br><span class="line">        list2.add(<span class="string">"2강 답안 작성"</span>);</span><br><span class="line">        list2.add(<span class="string">"3강 교안 작성"</span>);</span><br><span class="line">        </span><br><span class="line">        TaskList list = list2.byDate(<span class="keyword">false</span>);</span><br><span class="line">        list.get(<span class="number">1</span>).getTask().add(<span class="string">"코드 정리"</span>);</span><br><span class="line">        list.get(<span class="number">1</span>).getTask().add(<span class="string">"다이어그램정리"</span>);</span><br><span class="line">        </span><br><span class="line">        System.out.println(list2.byDate(<span class="keyword">false</span>).get(<span class="number">1</span>).sub);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>자, 앞에서 하던대로 Task 부터 고쳐보자. Task 밑에 Task 목록이 달려야 하니까 TaskList를 멤버로 갖고 있어야 할 것이다. 그러면 자연스레 TaskList에 관련된 로직이 Task에 들어가게 된다. 왜? TaskList에 항목을 추가하는 행위(add)나 Task 밑에 하위로 항목을 추가한 행위가 같기 때문이다.</p>
<h5 id="task-js-1"><a href="#task-js-1" class="headerlink" title="task.js"></a>task.js</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Task = <span class="class"><span class="keyword">class</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(title, date)&#123;</span><br><span class="line">       <span class="keyword">if</span>(!title) <span class="keyword">throw</span> <span class="string">'invalid title'</span>;</span><br><span class="line">       <span class="keyword">this</span>._title = title;</span><br><span class="line">       <span class="keyword">this</span>._date = date;</span><br><span class="line">       <span class="keyword">this</span>._isComplete = <span class="literal">false</span>;</span><br><span class="line">       <span class="keyword">this</span>._list = [];</span><br><span class="line">    &#125;</span><br><span class="line">    add(title, date = <span class="built_in">Date</span>.now())&#123;<span class="keyword">this</span>._list.push(<span class="keyword">new</span> Task(title, date));&#125;</span><br><span class="line">    remove(task)&#123;</span><br><span class="line">       <span class="keyword">const</span> list = <span class="keyword">this</span>._list;</span><br><span class="line">       <span class="keyword">if</span>(list.includes(task)) list.splice(list.indexOf(task), <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    _getResult(sort, stateGroup)&#123;</span><br><span class="line">       <span class="keyword">const</span> list = <span class="keyword">this</span>._list, s = taskSort[sort];</span><br><span class="line">       <span class="keyword">return</span> &#123;</span><br><span class="line">           task:<span class="keyword">this</span></span><br><span class="line">           sub:!stateGroup ? [...list].sort(s) : [</span><br><span class="line">              ...list.filter(<span class="function"><span class="params">v</span>=&gt;</span>!v.isComplete()).sort(s),</span><br><span class="line">              ...list.filter(<span class="function"><span class="params">v</span>=&gt;</span>v.isComplete()).sort(s)</span><br><span class="line">           ]</span><br><span class="line">       &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    isComplete()&#123;<span class="keyword">return</span> <span class="keyword">this</span>._isComplete;&#125;</span><br><span class="line">    toggle()&#123;<span class="keyword">this</span>._isComplete = !<span class="keyword">this</span>._isComplete;&#125;</span><br><span class="line">    sortTitle(task)&#123;<span class="keyword">return</span> <span class="keyword">this</span>._title &gt; task._title;&#125;</span><br><span class="line">    sortDate(task)&#123;<span class="keyword">return</span> <span class="keyword">this</span>._date &gt; task._date;&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h5 id="Task-java-1"><a href="#Task-java-1" class="headerlink" title="Task.java"></a>Task.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Task</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime date;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isComplete;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Task&gt; list;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Task</span><span class="params">(String title, LocalDateTime date)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.title = Optional.ofNullable(title).orElseThrow(() -&gt; <span class="keyword">new</span> InvalidTitleException());</span><br><span class="line">        <span class="keyword">this</span>.date = date;</span><br><span class="line">        <span class="keyword">this</span>.isComplete = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">this</span>.list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(String title, LocalDateTime date)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.list.add(<span class="keyword">new</span> Task(title, date));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(String title)</span> </span>&#123;</span><br><span class="line">        add(title, LocalDateTime.now());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(Task task)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (list.contains(task)) &#123;</span><br><span class="line">            list.remove(task);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> TaskWrapper <span class="title">getResult</span><span class="params">(String sortType, <span class="keyword">boolean</span> stateGroup)</span> </span>&#123;</span><br><span class="line">        TaskSort taskSort = <span class="keyword">new</span> TaskSort();</span><br><span class="line">        Comparator&lt;Task&gt; sortMethod = taskSort.getSortMethod(sortType);</span><br><span class="line"></span><br><span class="line">        List&lt;Task&gt; sub = !stateGroup ?</span><br><span class="line">                list.stream().sorted(sortMethod).collect(Collectors.toList()) :</span><br><span class="line">                <span class="keyword">new</span> ArrayList&lt;&gt;() &#123;&#123;</span><br><span class="line">                    addAll(list.stream().filter(v -&gt; !v.isComplete()).sorted(sortMethod).collect(Collectors.toList()));</span><br><span class="line">                    addAll(list.stream().filter(v -&gt; v.isComplete()).sorted(sortMethod).collect(Collectors.toList()));</span><br><span class="line">                &#125;&#125;;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> TaskWrapper(<span class="keyword">this</span>, sub);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isComplete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.isComplete;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">toggle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.isComplete = !<span class="keyword">this</span>.isComplete;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">sortTitle</span><span class="params">(Task task)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.title.compareTo(task.title);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">sortDate</span><span class="params">(Task task)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.date.compareTo(task.date);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">TaskWrapper</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Task task;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> List&lt;Task&gt; sub;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">TaskWrapper</span><span class="params">(Task task, List&lt;Task&gt; sub)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.task = task;</span><br><span class="line">            <span class="keyword">this</span>.sub = sub;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Task <span class="title">getTask</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> task;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> List&lt;Task&gt; <span class="title">getSub</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> sub;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TaskSort</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Comparator&lt;Task&gt;&gt; sortMethods;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TaskSort</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sortMethods = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        sortMethods.put(<span class="string">"title"</span>, (a, b) -&gt; a.sortTitle(b));</span><br><span class="line">        sortMethods.put(<span class="string">"date"</span>, (a, b) -&gt; a.sortDate(b));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Comparator&lt;Task&gt; <span class="title">getSortMethod</span><span class="params">(String sortType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sortMethods.get(sortType);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Task 클래스에 add(), remove(), _getResult()가 추가된 것을 볼 수가 있는데 이는 TaskList에 있던 코드와 동일하다. 그럼 이제 TaskList 클래스를 정리해보자. 어떻게? TaskList에서 할일 목록을 가져오는 함수인 _getResult() 함수를 호출 할 때 이제 Task의 _getResult() 함수도 호출해서 Task에 소속된 Task 목록을 가져오면 되는 것이다. TaskList 클래스는 하위 항목이 달린 Task를 어떻게 표현할지에 대한 로직은 관심이 없게 한다. 그건 Task에게 위임하고 Task의 _getResult 함수만 호출하면 하위가 달린 Task는 하위를 알아서 구성하게 하여 캡슐화 한다. 이걸 TaskList와 Task의 내부거래라고 한다. 왜 내부거래인가? 실행코드에서는 이런 TaskList와 Task의 항목 구성 방법을 알지 못한다. 그저 내부적으로 TaskList 그리고 Task만 알고 그에 대한 처리를 할 뿐이다. 그래서 내부거래라고 한다.</p>
<p>이걸 코드로 풀어보자.</p>
<h5 id="task-list-js-1"><a href="#task-list-js-1" class="headerlink" title="task_list.js"></a>task_list.js</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> TaskList = <span class="class"><span class="keyword">class</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(title)&#123;</span><br><span class="line">       <span class="keyword">if</span>(!title) <span class="keyword">throw</span> <span class="string">'invalid title'</span>;</span><br><span class="line">       <span class="keyword">this</span>._title = title;</span><br><span class="line">       <span class="keyword">this</span>._list = [];</span><br><span class="line">    &#125;</span><br><span class="line">    add(title, date = <span class="built_in">Date</span>.now())&#123;<span class="keyword">this</span>._list.push(<span class="keyword">new</span> Task(title, date));&#125;</span><br><span class="line">    remove(task)&#123;</span><br><span class="line">        <span class="keyword">const</span> list = <span class="keyword">this</span>._list;</span><br><span class="line">        <span class="keyword">if</span>(list.includes(task)) list.splice(list.indexOf(task), <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    byTitle(stateGroup = <span class="literal">true</span>)&#123;<span class="keyword">return</span> <span class="keyword">this</span>._getResult(<span class="string">'title'</span>, stateGroup);&#125;</span><br><span class="line">    byDate(stateGroup = <span class="literal">true</span>)&#123;<span class="keyword">return</span> <span class="keyword">this</span>._getResult(<span class="string">'date'</span>, stateGroup);&#125;</span><br><span class="line">    _getResult(sort, stateGroup)&#123;</span><br><span class="line">        <span class="keyword">const</span> list = <span class="keyword">this</span>._list, s = taskSort[sort];</span><br><span class="line">        <span class="keyword">return</span> (!stateGroup ? [...list].sort(s) : [</span><br><span class="line">            ...list.filter(<span class="function"><span class="params">v</span>=&gt;</span>!v.isComplete()).sort(s),</span><br><span class="line">            ...list.filter(<span class="function"><span class="params">v</span>=&gt;</span>v.isComplete()).sort(s)</span><br><span class="line">        ]).map(<span class="function"><span class="params">v</span>=&gt;</span>v._getResult());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h5 id="TaskList-java-1"><a href="#TaskList-java-1" class="headerlink" title="TaskList.java"></a>TaskList.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TaskList</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Task&gt; list;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TaskList</span><span class="params">(String title)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.title = title;</span><br><span class="line">        <span class="keyword">this</span>.list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(String title, LocalDateTime date)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.list.add(<span class="keyword">new</span> Task(title, date));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(String title)</span> </span>&#123;</span><br><span class="line">        add(title, LocalDateTime.now());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(Task task)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (list.contains(task)) &#123;</span><br><span class="line">            list.remove(task);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;Task.TaskWrapper&gt; byTitle(<span class="keyword">boolean</span> stateGroup) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.getResult(<span class="string">"title"</span>, stateGroup);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;Task.TaskWrapper&gt; byDate(<span class="keyword">boolean</span> stateGroup) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.getResult(<span class="string">"date"</span>, stateGroup);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;Task.TaskWrapper&gt; getResult(String sort, <span class="keyword">boolean</span> stateGroup) &#123;</span><br><span class="line">        TaskSort taskSort = <span class="keyword">new</span> TaskSort();</span><br><span class="line">        Comparator&lt;Task&gt; sortMethod = taskSort.getSortMethod(sort);</span><br><span class="line"></span><br><span class="line">        List&lt;Task&gt; tasks = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        tasks.addAll(list.stream().filter(v -&gt; !v.isComplete()).sorted(sortMethod).collect(Collectors.toList()));</span><br><span class="line">        tasks.addAll(list.stream().filter(v -&gt; v.isComplete()).sorted(sortMethod).collect(Collectors.toList()));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> !stateGroup ?</span><br><span class="line">                list.stream().sorted(sortMethod).map((Task v) -&gt; v.getResult(sort, stateGroup)).collect(Collectors.toList()) :</span><br><span class="line">                tasks.stream().map((Task v1) -&gt; v1.getResult(sort, stateGroup)).collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>TaskList를 보면 .map(v=&gt;v._getResult()); 라는 코드가 추가된 것을 볼 수가 있는데 이는 _getResult() 함수를 Task 클래스의 것을 호출하겠다는 의미이다. 이렇게 하위 목록을 가져오는 코드가 Task에게 위임된 것을 볼 수 있다.</p>
<h3 id="Step-3-Class-Diagram"><a href="#Step-3-Class-Diagram" class="headerlink" title="Step 3. Class Diagram"></a>Step 3. Class Diagram</h3><p style="text-align: center;"><img src="/images/20180327-understanding-composite-pattern/step_3_class_diagram.png"></p>

<h3 id="Step-3-결과물"><a href="#Step-3-결과물" class="headerlink" title="Step 3. 결과물"></a>Step 3. 결과물</h3><h5 id="javascript-1"><a href="#javascript-1" class="headerlink" title="javascript"></a>javascript</h5><ul>
<li><a href="https://github.com/icednut/design-pattern-study/tree/master/composite_pattern/javascript/step_03" target="_blank" rel="noopener">https://github.com/icednut/design-pattern-study/tree/master/composite_pattern/javascript/step_03</a></li>
</ul>
<h5 id="java-1"><a href="#java-1" class="headerlink" title="java"></a>java</h5><ul>
<li><a href="https://github.com/icednut/design-pattern-study/tree/master/composite_pattern/java/step3" target="_blank" rel="noopener">https://github.com/icednut/design-pattern-study/tree/master/composite_pattern/java/step3</a></li>
</ul>
<h2 id="Step-4-하위-태스크를-무한대로-추가-Composite-Pattern-등장"><a href="#Step-4-하위-태스크를-무한대로-추가-Composite-Pattern-등장" class="headerlink" title="Step 4. 하위 태스크를 무한대로 추가 (Composite Pattern 등장)"></a>Step 4. 하위 태스크를 무한대로 추가 (Composite Pattern 등장)</h2><p>앞에 코드대로라면 태스크 하위는 1단까지만 가능하다. 그런데 태스크 하위로 또 태스크가 달리고 그렇게 달린 태스크에 또 하위로 태스크가 달리게 하고 계속 태스크를 하위에 추가할 수 있게 하려면 어떻게 해야될까? 이 때 Compostie Pattern이 등장하게 된다. Composite Pattern은 이렇게 반복되는 처리에 대한 비지니스 로직을 처리할 때 빛을 발한다. 마찬가지로 실행코드부터 작성해보자.</p>
<h5 id="app-js-1"><a href="#app-js-1" class="headerlink" title="app.js"></a>app.js</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> list1 = <span class="keyword">new</span> TaskList(<span class="string">'s75'</span>);</span><br><span class="line"><span class="keyword">const</span> item1 = <span class="keyword">new</span> TaskItem(<span class="string">"3강교안작성"</span>);</span><br><span class="line">list1.add(item1);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sub1 = <span class="keyword">new</span> TaskItem(<span class="string">"코드정리"</span>);</span><br><span class="line">item1.add(sub1);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> subsub1 = <span class="keyword">new</span> TaskItem(<span class="string">"subsub1"</span>);</span><br><span class="line">sub1.add(subsub1);</span><br><span class="line"></span><br><span class="line">list1.getResult(Task.title);</span><br></pre></td></tr></table></figure>
<h5 id="Application-java-1"><a href="#Application-java-1" class="headerlink" title="Application.java"></a>Application.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        TaskList list1 = <span class="keyword">new</span> TaskList(<span class="string">"s75"</span>);</span><br><span class="line">        TaskItem item1 = <span class="keyword">new</span> TaskItem(<span class="string">"3강교안작성"</span>, <span class="keyword">null</span>);</span><br><span class="line">        list1.add(item1);</span><br><span class="line"></span><br><span class="line">        TaskItem sub1 = <span class="keyword">new</span> TaskItem(<span class="string">"코드정리"</span>, <span class="keyword">null</span>);</span><br><span class="line">        item1.add(sub1);</span><br><span class="line"></span><br><span class="line">        TaskItem subsub1 = <span class="keyword">new</span> TaskItem(<span class="string">"subsub1"</span>, <span class="keyword">null</span>);</span><br><span class="line">        sub1.add(subsub1);</span><br><span class="line"></span><br><span class="line">        TaskWrapper result = list1.getResult(Task.SortAction.TITLE, <span class="keyword">true</span>);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>만약 코드가 완성된다면 실행코드를 수행했을 때 getResult() 함수의 결과는 다음과 같을 것이다.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;item:'s75',</span><br><span class="line"> children:[</span><br><span class="line">        &#123;item:taskItem('3강교안작성'),</span><br><span class="line">         children:[</span><br><span class="line">                &#123;item:taskItem('코드정리'),</span><br><span class="line">                 children:[</span><br><span class="line">                        &#123;item:taskItem('subsub1'),</span><br><span class="line">                         children:[]&#125;</span><br><span class="line">                 ]&#125;</span><br><span class="line">         ]&#125;</span><br><span class="line"> ]&#125;</span><br></pre></td></tr></table></figure>
<p>앞에서 하던대로 이번에도 Task 부터 작성 시작!<br>이제는 Task의 하위에 또 TaskList가 올 수 있기 때문에 Task의 getResult() 함수를 고쳐야 한다. 어떻게? Task의 getResult() 함수 호출 시 하위 Task 각각에 대해 getResult() 함수로 자식의 Task 리스트를 덧붙이는 방식으로 진행한다. 결국 Task의 getResult() 함수는 재귀 호출되어 자식 Task 목록을 구성하는 것이다.</p>
<p>이렇게 되면 너무 많은 재귀호출로 인해 발생하는 StackOverflow는 어떻게 해결할 것인가? 아마도 반복문으로 해결할듯 싶은데 이 부분은 나중에 하는 것으로 남겨두자. 일단 Task의 getResult 함수부터 재작성해보자.</p>
<h5 id="task-js-2"><a href="#task-js-2" class="headerlink" title="task.js"></a>task.js</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Task = <span class="class"><span class="keyword">class</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(title, date)&#123;</span><br><span class="line">       <span class="keyword">if</span>(!title) <span class="keyword">throw</span> <span class="string">'invalid title'</span>;</span><br><span class="line">       <span class="keyword">this</span>._title = title;</span><br><span class="line">       <span class="keyword">this</span>._date = date;</span><br><span class="line">       <span class="keyword">this</span>._isComplete = <span class="literal">false</span>;</span><br><span class="line">       <span class="keyword">this</span>._list = [];</span><br><span class="line">    &#125;</span><br><span class="line">    add(task)&#123;</span><br><span class="line">        <span class="keyword">if</span>(task <span class="keyword">instanceof</span> Task) <span class="keyword">this</span>._list.push(task);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">throw</span> <span class="string">'invalid'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    remove(task)&#123;</span><br><span class="line">       <span class="keyword">const</span> list = <span class="keyword">this</span>._list;</span><br><span class="line">       <span class="keyword">if</span>(list.includes(task)) list.splice(list.indexOf(task), <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    getResult(sort, stateGroup)&#123;</span><br><span class="line">       <span class="keyword">const</span> list = <span class="keyword">this</span>._list;</span><br><span class="line">       <span class="keyword">return</span> &#123;</span><br><span class="line">           item:<span class="keyword">this</span>._getResult(),</span><br><span class="line">           children:(!stateGroup ? [...list].sort(sort) : [</span><br><span class="line">              ...list.filter(<span class="function"><span class="params">v</span>=&gt;</span>!v.isComplete()).sort(sort),</span><br><span class="line">              ...list.filter(<span class="function"><span class="params">v</span>=&gt;</span>v.isComplete()).sort(sort)</span><br><span class="line">           ]).map(<span class="function"><span class="params">v</span>=&gt;</span>v.getResult(sort, stateGroup))</span><br><span class="line">       &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    _getResult()&#123;<span class="keyword">throw</span> <span class="string">'override'</span>;&#125;</span><br><span class="line">    isComplete()&#123;<span class="keyword">throw</span> <span class="string">'override'</span>;&#125;</span><br><span class="line">    sortTitle()&#123;<span class="keyword">throw</span> <span class="string">'override'</span>;&#125;</span><br><span class="line">    sortDate()&#123;<span class="keyword">throw</span> <span class="string">'override'</span>;&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h5 id="TaskWrapper-java"><a href="#TaskWrapper-java" class="headerlink" title="TaskWrapper.java"></a>TaskWrapper.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TaskWrapper</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> TaskWrapper item;</span><br><span class="line">    <span class="keyword">private</span> List&lt;TaskWrapper&gt; children;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TaskWrapper</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TaskWrapper</span><span class="params">(Task task, List&lt;TaskWrapper&gt; children)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.item = task;</span><br><span class="line">        <span class="keyword">this</span>.children = children;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TaskWrapper <span class="title">getItem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> item;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;TaskWrapper&gt; <span class="title">getChildren</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> children;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Task-java-2"><a href="#Task-java-2" class="headerlink" title="Task.java"></a>Task.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Task</span> <span class="keyword">extends</span> <span class="title">TaskWrapper</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> String title;</span><br><span class="line">    <span class="keyword">protected</span> LocalDateTime date;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">boolean</span> isComplete;</span><br><span class="line">    <span class="keyword">protected</span> List&lt;Task&gt; list;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Task</span><span class="params">(String title, LocalDateTime date)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.title = Optional.ofNullable(title).orElseThrow(() -&gt; <span class="keyword">new</span> InvalidTitleException());</span><br><span class="line">        <span class="keyword">this</span>.date = date;</span><br><span class="line">        <span class="keyword">this</span>.isComplete = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">this</span>.list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Task task)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.list.add(task);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(Task task)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (list.contains(task)) &#123;</span><br><span class="line">            list.remove(task);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TaskWrapper <span class="title">getResult</span><span class="params">(Task.SortAction sortAction, <span class="keyword">boolean</span> stateGroup)</span> </span>&#123;</span><br><span class="line">        Comparator&lt;Task&gt; sortMethod = sortAction::invoke;</span><br><span class="line">        List&lt;TaskWrapper&gt; sub;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!stateGroup) &#123;</span><br><span class="line">            sub = list.stream()</span><br><span class="line">                    .sorted(sortMethod)</span><br><span class="line">                    .map(each -&gt; each.getResult(sortAction, stateGroup))</span><br><span class="line">                    .collect(Collectors.toList());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            sub = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">            sub.addAll(list.stream()</span><br><span class="line">                    .filter(v -&gt; !v.isComplete())</span><br><span class="line">                    .sorted(sortMethod)</span><br><span class="line">                    .map(each -&gt; each.getResult(sortAction, stateGroup))</span><br><span class="line">                    .collect(Collectors.toList()));</span><br><span class="line">            sub.addAll(list.stream()</span><br><span class="line">                    .filter(v -&gt; v.isComplete())</span><br><span class="line">                    .sorted(sortMethod)</span><br><span class="line">                    .map(each -&gt; each.getResult(sortAction, stateGroup))</span><br><span class="line">                    .collect(Collectors.toList()));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> TaskWrapper(<span class="keyword">this</span>.getResultComposite(sortAction, stateGroup), sub);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> Task <span class="title">getResultComposite</span><span class="params">(Task.SortAction sortAction, <span class="keyword">boolean</span> stateGroup)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">boolean</span> <span class="title">isComplete</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">toggle</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">int</span> <span class="title">sortTitle</span><span class="params">(Task task)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">int</span> <span class="title">sortDate</span><span class="params">(Task task)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">enum</span> SortAction &#123;</span><br><span class="line">        TITLE &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">invoke</span><span class="params">(Task a, Task b)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> a.sortTitle(b);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, DATE &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">invoke</span><span class="params">(Task a, Task b)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> a.sortDate(b);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">int</span> <span class="title">invoke</span><span class="params">(Task a, Task b)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Composite Pattern을 적용한 Task 클래스는 아무런 의존성이 없는 가장 최상위 부모가 된다. 그래서 항목으로 표현할 때는 Task를 상속 받아서 TaskItem이라는 클래스로 구체화될 것이고, 항목 목록으로 표현할 때는 Task를 상속 받아서 TaskList라는 클래스가 될 것이다. TaskItem과 TaskList 클래스에서 getResult() 함수를 호출하게 되면 가장 최상위 부모인 Task 클래스의 getResult() 함수를 호출하게 될 것이고, item 부분에는 자식에서 구현된 hook을 실행하고 (TaskItem, TaskList에서 Hook에 대한 행위가 위임되어 있기 때문) chidren에서는 정렬 후 자식이 있으면 자식들의 getResult 함수를 호출해서 항목을 구성해나가는 형태가 될 것이다. 이렇게 getResult 함수는 자기가 자신을 호출하는게 아니라 자식의 getResult 함수를 호출하는 확산 형태로 진행되게 된다. </p>
<p>Task의 _getResult는 이제 Hook이 되고 실제 할일을 나타내는(Hook을 구현한) TaskItem 클래스를 작성하여 핵심 동작을 그 클래스에 위임한다.</p>
<h5 id="task-item-js"><a href="#task-item-js" class="headerlink" title="task_item.js"></a>task_item.js</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> TaskItem = <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">Task</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(title, date = Date.now())&#123;</span><br><span class="line">        <span class="keyword">super</span>(title);</span><br><span class="line">        <span class="keyword">this</span>._date = date;</span><br><span class="line">        <span class="keyword">this</span>._isComplete = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    _getResult(sort, stateGroup)&#123;<span class="keyword">return</span> <span class="keyword">this</span>;&#125;</span><br><span class="line">    isComplete()&#123;<span class="keyword">return</span> <span class="keyword">this</span>._isComplete;&#125;</span><br><span class="line">    sortTitle()&#123;<span class="keyword">return</span> <span class="keyword">this</span>._title &gt; task._title;&#125;</span><br><span class="line">    sortDate()&#123;<span class="keyword">return</span> <span class="keyword">this</span>._date &gt; task._date;&#125;</span><br><span class="line">    toggle()&#123;<span class="keyword">this</span>._isComplete = !<span class="keyword">this</span>._isComplete;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="TaskItem-java"><a href="#TaskItem-java" class="headerlink" title="TaskItem.java"></a>TaskItem.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TaskItem</span> <span class="keyword">extends</span> <span class="title">Task</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TaskItem</span><span class="params">(String title, LocalDateTime date)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(title, date == <span class="keyword">null</span> ? LocalDateTime.now() : date);</span><br><span class="line">        <span class="keyword">this</span>.isComplete = <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Task <span class="title">getResultComposite</span><span class="params">(Task.SortAction sortAction, <span class="keyword">boolean</span> stateGroup)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isComplete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.isComplete;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">toggle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.isComplete = !<span class="keyword">this</span>.isComplete;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">sortTitle</span><span class="params">(Task task)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.title.compareTo(task.title);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">sortDate</span><span class="params">(Task task)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.date.compareTo(task.date);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="task-list-js-2"><a href="#task-list-js-2" class="headerlink" title="task_list.js"></a>task_list.js</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> TaskList = <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">Task</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(title)&#123;<span class="keyword">super</span>(title);&#125;</span><br><span class="line">    _getResult()&#123;<span class="keyword">return</span> <span class="keyword">this</span>._title;&#125;</span><br><span class="line">    isComplete()&#123;&#125;</span><br><span class="line">    sortTitle()&#123;<span class="keyword">return</span> <span class="keyword">this</span>;&#125;</span><br><span class="line">    sortDate()&#123;<span class="keyword">return</span> <span class="keyword">this</span>;&#125;</span><br><span class="line">    </span><br><span class="line">    byTitle(stateGroup = <span class="literal">true</span>)&#123;<span class="keyword">return</span> <span class="keyword">this</span>.getResult(Task.title, stateGroup);&#125;</span><br><span class="line">    byDate(stateGroup = <span class="literal">true</span>)&#123;<span class="keyword">return</span> <span class="keyword">this</span>.getResult(Task.date, stateGroup);&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="TaskList-java-2"><a href="#TaskList-java-2" class="headerlink" title="TaskList.java"></a>TaskList.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TaskList</span> <span class="keyword">extends</span> <span class="title">Task</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TaskList</span><span class="params">(String title)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(title, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Task <span class="title">getResultComposite</span><span class="params">(Task.SortAction sortAction, <span class="keyword">boolean</span> stateGroup)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> TaskItem(<span class="keyword">this</span>.title, <span class="keyword">this</span>.date);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isComplete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">toggle</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">sortTitle</span><span class="params">(Task task)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">sortDate</span><span class="params">(Task task)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TaskWrapper <span class="title">byTitle</span><span class="params">(<span class="keyword">boolean</span> stateGroup)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.getResult(SortAction.TITLE, stateGroup);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TaskWrapper <span class="title">byDate</span><span class="params">(<span class="keyword">boolean</span> stateGroup)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.getResult(SortAction.DATE, stateGroup);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Task, TaskItem, TaskList 클래스를 잘 보면 Composite Pattern 이라고 했는데 또 한가지 패턴이 보인다. 바로 Template Method Pattern도 쓰여있는 것을 볼 수 있다. 이렇게 실무에서는 디자인 패턴이 여러개가 결합된 형태로 적용된다.</p>
<p>여기서는 Todo App 이라는 반복되는 행위(Loop)를 Composite Pattern으로 풀었는데 HTML Parser, Markdown Parser도 컴포짓 패턴으로 구현할 수 있으며 심지어 네비게이션의 길찾기도 컴포짓 패턴으로 구현할 수 있다고 한다. (우와 그럼 컴포짓 패턴이 만능 아닌가? 사실 네비게이션 길찾기는 도무지 상상이 안간다..)</p>
<h3 id="Step-4-Class-Diagram"><a href="#Step-4-Class-Diagram" class="headerlink" title="Step 4. Class Diagram"></a>Step 4. Class Diagram</h3><p style="text-align: center;"><img src="/images/20180327-understanding-composite-pattern/step_4_class_diagram.png"></p>

<h3 id="Step-4-결과물"><a href="#Step-4-결과물" class="headerlink" title="Step 4. 결과물"></a>Step 4. 결과물</h3><h5 id="javascript-2"><a href="#javascript-2" class="headerlink" title="javascript"></a>javascript</h5><ul>
<li><a href="https://github.com/icednut/design-pattern-study/tree/master/composite_pattern/javascript/step_04" target="_blank" rel="noopener">https://github.com/icednut/design-pattern-study/tree/master/composite_pattern/javascript/step_04</a></li>
</ul>
<h5 id="java-2"><a href="#java-2" class="headerlink" title="java"></a>java</h5><ul>
<li><a href="https://github.com/icednut/design-pattern-study/tree/master/composite_pattern/java/step4" target="_blank" rel="noopener">https://github.com/icednut/design-pattern-study/tree/master/composite_pattern/java/step4</a></li>
</ul>
<h2 id="Step-5-Task를-그리는-Renderer-구현하기"><a href="#Step-5-Task를-그리는-Renderer-구현하기" class="headerlink" title="Step 5. Task를 그리는 Renderer 구현하기"></a>Step 5. Task를 그리는 Renderer 구현하기</h2><p>Todo App에서 데이터와 행위에 대해 추상화를 어느정도 하였으니 이번엔 화면에 그리는 작업을 하는 Renderer를 구현해보자. 잉? 앞에서 화면 구현은 안한다고 하지 않았나? 물론 그렇게 말했지만 그래도 브라우저에 간단한 DOM으로 출력하는 형태로 Renderer를 구현해보자. (이제 이걸 DomRenderer라고 부르며 Java Version은 ConsoleRenderer라고 콜솔에 출력하는 형태로 구현할 것이다.)</p>
<p>Task가 Composite Pattern으로 구현되어 있기 때문에 이를 그리는데 사용하는 Renderer의 구조도 Composite Pattern 구조를 따라가게 된다. 이걸 <code>컴포지션은 전파된다</code>라고 표현한다.</p>
<p>Renderer는 구현 전략을 간단하게 표현하자면 Renderer는 TaskList를 소유하고 이걸 이용해 getResult를 호출하면 줄줄이 사탕으로 딸려오는 Task 데이터를 참조하여 그릴 것이다.</p>
<p>시작하기 전에 Util 성 코드 부터 하나 추가하자.</p>
<h5 id="util-js"><a href="#util-js" class="headerlink" title="util.js"></a>util.js</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> el =<span class="function">(<span class="params">tag, ...attr</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> el = <span class="built_in">document</span>.createElement(tag);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; attr.length;)&#123;</span><br><span class="line">        <span class="keyword">const</span> k = attr[i++], v = attr[i++];</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">typeof</span> el[k] == <span class="string">'function'</span>) el[k](...(<span class="built_in">Array</span>.isArray(v) ? v : [v]));</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(k[<span class="number">0</span>] == <span class="string">'@'</span>) el.style[k.substr(<span class="number">1</span>)] = v;</span><br><span class="line">        <span class="keyword">else</span> el[k] = v;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> el;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>위 코드는 DOM을 생성하는 함수 el을 선언한 것이다. 첫 번째 파라미터로는 만드려고 하는데 element의 Tag명을 받고, 그 이후 파라미터는 부터는 함수, style, attribute를 받는다. 자세한 사용 방법은 DomRenderer 클래스를 작성하면서 알아보자.</p>
<p><img src="/images/20180327-understanding-composite-pattern/sequence_diagram.png"></p>
<p>그럼 마찬가지로 실행코드 작성 후 의존성이 없는 Task 부터 시작해서 TaskList, TaskItem 그 다음 DomRenderer 클래스 순으로 작성해보자. 위 시퀀스 다이어그램을 보면 자식 Renderer에서 TaskList의 getResult() 함수를 호출하면 부모인 Task의 getResult() 함수를 호출하게 되는 꼴이고 Task.getResult()는 자식(TaskList)의 Hook인 _getResult() 함수를 호출하여 처리한다. 그렇게 반환된 결과에서 TaskItem 각각은 또 getResult() 함수를 호출하게 되고 이렇게 점점 getResult() 함수 호출이 확산되어 가는 모습을 볼 수 있다.</p>
<h5 id="app-js-2"><a href="#app-js-2" class="headerlink" title="app.js"></a>app.js</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> list1 = <span class="keyword">new</span> TaskList(<span class="string">"s75"</span>);</span><br><span class="line"><span class="keyword">const</span> item1 = <span class="keyword">new</span> TaskItem(<span class="string">"3강교안작성"</span>);</span><br><span class="line">list1.add(item1);</span><br><span class="line"><span class="keyword">const</span> sub1 = <span class="keyword">new</span> TaskItem(<span class="string">"코드정리"</span>);</span><br><span class="line">item1.add(sub1);</span><br><span class="line"><span class="keyword">const</span> subsub1 = <span class="keyword">new</span> TaskItem(<span class="string">"subsub1"</span>);</span><br><span class="line">sub1.add(subsub1);</span><br><span class="line">list1.getResult(Task.title);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> todo = <span class="keyword">new</span> DomRenderer(list1, sel(<span class="string">"#todo"</span>));</span><br><span class="line">todo.render();</span><br></pre></td></tr></table></figure>
<h5 id="Application-java-2"><a href="#Application-java-2" class="headerlink" title="Application.java"></a>Application.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        TaskList list1 = <span class="keyword">new</span> TaskList(<span class="string">"s75"</span>);</span><br><span class="line">        TaskItem item1 = <span class="keyword">new</span> TaskItem(<span class="string">"3강교안작성"</span>, <span class="keyword">null</span>);</span><br><span class="line">        list1.add(item1);</span><br><span class="line"></span><br><span class="line">        TaskItem sub1 = <span class="keyword">new</span> TaskItem(<span class="string">"코드정리"</span>, <span class="keyword">null</span>);</span><br><span class="line">        item1.add(sub1);</span><br><span class="line"></span><br><span class="line">        TaskItem subsub1 = <span class="keyword">new</span> TaskItem(<span class="string">"subsub1"</span>, <span class="keyword">null</span>);</span><br><span class="line">        sub1.add(subsub1);</span><br><span class="line"></span><br><span class="line">        ConsoleRenderer todo = <span class="keyword">new</span> ConsoleRenderer(list1);</span><br><span class="line">        todo.render();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>그 다음 Task 클래스는 어떻게 작성할까? 이제는 TaskList와 TaskItem은 Task 클래스를 상속 받고 있기 때문에 Task에 공통로직을 모을 수 있게 되었다. 또 Task의 getResult 함수의 결과로 item은 자기 자신을 보내고 children으로는 children 각각의 요소들에 해당하는 getResult 함수호출을 확산하도록 구현한다.</p>
<h5 id="task-js-3"><a href="#task-js-3" class="headerlink" title="task.js"></a>task.js</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Task = <span class="class"><span class="keyword">class</span></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> title(a, b)&#123;<span class="keyword">return</span> a.sortTitle(b);&#125;</span><br><span class="line">    <span class="keyword">static</span> date(a, b)&#123;<span class="keyword">return</span> a.sortDate(b);&#125;</span><br><span class="line">    <span class="keyword">constructor</span>(title)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!title) <span class="keyword">throw</span> <span class="string">'invalid title'</span>; <span class="keyword">else</span> <span class="keyword">this</span>._title = title;</span><br><span class="line">        <span class="keyword">this</span>._list = [];</span><br><span class="line">    &#125;</span><br><span class="line">    add(task)&#123;</span><br><span class="line">        <span class="keyword">if</span>(task <span class="keyword">instanceof</span> Task) <span class="keyword">this</span>._list.push(task);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">throw</span> <span class="string">'invalid'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    remove(task)&#123;</span><br><span class="line">        <span class="keyword">const</span> list = <span class="keyword">this</span>._list;</span><br><span class="line">        <span class="keyword">if</span>(list.includes(task)) list.splice(list.indexOf(task), <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    getResult(sort, stateGroup)&#123;</span><br><span class="line">        <span class="keyword">const</span> list = <span class="keyword">this</span>._list;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            item:<span class="keyword">this</span>,</span><br><span class="line">            children:(!stateGroup ? [...list].sort(sort) : [</span><br><span class="line">                ...list.filter(<span class="function"><span class="params">v</span>=&gt;</span>!v.isComplete()).sort(sort),</span><br><span class="line">                ...list.filter(<span class="function"><span class="params">v</span>=&gt;</span>v.isComplete()).sort(sort)</span><br><span class="line">            ]).map(<span class="function"><span class="params">v</span>=&gt;</span>v.getResult(sort, stateGroup))</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    isComplete()&#123;<span class="keyword">throw</span> <span class="string">'override'</span>;&#125;</span><br><span class="line">    sortTitle()&#123;<span class="keyword">throw</span> <span class="string">'override'</span>;&#125;</span><br><span class="line">    sortDate()&#123;<span class="keyword">throw</span> <span class="string">'override'</span>;&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h5 id="Task-java-3"><a href="#Task-java-3" class="headerlink" title="Task.java"></a>Task.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Task</span> <span class="keyword">extends</span> <span class="title">TaskWrapper</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> String title;</span><br><span class="line">    <span class="keyword">protected</span> List&lt;Task&gt; list;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Task</span><span class="params">(String title)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.title = Optional.ofNullable(title).orElseThrow(() -&gt; <span class="keyword">new</span> InvalidTitleException());</span><br><span class="line">        <span class="keyword">this</span>.list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Task task)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.list.add(task);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(Task task)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (list.contains(task)) &#123;</span><br><span class="line">            list.remove(task);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TaskWrapper <span class="title">getResult</span><span class="params">(SortAction sortAction, <span class="keyword">boolean</span> stateGroup)</span> </span>&#123;</span><br><span class="line">        Comparator&lt;Task&gt; sortMethod = sortAction::invoke;</span><br><span class="line">        List&lt;TaskWrapper&gt; children;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!stateGroup) &#123;</span><br><span class="line">            children = list.stream()</span><br><span class="line">                    .sorted(sortMethod)</span><br><span class="line">                    .map(each -&gt; each.getResult(sortAction, stateGroup))</span><br><span class="line">                    .collect(Collectors.toList());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            children = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">            children.addAll(list.stream()</span><br><span class="line">                    .filter(v -&gt; !v.isComplete())</span><br><span class="line">                    .sorted(sortMethod)</span><br><span class="line">                    .map(each -&gt; each.getResult(sortAction, stateGroup))</span><br><span class="line">                    .collect(Collectors.toList()));</span><br><span class="line">            children.addAll(list.stream()</span><br><span class="line">                    .filter(v -&gt; v.isComplete())</span><br><span class="line">                    .sorted(sortMethod)</span><br><span class="line">                    .map(each -&gt; each.getResult(sortAction, stateGroup))</span><br><span class="line">                    .collect(Collectors.toList()));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> TaskWrapper(<span class="keyword">this</span>, children);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">boolean</span> <span class="title">isComplete</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">int</span> <span class="title">sortTitle</span><span class="params">(Task task)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">int</span> <span class="title">sortDate</span><span class="params">(Task task)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">enum</span> SortAction &#123;</span><br><span class="line">        TITLE &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">invoke</span><span class="params">(Task a, Task b)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> a.sortTitle(b);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, DATE &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">invoke</span><span class="params">(Task a, Task b)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> a.sortDate(b);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">int</span> <span class="title">invoke</span><span class="params">(Task a, Task b)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이제 TaskItem과 TaskList 클래스에서는 더 이상 _getResult 훅을 구현하지 않아도 된다. 과감하게 삭제하자.</p>
<h5 id="task-item-js-1"><a href="#task-item-js-1" class="headerlink" title="task_item.js"></a>task_item.js</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> TaskItem = <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">Task</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(title, date = Date.now())&#123;</span><br><span class="line">        <span class="keyword">super</span>(title);</span><br><span class="line">        <span class="keyword">this</span>._date = date;</span><br><span class="line">        <span class="keyword">this</span>._isComplete = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    isComplete()&#123;<span class="keyword">return</span> <span class="keyword">this</span>._isComplete;&#125;</span><br><span class="line">    sortTitle()&#123;<span class="keyword">return</span> <span class="keyword">this</span>._title &gt; task._title;&#125;</span><br><span class="line">    sortDate()&#123;<span class="keyword">return</span> <span class="keyword">this</span>._date &gt; task._date;&#125;</span><br><span class="line">    toggle()&#123;<span class="keyword">this</span>._isComplete = !<span class="keyword">this</span>._isComplete;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="TaskItem-java-1"><a href="#TaskItem-java-1" class="headerlink" title="TaskItem.java"></a>TaskItem.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TaskItem</span> <span class="keyword">extends</span> <span class="title">Task</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> LocalDateTime date;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isComplete;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TaskItem</span><span class="params">(String title, LocalDateTime date)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(title);</span><br><span class="line">        <span class="keyword">this</span>.date = date == <span class="keyword">null</span> ? LocalDateTime.now() : date;</span><br><span class="line">        <span class="keyword">this</span>.isComplete = <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isComplete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.isComplete;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">toggle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.isComplete = !<span class="keyword">this</span>.isComplete;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">sortTitle</span><span class="params">(Task task)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.title.compareTo(task.title);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">sortDate</span><span class="params">(Task task)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (task <span class="keyword">instanceof</span> TaskItem) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.date.compareTo(((TaskItem) task).date);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="task-list-js-3"><a href="#task-list-js-3" class="headerlink" title="task_list.js"></a>task_list.js</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> TaskList = <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">Task</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(title)&#123;<span class="keyword">super</span>(title);&#125;</span><br><span class="line">    isComplete()&#123;&#125;</span><br><span class="line">    sortTitle()&#123;<span class="keyword">return</span> <span class="keyword">this</span>;&#125;</span><br><span class="line">    sortDate()&#123;<span class="keyword">return</span> <span class="keyword">this</span>;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="TaskList-java-3"><a href="#TaskList-java-3" class="headerlink" title="TaskList.java"></a>TaskList.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TaskList</span> <span class="keyword">extends</span> <span class="title">Task</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TaskList</span><span class="params">(String title)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(title);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isComplete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">sortTitle</span><span class="params">(Task task)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">sortDate</span><span class="params">(Task task)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>마지막으로 DomRenderer 클래스를 구현할 차례다. 실행코드에서 작성했던 DomRenderer의 render() 함수부터 작성해보자.</p>
<h5 id="dom-renderer-js"><a href="#dom-renderer-js" class="headerlink" title="dom_renderer.js"></a>dom_renderer.js</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> DomRenderer = <span class="class"><span class="keyword">class</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(list, parent)&#123;</span><br><span class="line">        <span class="keyword">this</span>._parent = parent;</span><br><span class="line">        <span class="keyword">this</span>._list = list;</span><br><span class="line">        <span class="keyword">this</span>._sort = <span class="string">'title'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    add(parent, title, date)&#123;</span><br><span class="line">        parent.add(<span class="keyword">new</span> TaskItem(title, date));</span><br><span class="line">        <span class="keyword">this</span>.render(); <span class="comment">// 모델 렌더링은 추가된 요소만 그리는게 아니라 모델 전체를 다시 그린다.</span></span><br><span class="line">    &#125;</span><br><span class="line">    remove(parent, task)&#123;</span><br><span class="line">        parent.remove(task);</span><br><span class="line">        <span class="keyword">this</span>.render();</span><br><span class="line">    &#125;</span><br><span class="line">    toggle(task)&#123;</span><br><span class="line">        <span class="keyword">if</span>(task <span class="keyword">instanceof</span> TaskItem)&#123;</span><br><span class="line">            task.toggle();</span><br><span class="line">            <span class="keyword">this</span>.render();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        <span class="keyword">const</span> parent = <span class="keyword">this</span>._parent;</span><br><span class="line">        parent.innerHTML = <span class="string">''</span>;</span><br><span class="line">        parent.appendChild(<span class="string">'title,date'</span>.split(<span class="string">','</span>).reduce(<span class="function">(<span class="params">nav,c</span>)=&gt;</span>(</span><br><span class="line">        nav.appendChild(</span><br><span class="line">            el(<span class="string">'button'</span>, <span class="string">'innerHTML'</span>, c,</span><br><span class="line">                <span class="string">'@fontWeight'</span>, <span class="keyword">this</span>._sort == c ? <span class="string">'bold'</span> : <span class="string">'normal'</span>,</span><br><span class="line">                <span class="string">'addEventListener'</span>, [<span class="string">'click'</span>, e=&gt;(<span class="keyword">this</span>._sort = Task[c], <span class="keyword">this</span>.render())])</span><br><span class="line">        	), nav</span><br><span class="line">        ), el(<span class="string">'nav'</span>)));</span><br><span class="line">        <span class="keyword">this</span>._render(parent, <span class="keyword">this</span>._list, <span class="keyword">this</span>._list.getResult(Task[<span class="keyword">this</span>._sort]), <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    _render(base, parent, &#123;item, children&#125;, depth)&#123;</span><br><span class="line">        <span class="keyword">const</span> temp = [];</span><br><span class="line">        base.style.paddingLeft = depth * <span class="number">10</span> + <span class="string">'px'</span>;</span><br><span class="line">        <span class="keyword">if</span>(item <span class="keyword">instanceof</span> TaskList)&#123;</span><br><span class="line">            temp.push(el(<span class="string">'h2'</span>, <span class="string">'innerHTML'</span>, item._title));</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            temp.push(</span><br><span class="line">                el(<span class="string">'h3'</span>, <span class="string">'innerHTML'</span>, item._title,</span><br><span class="line">                  <span class="string">'@textDecoration'</span>, item.isComplete() ? <span class="string">'line-through'</span> : <span class="string">'none'</span>),</span><br><span class="line">                el(<span class="string">'time'</span>, <span class="string">'innerHTML'</span>, item._date.toString(), <span class="string">'datetime'</span>, item._date.toString()),</span><br><span class="line">                el(<span class="string">'button'</span>, <span class="string">'innerHTML'</span>, item.isComplete() ? <span class="string">'progress'</span> : <span class="string">'complete'</span>,</span><br><span class="line">                  <span class="string">'addEventListener'</span>, [<span class="string">'click'</span>, _ =&gt; <span class="keyword">this</span>.toggle(item)]),</span><br><span class="line">                el(<span class="string">'button'</span>, <span class="string">'innerHTML'</span>, <span class="string">'remove'</span>,</span><br><span class="line">                  <span class="string">'addEventListener'</span>, [<span class="string">'click'</span>, _ =&gt; <span class="keyword">this</span>.remove(parent, item)])</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> sub = el(<span class="string">'section'</span>,</span><br><span class="line">                      <span class="string">'appendChild'</span>, el(<span class="string">'input'</span>, <span class="string">'type'</span>, <span class="string">'text'</span>),</span><br><span class="line">                      <span class="string">'appendChild'</span>, el(<span class="string">'button'</span>, <span class="string">'innerHTML'</span>, <span class="string">'addTask'</span>,</span><br><span class="line">                                       <span class="string">'addEventListener'</span>, [<span class="string">'click'</span>, e =&gt; <span class="keyword">this</span>.add(item, e.target.previousSibling.value)])</span><br><span class="line">                      );</span><br><span class="line">        children.forEach(<span class="function"><span class="params">v</span> =&gt;</span> <span class="keyword">this</span>._render(sub, item, v, depth + <span class="number">1</span>));</span><br><span class="line">        temp.push(sub);</span><br><span class="line">        temp.forEach(<span class="function"><span class="params">v</span> =&gt;</span> base.appendChild(v));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h5 id="ConsoleRenderer-java"><a href="#ConsoleRenderer-java" class="headerlink" title="ConsoleRenderer.java"></a>ConsoleRenderer.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsoleRenderer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> TaskList list;</span><br><span class="line">    <span class="keyword">private</span> Task.SortAction sort;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ConsoleRenderer</span><span class="params">(TaskList taskList)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.list = taskList;</span><br><span class="line">        <span class="keyword">this</span>.sort = Task.SortAction.TITLE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">render</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.renderComposite(list.getResult(sort, <span class="keyword">false</span>), <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">renderComposite</span><span class="params">(TaskWrapper result, <span class="keyword">int</span> depth)</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; temp = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        TaskWrapper item = result.getItem();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (item <span class="keyword">instanceof</span> TaskList) &#123;</span><br><span class="line">            TaskList taskList = (TaskList) item;</span><br><span class="line">            temp.add(taskList.title);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (item <span class="keyword">instanceof</span> TaskItem) &#123;</span><br><span class="line">            TaskItem taskItem = (TaskItem) item;</span><br><span class="line">            String completeStar = taskItem.isComplete() ? <span class="string">"*"</span> : <span class="string">" "</span>;</span><br><span class="line">            temp.add(taskItem.title + <span class="string">" ("</span> + completeStar + <span class="string">")"</span> + <span class="string">" - "</span> + taskItem.date.format(DateTimeFormatter.ofPattern(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>)));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        temp.forEach(v -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; depth; i++) &#123;</span><br><span class="line">                System.out.print(<span class="string">" "</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(v);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        result.getChildren().forEach(taskWrapper -&gt; &#123;</span><br><span class="line">            <span class="keyword">this</span>.renderComposite(taskWrapper, depth + <span class="number">1</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>render() 함수를 살펴보면 Task 클래스의 getResult 함수와 많이 닮아 있다. 이유는 Task의 재귀호출로 데이터를 가져오는 컴포짓에 따라서 render() 함수도 마찬가지로 재귀로 데이터를 가져와서 DOM을 생성해야 되기 때문이다. (컴포지션 전파 때문)</p>
<p>여기까지가 To-Do App을 Composite Pattern으로 구현한 결과이다. 그럼 이대로 끝난 것일까? 컴포지션 전파가 과연 좋은 코드라고 할 수 있을까? 추후 또 다른 Renderer를 구현한다 치면 그 클래스에서 컴포지션 전파를 하게 하는게 올바른걸까? 다음 포스팅에서는 컴포지션 전파를 끊어내기 위한 Visitor Pattern을 살펴보도록 하자.</p>
<h2 id="To-Do-App-Composite-Pattern-결과물"><a href="#To-Do-App-Composite-Pattern-결과물" class="headerlink" title="To-Do App Composite Pattern 결과물"></a>To-Do App Composite Pattern 결과물</h2><h3 id="Javascript-version"><a href="#Javascript-version" class="headerlink" title="Javascript version"></a>Javascript version</h3><ul>
<li><a href="https://gist.github.com/icednut/c619b19495a79ebfce7252e3a4573414" target="_blank" rel="noopener">https://gist.github.com/icednut/c619b19495a79ebfce7252e3a4573414</a></li>
</ul>
<h3 id="Java-Version"><a href="#Java-Version" class="headerlink" title="Java Version"></a>Java Version</h3><ul>
<li><a href="https://github.com/icednut/design-pattern-study/tree/master/composite_pattern/java/step5" target="_blank" rel="noopener">https://github.com/icednut/design-pattern-study/tree/master/composite_pattern/java/step5</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      
      
      <div>
        <ul class="post-copyright">
          <li class="post-copyright-author">
          <strong>Post author:  </strong>Icednut
          </li>
          <li class="post-copyright-link">
          <strong>Post link:  </strong>
          <a href="/2018/03/27/20180327-understanding-composite-pattern/" target="_blank" title="To-Do App 개발을 통한 Composite Pattern 이해하기 (javascript, java 버전)">http://icednut.github.io/2018/03/27/20180327-understanding-composite-pattern/</a>
          </li>
          <li class="post-copyright-license">
            <strong>Copyright Notice:   </strong>
            All articles in this blog are licensed under <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">CC BY-NC-ND 4.0</a>
            unless stating additionally.
          </li>
         
        </ul>
<div>
</div></div>
      
      
        
	<section id="comments" class="comment">
	  <div id="disqus_thread">
	  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
	  </div>
	</section>

	<script type="text/javascript">
	var disqus_shortname = 'icednut';
	(function(){
	  var dsq = document.createElement('script');
	  dsq.type = 'text/javascript';
	  dsq.async = true;
	  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	}());
	(function(){
	  var dsq = document.createElement('script');
	  dsq.type = 'text/javascript';
	  dsq.async = true;
	  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
	  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	}());
	</script>



      
      

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/03/29/20180329-understanding-visitor-pattern/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          To-Do App 개발을 통한 Visitor Pattern 이해하기 (javascript 버전)
        
      </div>
    </a>
  
  
    <a href="/2018/03/25/20180325-about-java-garbage-collection/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Java Garbage Collector 이해하기 Part 1 (with G1GC, Garbage First GC)</div>
    </a>
  
</nav>

  
</article>

<!-- Table of Contents -->

</section>
        
      </div>
      
      <footer id="footer">
  

  <div class="container">
      	<div class="row">
	      <p> Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/iTimeTraveler/hexo-theme-hiker" target="_blank">Hexo-theme-hiker</a> </p>
	      <p id="copyRightEn">Copyright &copy; 2013 - 2019 Icednut&#39;s Note All Rights Reserved.</p>
	      
	      
  		   	<p id="copyRightCn">Icednut hold copyright</p>
  		   
		</div>

		
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");
    var allheader = document.getElementById("allheader");

    wrapdiv.style.minHeight = document.body.offsetHeight + "px";
    if (allheader != null) {
      contentdiv.style.minHeight = document.body.offsetHeight - allheader.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    } else {
      contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    }
</script>
    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/categories" class="mobile-nav-link">Categories</a>
  
    <a href="/tags" class="mobile-nav-link">Tags</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav> -->
    

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/scripts.js"></script>


  <script src="/js/home.js"></script>



  <script src="/js/dialog.js"></script>



<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-91631073-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->












  </div>

  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="myModalLabel">设置</h2>
      </div>
      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">


      <div class="modal-body">
          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" onclick="javascript:setFontSize();" aria-expanded="true" aria-controls="collapseOne">
              正文字号大小
            </a>
          </div>
          <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
          <div class="panel-body">
            您已调整页面字体大小
          </div>
        </div>
      


          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" onclick="javascript:setBackground();" aria-expanded="true" aria-controls="collapseTwo">
              夜间护眼模式
            </a>
        </div>
          <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
          <div class="panel-body">
            夜间模式已经开启，再次单击按钮即可关闭 
          </div>
        </div>

        <div>
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="true" aria-controls="collapseThree">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;关 于&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
        </div>
         <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
          <div class="panel-body">
            Icednut&#39;s Note
          </div>
          <div class="panel-body">
            Copyright © 2019 Icednut All Rights Reserved.
          </div>
        </div>
      </div>


      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <div class="modal-footer">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
      </div>
    </div>
  </div>
</div>
  
  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
  
</body>
</html>